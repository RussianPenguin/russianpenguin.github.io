---
layout: post
title: 'PulseAudio: Перенаправление потоков аля jackd'
date: 2020-10-11 00:48:48.000000000 +03:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- HowTo
tags:
- jackd
- linux
- pulseaudio
meta:
  _wpcom_is_markdown: '1'
  _thumbnail_id: '2567'
  _publicize_job_id: '49783101530'
  timeline_notification: '1602366532'
author:
  login: russianpenguin
  email: maksim.v.zubkov@gmail.com
  display_name: russianpenguin
  first_name: Maksim
  last_name: Zubkov
permalink: "/2020/10/11/pulseaudio-loopback/"
excerpt: На простом примере рассмотрим как можно микшировать несколько источников
  звука в pulseaudio. Статья будет полезна так же и тем, кто любит стримить что-либо,
  но не имеет звуковой карты с модной loopback-функциональностью.
---
<p><!-- wp:paragraph --></p>
<p>Что мы хотим? Мы хотим подмешать к микрофонному сигналу еще что-то. Например дополнительный сигнал с другой звуковой карты для того, чтобы по скайпу с кем-то поджемить на гитаре\ударке.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>В jackd это сделать довольно просто - там куча графических роутеров. Но что делать если надо подмешать сигнал в pulse?</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Возьмем самый простой пример: нужно подмешать к звуку микрофона аудио из браузера.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:code --></p>
<pre class="wp-block-code"><code>mic -&gt; skype &lt;- ff</code></pre>
<p><!-- /wp:code --></p>
<p><!-- wp:paragraph --></p>
<p>Просто так это работать не будет. Потребуется виртуальное loopback-устройство, которое будет смешивать сигналы, а после остальное по будет использовать его как микрофон.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:code --></p>
<pre class="wp-block-code"><code>       skype<br />         ^<br />         |<br />mic -&gt; loopback &lt;- ff         </code></pre>
<p><!-- /wp:code --></p>
<p><!-- wp:paragraph --></p>
<p><strong>1 - Создаем устройство</strong></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Создаем само устройство и задаем ему описание чтобы в панели управления бло что-то вразумительное, а не "Пустой выход".</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:syntaxhighlighter/code {"language":"bash"} --></p>
<pre class="wp-block-syntaxhighlighter-code">$ pacmd load-module module-null-sink sink_name=fx-sink
42
$ pacmd update-sink-proplist fx-sink device.description=Виртуальный_микрофон_вход
$ pacmd update-source-proplist fx-sink.monitor device.description=Виртуальный_микрофон_выход</pre>
<p><!-- /wp:syntaxhighlighter/code --></p>
<p><!-- wp:paragraph --></p>
<p>Цифру, которая выдает первая команда можно запомнить. Это идентификатор, по которому можно sink удалить.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p><strong>2 - Перенаправляем микрофонный выход на это устройство</strong></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:syntaxhighlighter/code {"language":"bash"} --></p>
<pre class="wp-block-syntaxhighlighter-code">$ pactl load-module module-loopback source=alsa_input sink=fx-sink
43</pre>
<p><!-- /wp:syntaxhighlighter/code --></p>
<p><!-- wp:paragraph --></p>
<p>Номер так же можно запомнить чтобы потом удалить ассоциацию.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Теперь в качестве устройства для ввода в панели управления (ставим как дефолтный девайс) или в программе выбираем fx-sink.monitor. Он будет называться "Виртуальный_микрофон_выход" (выше мы прописали в описании).</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Чтобы посмотреть что писать в аргументе source просматриваем вывод команды</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:syntaxhighlighter/code --></p>
<pre class="wp-block-syntaxhighlighter-code">$ pactl list-sinks</pre>
<p><!-- /wp:syntaxhighlighter/code --></p>
<p><!-- wp:paragraph --></p>
<p>Тут нам нужно найти содержимое поля name системного микрофона.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"align":"center","id":2581,"sizeSlug":"large","linkDestination":"media"} --></p>
<div class="wp-block-image">
<figure class="aligncenter size-large"><a href="https://russianpenguin.files.wordpress.com/2020/10/2020-10-11-004003_select-1.png"><img src="{{ site.baseurl }}/assets/images/2020/10/2020-10-11-004003_select-1.png?w=1024" alt="" class="wp-image-2581" /></a></figure>
</div>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p><strong>Источники:</strong></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:list --></p>
<ul>
<li><a href="https://wiki.archlinux.org/index.php/PulseAudio/Examples#Mixing_additional_audio_into_the_microphone's_audio">ArchWiki: PulseAudio/Examples</a></li>
</ul>
<p><!-- /wp:list --></p>
<p><!-- wp:paragraph --></p>
<p><!-- /wp:paragraph --></p>
