---
layout: post
title: 'Git: выделяем глобальный репозитарий для проекта'
date: 2014-07-27 22:04:02.000000000 +04:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Разработка
tags:
- git
meta:
  _wpcom_is_markdown: '1'
  sharing_disabled: '1'
  _wpas_skip_facebook: '1'
  _wpas_skip_google_plus: '1'
  _wpas_skip_twitter: '1'
  _wpas_skip_linkedin: '1'
  _wpas_skip_tumblr: '1'
  _wpas_skip_path: '1'
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _edit_last: '13696577'
  _publicize_job_id: '19151267105'
author:
  login: russianpenguin
  email: maksim.v.zubkov@gmail.com
  display_name: russianpenguin
  first_name: Maksim
  last_name: Zubkov
permalink: "/2014/07/27/git-%d0%b2%d1%8b%d0%b4%d0%b5%d0%bb%d1%8f%d0%b5%d0%bc-%d0%b3%d0%bb%d0%be%d0%b1%d0%b0%d0%bb%d1%8c%d0%bd%d1%8b%d0%b9-%d1%80%d0%b5%d0%bf%d0%be%d0%b7%d0%b8%d1%82%d0%b0%d1%80%d0%b8%d0%b9-%d0%b4%d0%bb%d1%8f/"
---
<p>Иногда мы копируем папку с проектом на отдельную машину, а затем пытаемся использовать его в качестве мастер-репозитария.<br /> Но при попытке сделать пуш в этот репозитарий нас подстерегает ошибка.[code]$ git push origin master<br />
Counting objects: 30, done.<br />
Delta compression using up to 4 threads.<br />
Compressing objects: 100% (16/16), done.<br />
Writing objects: 100% (17/17), 3.31 KiB | 0 bytes/s, done.<br />
Total 17 (delta 4), reused 0 (delta 0)<br />
remote: error: refusing to update checked out branch: refs/heads/master<br />
remote: error: By default, updating the current branch in a non-bare repository<br />
remote: error: is denied, because it will make the index and work tree inconsistent<br />
remote: error: with what you pushed, and will require 'git reset --hard' to match<br />
remote: error: the work tree to HEAD.<br />
remote: error:<br />
remote: error: You can set 'receive.denyCurrentBranch' configuration variable to<br />
remote: error: 'ignore' or 'warn' in the remote repository to allow pushing into<br />
remote: error: its current branch; however, this is not recommended unless you<br />
remote: error: arranged to update its work tree to match what you pushed in some<br />
remote: error: other way.<br />
remote: error:<br />
remote: error: To squelch this message and still keep the default behaviour, set<br />
remote: error: 'receive.denyCurrentBranch' configuration variable to 'refuse'.<br />
To /project/path<br />
 ! [remote rejected] master -&gt; master (branch is currently checked out)<br />
error: failed to push some refs to '/project/path'[/code]</p>
<p>Вообще почему она возникает-то? Разве гит это не распределенная система контроля версий? Распределенная и даже чутка децентрализованная. Совсем-совсем распределенная. А это значит, что пушить изменения можно не только на одно хранилище, а вообще в любой репозитарий. Хоть чуваку за соседний комп. Таким образом разработчикии могут делиться своими наработками.</p>
<p>Но это подразумевает один нюанс: нельзя пушить в ту ветку удаленного репозитария с которой сейчас идет работа.</p>
<p>Суть сообщения в том, что в удаленном репозитарии ветвь, которую мы хотим запушить сейчас, активна (т.е. сделан чекаут на удаленной машине).</p>
<p>А значит и правки в эту ветвь якобы удаленной машиной вносятся (слава роботам!).</p>
<p>Способ первый. Мы заходим в репозитарий и просто чекаутим другую ветку проекта. Профит. :)</p>
<p>Способ второй. Мы узнаем, что существует два типа хранилищ: bare и non bare. Дефолтно при выполнении git init будет создано хранилище второго типа (и при чекауте чужого репощитария так же создается локальный non-bare репозитарий).</p>
<p>Bare значит, то это не рабочий репозитарий, а просто склад веток, куда каждый может пушить. И если мы попробуем поработать с ним напрямую (покоммитить), то нас ждет облом.</p>
<p>Гитхаб предоставляет хранилища именно такого типа.</p>
<p>Второй же тип - это репозитарии разработчика. Активная в данный момент ветвь блокируется на изменение от нелокальных клиентов.</p>
<p>А что делать?</p>
<p>Если реп у нас удаленный и для совместной работы - конвертируем его в bare</p>
<p>[code lang="shell"]git config --bool core.bare true[/code]</p>
<p>Если нет - смотрим выше.</p>
<p>А еще можно сказать иниту, чтобы создавал bare сразу.</p>
<p>[code]git init --bare[/code]</p>
