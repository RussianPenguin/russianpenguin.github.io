---
layout: post
title: 'Python3: feedparser unicode error'
date: 2015-01-28 00:15:51.000000000 +03:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Разработка
tags:
- python
meta:
  _wpcom_is_markdown: '1'
  sharing_disabled: '1'
  _wpas_skip_facebook: '1'
  _wpas_skip_google_plus: '1'
  _wpas_skip_twitter: '1'
  _wpas_skip_linkedin: '1'
  _wpas_skip_tumblr: '1'
  _wpas_skip_path: '1'
  _publicize_pending: '1'
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _edit_last: '13696577'
author:
  login: russianpenguin
  email: maksim.v.zubkov@gmail.com
  display_name: russianpenguin
  first_name: Maksim
  last_name: Zubkov
permalink: "/2015/01/28/python3-feedparser-unicode-error/"
---
<p>Есть расширение <a title="Universal feed parser" href="http://pythonhosted.org/feedparser/">universal feed parser</a> и есть у него одна очень неприятная <a title="Python feedparser: Issue 403" href="https://code.google.com/p/feedparser/issues/detail?id=403">бага</a>: если установлено расширение chardet, то парсинг лент в юникоде ломается.</p>
<p>[code]$ ./rss.py                                                                                                                                                                     Traceback (most recent call last):<br />
File &quot;./rss.py&quot;, line 11, in &lt;module&gt;<br />
feed = feedparser.parse(rss_response.text)<br />
File &quot;/usr/lib/python3.3/site-packages/feedparser.py&quot;, line 3966, in parse<br />
data, result['encoding'], error = convert_to_utf8(http_headers, data)<br />
File &quot;/usr/lib/python3.3/site-packages/feedparser.py&quot;, line 3768, in convert_to_utf8<br />
chardet_encoding = str(chardet.detect(data)['encoding'] or '', 'ascii', 'ignore')<br />
TypeError: decoding str is not supported[/code]</p>
<p>Неприятно. Можно удалить chardet, но тогда другие расширения, которые от него зависят будут удалены. В том числе и <a title="requests" href="http://www.python-requests.org/en/latest/">requests</a>.</p>
<p>Значит надо чинить. Но поскольку баг пофикшен только в транке, а текущая стейбл 5.1.3, то надо обновляться из транка.</p>
<p>[code lang="shell"]$ sudo python3-pip install git+https://code.google.com/p/feedparser/ --upgrade[/code]</p>
<p>Или накатить <a title="Feedparser unicode+chardet fix" href="https://code.google.com/p/feedparser/issues/attachmentText?id=403&amp;aid=4030000000&amp;name=feedparser.patch&amp;token=ABZ6GAcpVSaLcr3xuUIcLCLJ2W9HJATMAQ%3A1422388699363">патч</a> руками.</p>
