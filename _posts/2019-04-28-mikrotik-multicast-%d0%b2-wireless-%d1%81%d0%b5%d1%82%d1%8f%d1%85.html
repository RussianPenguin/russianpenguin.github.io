---
layout: post
title: 'Mikrotik: multicast в wireless-сетях'
date: 2019-04-28 18:33:54.000000000 +03:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- HowTo
- linux
tags:
- avahi
- mikrotik
- сеть
meta:
  _wpcom_is_markdown: '1'
  timeline_notification: '1556465638'
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _publicize_job_id: '30247836362'
author:
  login: russianpenguin
  email: maksim.v.zubkov@gmail.com
  display_name: russianpenguin
  first_name: Maksim
  last_name: Zubkov
permalink: "/2019/04/28/mikrotik-multicast-%d0%b2-wireless-%d1%81%d0%b5%d1%82%d1%8f%d1%85/"
excerpt: Если у вас роутер mikrotik и вы хотите использовать udp-multicast в беспроводной
  сети, то нужно выполнить  дополнительную настройку интерфейса.
---
<p><img class=" size-thumbnail wp-image-2472 alignleft" src="{{ site.baseurl }}/assets/images/2019/04/mikrotik-rb951g-2hnd.png?w=150" alt="Mikrotik-RB951G-2HnD" width="150" height="103" />Кратко: если у вас роутер mikrotik и вы хотите использовать udp-multicast в беспроводной сети, то надо включить опцию multicast helper в настройках интерфейса. Если этого не сделать, то пакеты будут теряться. А дальше мы посмотрим как можно диагностировать подобную ситуацию.</p>
<p>Обновил я свой роутер до mikrotik (оказалась очень удобная штука). В моей локальной сети для всяких разных iot был настроен zeroconfig <a href="http://russianpenguin.ru/2016/04/08/%d0%ba%d0%b0%d0%ba-%d0%b6%d0%b8%d1%82%d1%8c-%d0%b2-%d0%bb%d0%be%d0%ba%d0%b0%d0%bb%d1%8c%d0%bd%d0%be%d0%b9-%d1%81%d0%b5%d1%82%d0%b8-%d0%b1%d0%b5%d0%b7-dns/">по собственному мануалу.</a> И тут что-то пошло не так.</p>
<p>Выражалось это все тем, что мультикаст с запросом адреса есть, а мультикаст-ответа нет. При этом машина, которой этот запрос предназначался, отвечала. Или ответ приходил, но спустя пол минуты или больше.</p>
<p>Мы можем эту итуацию наблюдать на скриншоте wireshark ниже.<img class=" size-full wp-image-2469 aligncenter" src="{{ site.baseurl }}/assets/images/2019/04/wireshark.png" alt="wireshark.png" width="1895" height="483" />Рассмотрим на примере хоста diskstation.local.</p>
<p>На нем я смотрел в tcpdump и видел, что ответ есть.</p>
<p>[code lang="shell"]# tcpdump port mdns<br />
...<br />
18:04:29.405838 IP6 fe80::e3de:bf6f:105e:ad4d.mdns &gt; ff02::fb.mdns: 0 [2q] A (QM)? diskstation.local. AAAA (QM)? diskstation.local. (41)<br />
18:04:29.405885 IP 192.168.88.252.mdns &gt; 224.0.0.251.mdns: 0 [2q] A (QM)? diskstation.local. AAAA (QM)? diskstation.local. (41)<br />
18:04:29.406152 IP6 fe80::211:32ff:fe80:3eb5.mdns &gt; ff02::fb.mdns: 0*- [0q] 1/0/0 (Cache flush) AAAA fe80::211:32ff:fe80:3eb5 (57)<br />
18:04:29.406388 IP diskstation.lan.mdns &gt; 224.0.0.251.mdns: 0*- [0q] 2/0/0 (Cache flush) AAAA fe80::211:32ff:fe80:3eb5, (Cache flush) A 192.168.88.250 (73)[/code]</p>
<p>Интернеты не смотгли дать вразумительного ответа почему так происходит. Была лишь одна зацепка - это разбор проблем с вещанием iptv. И именно там я встретил заметку о том, что гоже было бы включить multicast helper в настройках интерфейса wifi (предварительно нажать advanced settings).</p>
<p><img class=" size-full wp-image-2471 aligncenter" src="{{ site.baseurl }}/assets/images/2019/04/wifi-config.png" alt="wifi-config.png" width="566" height="235" /></p>
