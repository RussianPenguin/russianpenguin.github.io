---
layout: post
title: Tmux - лучшая альтернатива screen
date: 2015-04-02 16:43:09.000000000 +03:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories: []
tags:
- linux
meta:
  _wpcom_is_markdown: '1'
  sharing_disabled: '1'
  _publicize_pending: '1'
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
author:
  login: russianpenguin
  email: maksim.v.zubkov@gmail.com
  display_name: russianpenguin
  first_name: Maksim
  last_name: Zubkov
permalink: "/2015/04/02/tmux-%d0%bb%d1%83%d1%87%d1%88%d0%b0%d1%8f-%d0%b0%d0%bb%d1%8c%d1%82%d0%b5%d1%80%d0%bd%d0%b0%d1%82%d0%b8%d0%b2%d0%b0-screen/"
---
<p>Довольно долго пытался пересесть с GNU Screen на tmux, но вот только сдерживало несколько вещей в нем.<br />
На <a title="tmux is a terminal multiplexer" href="http://tmux.sourceforge.net/">сайте</a> проекта можно найти описание всех фич, я же опишу лишь те, которые для меня оказались самыми полезными.</p>
<ul>
<li><strong>Улучшенная модель отрисовки</strong> (да-да screen периодически подключивал)</li>
<li><strong>Содержимое терминала не теряется, когда мып ользуемся редакторами</strong> (открыли vim, закрыли, история осталась а месте и можно прокрутить до нее)</li>
<li><strong>Конфигурирование на лету</strong></li>
</ul>
<h3>C-b</h3>
<p>Ага. Это сочетание клавишь из vim.</p>
<p>Переключим tmux на работу с C-a</p>
<p>[code]set-option -g prefix C-a[/code]</p>
<h3>Задержка между контрольными клавишами C-b и непосредственным вводом команды (например n).</h3>
<p>Решается просто</p>
<p>[code]set -s escape-time 0[/code]</p>
<h3>Сочетание клавиш для управления tmux внутри tmux</h3>
<p>Бывает такое, что приходится внутри tmux запустить вложенную сессию tmux. Значит надо как-то пробросить этой вложенной сессии команды. Например <strong>C-a a <em>command</em></strong></p>
<p>[code]bind-key a send-prefix[/code]</p>
<h3>Начинаме считать окна с 1, а не 0</h3>
<p>Это удобно, так как 0 находится где-то на отшибе. И к нему надо тянуться.</p>
<p>[code]set -g base-index 1[/code]</p>
<h3>Агрессивный ресайз терминалов</h3>
<p>Дефолтно при подключении к сессии нескольких клиентов рамер окна выбирается по размеру самого маленького клиента. Это неинтересно. Поэтому позволим терминалу для каждого клиента иметь собственный размер.</p>
<p>[code]setw -g aggressive-resize on[/code]</p>
<h3>После завершения команды можно ввести другую команду не нажимая C-b</h3>
<p>Для меня эта проблема была самой неприятно. Воспроизвести ее просто: нужно на готом tmux создать два региона.</p>
<p>[code]C-b &quot;[/code]</p>
<p>А затем переключаться между ними.</p>
<p>[code]C-b Up Down Up Down[/code]</p>
<p>Вы заметите, что нажав один раз C-b, а потом быстро нажимая вверх-вниз окна переключаются.</p>
<p>Это неприятно когда пытаешься переключить вкладку и начать тут же вводить что-то.</p>
<p>За такое поведение отвечает repeat-time</p>
<p>[code]repeat-time time<br />
  Allow multiple commands to be entered without pressing<br />
  the prefix-key again in the specified time milliseconds<br />
  (the default is 500).  Whether a key repeats may be set<br />
  when it is bound using the -r flag to bind-key.  Repeat<br />
  is enabled for the default keys bound to the resize-pane<br />
  command.[/code]</p>
<p>Можно отключить repeat для команд переключения между панелями и окнами просто переобъявив команду без флага -r. Например так:</p>
<p>[code]bind-key Up select-pane -U[/code]</p>
<p>Но я же предпочитаю эту фичу отключить вовсе.</p>
<p>[code]set-option -g repeat-time 0[/code]</p>
<h3>Базовый ~/.tmux.conf</h3>
<p>[code]# C-b не подходит - так как используется в vim<br />
set-option -g prefix C-a<br />
bind-key C-a last-window</p>
<p># Начинам нумерацию окон с 1<br />
set -g base-index 1</p>
<p># Добавляем отзывчивости в реакции на команды<br />
set -s escape-time 0</p>
<p># Отключаем ожидание дополнительных команд<br />
set-option -g repeat-time 0</p>
<p># Или можно забиндить команды отдельно отключая repeat только для нужных<br />
#bind-key Up select-pane -U</p>
<p># Цветовая схема<br />
set -g status-bg black<br />
set -g status-fg white<br />
set -g status-left &quot;&quot;<br />
set -g status-right &quot;#[fg=green]#H&quot;</p>
<p># Ресайзим содержимое окна индивидуально для каждого клиента<br />
setw -g aggressive-resize on</p>
<p># Позволим пробрасывать команды внутрь вложенной сессии tmux<br />
# при помощи  C-a a &lt;command&gt;<br />
bind-key a send-prefix</p>
<p># Мониторинг активности<br />
#setw -g monitor-activity on<br />
#set -g visual-activity on</p>
<p># Пример использования команды оболочки в статусной строке<br />
#set -g status-right &quot;#[fg=yellow]#(uptime | cut -d ',' -f 2-)&quot;</p>
<p># Подсвечиваем активное окно<br />
set-window-option -g window-status-current-bg green[/code]</p>
<p>За кадром осталось использование <a title="Tmuxinator" href="https://github.com/tmuxinator/tmuxinator">tmuxinator</a> для запуска tmux c определенной заранее раскладкой окон.</p>
<p>Ну и еще про настройку можно почитать в <a title="ArchWiki: Tmux" href="https://wiki.archlinux.org/index.php/Tmux">Arch-wiki</a>.</p>
