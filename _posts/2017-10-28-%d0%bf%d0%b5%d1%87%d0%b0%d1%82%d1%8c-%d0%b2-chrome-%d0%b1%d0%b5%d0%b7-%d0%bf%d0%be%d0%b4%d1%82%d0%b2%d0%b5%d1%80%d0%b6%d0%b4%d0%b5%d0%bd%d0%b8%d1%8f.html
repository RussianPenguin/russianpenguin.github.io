---
layout: post
title: Печать в Chrome без подтверждения
date: 2017-10-28 01:23:53.000000000 +03:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Разработка
- HowTo
tags:
- chrome
- javascript
- web
meta:
  _wpcom_is_markdown: '1'
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _publicize_job_id: '10807734000'
author:
  login: russianpenguin
  email: maksim.v.zubkov@gmail.com
  display_name: russianpenguin
  first_name: Maksim
  last_name: Zubkov
permalink: "/2017/10/28/%d0%bf%d0%b5%d1%87%d0%b0%d1%82%d1%8c-%d0%b2-chrome-%d0%b1%d0%b5%d0%b7-%d0%bf%d0%be%d0%b4%d1%82%d0%b2%d0%b5%d1%80%d0%b6%d0%b4%d0%b5%d0%bd%d0%b8%d1%8f/"
excerpt: Небольшая заметка как заставить chrome печатать документы автоматически.
  Полезно для pos-терминалов.
---
<p><img class="alignleft size-medium wp-image-2348" src="{{ site.baseurl }}/assets/images/2017/10/d181d0bdd0b8d0bcd0bed0ba-d18dd0bad180d0b0d0bdd0b0-d0bed182-2017-10-28-01-07-21.png?w=300" alt="Снимок экрана от 2017-10-28 01-07-21" width="300" height="237" />Существует задача для pos-систем печатать что-либо автоматически: чеки, квитанции и т.п. Хочется, чтобы печать можно было инициировать из скриптов, но по дефолту все браузеры показывают диалог печати или предварительный просмотр.</p>
<p>Это неудобно при создании киосков.</p>
<p>Казалось бы уже неоднократно с таким сталкивались и должны были придумать подходящее решение. Но, увы, решение есть, а все советы о том, как его использовать даже на официальных форумах браузеров некорректны.</p>
<p>Что нам предлагают:</p>
<ul>
<li>Использовать опцию --disable-print-preview (или включать аналогичную настройку в about:flags)</li>
<li>Вместе с ней включать опцию --kiosk-printing, которая в теории должна избавить нас от диалога выбора принтера.</li>
</ul>
<p>А вот и нет. Эти опции нельзя использовать совместно. В чем суть: --disable-print-preview передает управление на диалог выбора принтера в системе, а это лишает нас контроля над выбором пользователя. Во многих (во всех) конфигурациях windows и linux нельзя избавиться от шага выбора принтера, а предварительный просмотр в хроме подменяет диалог выбора принтера.</p>
<p>Опция --kiosk-printing воздействует только на диалог предварительного просмотра chrome сразу печатая просматриваемый документ, а если мы его отключим, то и смысла в установке этого параметра нет.</p>
<p>Отсюда вывод: если вы хотите делать автоматическую печать, то используйте только --kiosk-printing.</p>
<p>Из минусов стоит отметить, что окошко предварительного просмотра все же на некоторое мгновение появляется на экране.</p>
<p>[code lang="html"]&lt;!DOCTYPE html&gt;<br />
&lt;html&gt;<br />
&lt;head&gt;<br />
&lt;title&gt;autoprint&lt;/title&gt;<br />
&lt;/head&gt;<br />
&lt;body&gt;<br />
data<br />
&lt;script&gt;<br />
    window.addEventListener('load', function() {<br />
      window.print()<br />
    })<br />
  &lt;/script&gt;<br />
&lt;/body&gt;<br />
&lt;/html&gt;[/code]</p>
<p>И это сработает - принтер начнет печатать.</p>
<p><strong>UPD:</strong></p>
<p><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=169004">Chromium, issue 169004: баг с окном предварительного просмотра в режиме kiosk-printing (непофикшено)</a></p>
