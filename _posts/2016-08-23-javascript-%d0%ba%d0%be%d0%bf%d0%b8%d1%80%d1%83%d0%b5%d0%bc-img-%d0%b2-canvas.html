---
layout: post
title: 'JavaScript: копируем img в canvas'
date: 2016-08-23 22:28:03.000000000 +03:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Обработка изображений
- Разработка
tags:
- javascript
meta:
  _wpcom_is_markdown: '1'
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _publicize_job_id: '26077762883'
author:
  login: russianpenguin
  email: maksim.v.zubkov@gmail.com
  display_name: russianpenguin
  first_name: Maksim
  last_name: Zubkov
permalink: "/2016/08/23/javascript-%d0%ba%d0%be%d0%bf%d0%b8%d1%80%d1%83%d0%b5%d0%bc-img-%d0%b2-canvas/"
---
<p>Существует несколько способов скопировать имеющееся на странице изображение (img) в canvas. Конечно все они сводятся к простейшему drawImage, но каждый из этих методов применим в своем контексте.</p>
<p>Первый и самый очевидный (а еще универсальный) - загрузить изображение при помощи объекта Image. Он работает только в случае, когда у img есть атрибут src.</p>
<p>[code lang="javascript"]var img = new Image();<br />
var srcImg = document.getElementById('src-img');<br />
img.onload = function() {<br />
    // создаем (или получаем) канву<br />
    var backCanvas = document.getElementById('dest-canvas');<br />
    backCanvas.width = this.width;<br />
    backCanvas.height = this.height;<br />
    var backCtx = backCanvas.getContext('2d');</p>
<p>    // рисуем<br />
    backCtx.drawImage(this, 0,0);<br />
};<br />
img.setAttribute('src', srcImg.src);[/code]</p>
<p>Недостаток - еще один запрос в сеть.</p>
<p>Второй способ - менее универсален. Картинка у нас уже есть - почему ее нельзя нарисовать на канве?</p>
<p>[code lang="javascript"]var backCanvas = document.getElementById('dest-canvas');<br />
var srcImg = document.getElementById('src-img');<br />
backCanvas.width = srcImg.naturalWidth;<br />
backCanvas.height = srcImg.naturalHeight;</p>
<p>var backCtx = backCanvas.getContext('2d');</p>
<p>// рисуем картинку<br />
backCtx.drawImage(srcImg, 0,0);[/code]</p>
<p>И вот тут мы используем naturalWidth/naturalHeight. Зачем?</p>
<p>Все очень просто. Если в первом случае width и height означали размеры картинки, то во втором - это будут физические размеры элемента img на странице. И если картинка внутри него будет отмасштабирована, то мы мы скопируем только часть картинки размером width на height.</p>
<p>Как на иллюстрации ниже (картинка там имеет разрешение в десять раз больше нежели физические размеры img и масштабируется).</p>
<p><img class=" size-full wp-image-1511 aligncenter" src="{{ site.baseurl }}/assets/images/2016/08/d0b2d18bd0b4d0b5d0bbd0b5d0bdd0b8d0b5_001.png" alt="Выделение_001" width="1258" height="489" /></p>
<p>А свойства naturalWidth/naturalHeight не поддерживаются в ряде браузеров. поэтому способ универсальным назвать нельзя.</p>
