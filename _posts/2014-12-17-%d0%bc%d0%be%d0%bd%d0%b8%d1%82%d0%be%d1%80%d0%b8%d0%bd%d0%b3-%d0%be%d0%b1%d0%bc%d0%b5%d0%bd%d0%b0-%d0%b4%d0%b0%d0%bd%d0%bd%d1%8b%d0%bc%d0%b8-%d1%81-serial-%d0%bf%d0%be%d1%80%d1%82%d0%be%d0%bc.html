---
layout: post
title: Мониторинг обмена данными с serial-портом
date: 2014-12-17 22:02:07.000000000 +03:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Разработка
tags:
- отладка
- python
meta:
  _wpcom_is_markdown: '1'
  sharing_disabled: '1'
  _wpas_skip_facebook: '1'
  _wpas_skip_google_plus: '1'
  _wpas_skip_twitter: '1'
  _wpas_skip_linkedin: '1'
  _wpas_skip_tumblr: '1'
  _wpas_skip_path: '1'
  _publicize_pending: '1'
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _edit_last: '13696577'
author:
  login: russianpenguin
  email: maksim.v.zubkov@gmail.com
  display_name: russianpenguin
  first_name: Maksim
  last_name: Zubkov
permalink: "/2014/12/17/%d0%bc%d0%be%d0%bd%d0%b8%d1%82%d0%be%d1%80%d0%b8%d0%bd%d0%b3-%d0%be%d0%b1%d0%bc%d0%b5%d0%bd%d0%b0-%d0%b4%d0%b0%d0%bd%d0%bd%d1%8b%d0%bc%d0%b8-%d1%81-serial-%d0%bf%d0%be%d1%80%d1%82%d0%be%d0%bc/"
---
<p>Иногда надо сниффать serial-порт на предмет того, что туда пишется/читается софтиной.<br />
Есть сниффер jpnevulator.</p>
<p>[code]jpnevulator --timing-print --tty /dev/ttyACM0[/code]</p>
<p>Но он не совсем удобен. Так как он не сниффер на смом деле, а простой ридер-писатель для порта.<br />
Поэтому если запустить его совместно с другой софтиной, то она данных на порту не увидит.</p>
<p>А нам нужен именно сниффер.</p>
<p>Можно создать виртуальный порт с помощью pyserial. И читать/писать данный и реального в виртуальный порт и наоборот (MITM), но стоит ли? :)</p>
<p>Воспользуемся strace!</p>
<p>[code language="shell"]$ strace -e trace=read,write python terminal.py<br />
# тут я вырезал кусок, который относится к питону<br />
write(3, &quot;P&quot;, 1)                        = 1<br />
write(3, &quot;P&quot;, 1)                        = 1<br />
read(3, &quot;P&quot;, 1)                         = 1<br />
read(3, &quot;;\26\225\320&#092;&#048;k,\r&#092;&#048;&quot;, 9)      = 9<br />
write(1, &quot;3B 16 95 D0 0 6B 2C D 0\n&quot;, 243B 16 95 D0 0 6B 2C D 0<br />
) = 24<br />
write(3, &quot;S\3\377&#092;&#048;\377&quot;, 5)            = 5<br />
read(3, &quot;\377&#092;&#048;\377&quot;, 3)                = 3<br />
write(1, &quot;FF 0 FF\n&quot;, 8FF 0 FF<br />
)                = 8<br />
write(3, &quot;S\5\240\244&#092;&#048;&#092;&#048;\2&quot;, 7)        = 7<br />
read(3, &quot;\244&quot;, 1)                      = 1<br />
write(3, &quot;S\2?&#092;&#048;&quot;, 4)                   = 4<br />
read(3, &quot;\237#&quot;, 2)                     = 2<br />
write(1, &quot;9F 23\n&quot;, 69F 23<br />
)                  = 6<br />
write(3, &quot;S\5\240\300&#092;&#048;&#092;&#048;#&quot;, 7)         = 7<br />
read(3, &quot;\300&#092;&#048;&#092;&#048;Z&#092;&#048;?&#092;&#048;\1&#092;&#048;&#092;&#048;&#092;&#048;&#092;&#048;&#092;&#048;\26\263\3\7\4&#092;&#048;\203\212\203\212&#092;&#048;\3&#092;&#048;&#092;&#048;Z&#092;&#048;&#092;&#048;&#092;&#048;Z&quot;..., 38) = 38<br />
write(1, &quot;C0 0 0 5A 0 3F 0 1 0 0 0 0 0 16 &quot;..., 89C0 0 0 5A 0 3F 0 1 0 0 0 0 0 16 B3 3 7 4 0 83 8A 83 8A 0 3 0 0 5A 0 0 0 5A 0 2F 6 2 90 0<br />
) = 89<br />
write(3, &quot;H&quot;, 1)                        = 1<br />
+++ exited with 0 +++[/code]</p>
<p>И вот уже вожделенный протокол обмена на экране. :)</p>
