---
layout: post
title: 'Android Studio: на устройстве не осталось свободного места'
date: 2018-05-09 14:39:07.000000000 +03:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Разработка
- HowTo
tags:
- android
- java
- linux
meta:
  _wpcom_is_markdown: '1'
  timeline_notification: '1525865950'
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _publicize_job_id: '17656227117'
author:
  login: russianpenguin
  email: maksim.v.zubkov@gmail.com
  display_name: russianpenguin
  first_name: Maksim
  last_name: Zubkov
permalink: "/2018/05/09/android-studio-%d0%bd%d0%b0-%d1%83%d1%81%d1%82%d1%80%d0%be%d0%b9%d1%81%d1%82%d0%b2%d0%b5-%d0%bd%d0%b5-%d0%be%d1%81%d1%82%d0%b0%d0%bb%d0%be%d1%81%d1%8c-%d0%bc%d0%b5%d1%81%d1%82%d0%b0/"
excerpt: Заметка рассказывает о том, как избавиться от ошибки "на устройстве недостаточно
  свободного места" при обновлении AndroidStudio
---
<p><img class="alignleft size-medium wp-image-2422" src="{{ site.baseurl }}/assets/images/2018/05/2018-05-09-134805_911x394.png?w=300" alt="2018-05-09-13:48:05_911x394" width="300" height="130" />Кто из вас не сталкивался с этим сообщением при обновлении студии под linux? Пожалуй каждый, кому доводилось с ней работать эту ошибку уже видел хотя бы раз и спешно шел в гугель для поиска ответа на вопрос что же ей не нравится и как это фиксить.</p>
<p>[code]java.io.IOException: На устройстве не осталось свободного места[/code]</p>
<p>[code]java.io.IOException: No space left on device[/code]</p>
<p>И так каждый раз. А вся проблема в том, что студия использует /tmp для распаковки установочных архивов перед копированием.</p>
<p>И чаще всего места там катастрофически недостает.</p>
<p>[code lang="shell"]$ df -h |grep \/tmp<br />
tmpfs 3,9G 455M 3,4G 12% /tmp[/code]</p>
<p>Во многих дистрибутивах размер раздела выставляется равным половине объема озу. Решений несколько и каждый применяет то, которое ему нравится больше.</p>
<p><!--more--></p>
<h2>Временное увеличение размера /tmp</h2>
<p>[code lang="shell"]$ sudo mount -o remount,size=8G,noatime /tmp[/code]</p>
<p>Чем плохо: система активно начнем использовать подкачку и ей может просто не хватить суммарного объема свопа и ram.</p>
<h2>Переназначение временной директории для студии</h2>
<p><img class=" size-full wp-image-2423 aligncenter" src="{{ site.baseurl }}/assets/images/2018/05/d0b2d18bd0b4d0b5d0bbd0b5d0bdd0b8d0b5_002.png" alt="Выделение_002" width="445" height="545" /></p>
<p>В открывшийся файл дописываем указание временной директории для виртуальной машины.</p>
<p>[code]-Djava.io.tmpdir=/path-to-tmp-dir[/code]</p>
<p>Минус подхода: вся инфраструктура будет использовать эту временную директорию (компиляция, запуск и прочее), что приведет к замедлению работы если директория находится на диске (и неважно ssd это или hdd).</p>
<p>А еще все настройки будут теряться при обновлении студии (они хранятся в каталоге с настройками студии.</p>
<p>Есть другой вариант, позволяющий вынести настройки в глобальную область.</p>
<p>[code lang="shell"]echo "-Djava.io.tmpdir=/tmp-dir-path" &gt; ~/android-studio-tmp.fix<br />
STUDIO_VM_OPTIONS=~/android-studio.fix android-studio[/code]</p>
<h2>Указать временную директорию для всех приложений java</h2>
<p>Прописать в .bashrc</p>
<p>[code lang="shell"]export _JAVA_OPTIONS=-Djava.io.tmpdir=/path-to-tmp-dir[/code]</p>
<p>Это наименее разумный способ - он заставит абсолютно все java-приложения использовать указанную директорию.</p>
<h2>Указать отдельное размещение для распаковки временных файлов в момент установки</h2>
<p>[code lang="shell"]$ cd ~<br />
$ mkdir -p tmp/PackageOperation04<br />
$ cd /tmp<br />
$ ln -s $HOME/tmp/PackageOperation04[/code]</p>
<p>Самый разумный способ, имхо. Делать это нужно непосредственно перед тем, как вы нажмете кнопку "обновить".</p>
<h2>Литература</h2>
<ul>
<li><a href="https://developer.android.com/studio/intro/studio-config.html">Configure Android Studio</a></li>
<li><a href="https://stackoverflow.com/questions/38057884/tmp-directory-in-linux-android-sdk">SO: /tmp directory in Linux Android SDK</a></li>
<li><a href="https://www.redips.net/linux/android-studio-no-space-left-on-device/">Android Studio – No space left on device</a></li>
<li><a href="https://bytefreaks.net/applications/android-studio-no-space-left-on-device">Android Studio – No space left on device</a></li>
</ul>
