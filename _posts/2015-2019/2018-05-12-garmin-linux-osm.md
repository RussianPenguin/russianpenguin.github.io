---
layout: post
title: 'Garmin в Linux: загрузка карт OSM'
type: post
categories:
- HowTo
tags:
- навигация
- linux
- wine
permalink: "/2018/05/12/garmin-%d0%b2-linux-%d0%b7%d0%b0%d0%b3%d1%80%d1%83%d0%b7%d0%ba%d0%b0-%d0%ba%d0%b0%d1%80%d1%82-osm/"
excerpt: Разбираемся как загружать карты osm в навигаторы garmin в линуксе. Используем
  для этого MapSource под wine.
---
![2018-05-12-15:21:02_1485x851]({{ site.baseurl }}/assets/images/2018/05/2018-05-12-152102_1485x851.png){:.img-fluid}

Долгое время считалось, что загрузка карт в гарминовские навигаторы - это очень сложный процесс (на самом деле так и есть, особенно если вы подготавливаете карты вручную).

Но оказалось, что загружать карты все же возможно и можно делать это достаточно быстро. Нам потребуется wine, mapsource и дампы карты проекта [gis-lab](http://garmin.gis-lab.info/).

<!--more-->

## Установка wine

Тут ничего сложного.

```shell
$ sudo dnf install wine
```

## Установка MapSource

Тут сложнее - установочный пакет версии 6163 с официального сайта вызывает ошибку о том, что он уже нашел установленный mapsource.

![2018-05-12-13:33:04_661x512]({{ site.baseurl }}/assets/images/2018/05/2018-05-12-133304_661x512.png){:.img-fluid}

Поэтому требуется найти MapSource_6153.exe на сайте [http://gawisp.com/perry/mapsource/](http://gawisp.com/perry/mapsource/) и поставить его. После завершения установки инсталлятор попросит разрешения запустить софтину - не соглашайтесь, так как у вас нет еще установленных карт и запуск будет неудачным.

Кстати, по окончанию процесса можно будет установить обновление прямо из меню (раздел справка->проверка обновлений). Это будет обновление до последней версии, которое пройдет успешно.

## Установка карт

Скачиваем интересующие нас регионы со [страницы проекта](http://garmin.gis-lab.info/). После распаковки в какой-либо каталог (например ~/maps) каждого архива запускаем последовательно в распакованных папках

```shell
$ wineconsole install.bat
```

## Подключение навигатора

Рассматривать будем только современные навигаторы, которые подключаются как usb-диск. Для старших моделей, которые подключаются по ком-порту можно почитать подробную [инструкцию](https://ubuntuforums.org/showthread.php?t=1483930).

В случае с garmin mass storage нужно сделать так, чтобы подмонтированное устройство распознавалось как флоппи-диск.

- Подключаем навигатор
- Монтируем его и запускаем winecfg
- В разделе диски нужно создать новый диск, который будет ссылаться на подмонтированное устройство и в разделе дополнительных опций указать тип диска "флоппидиск".

![2018-05-12-16:10:52_456x536]({{ site.baseurl }}/assets/images/2018/05/2018-05-12-161052_456x536.png){:.img-fluid}

При этом удалять или изменять то, что система определила автоматически (в моем случае это диск D:) не стоит - настройки не будет сохраняться. Нужно создать точку монтирования вручную.

## Загрузка карт

Запускаем из меню MapSoutce

- В списке карт выбираем нужную нам карту
- При помощи инструмента карты выбираем нужный регион и убеждаемся, что он попал в список выгружаемых карт (вкладка карты)
- Повторяем шаги для оставшихся карт

![2018-05-12-16:17:10_1480x862.png]({{ site.baseurl }}/assets/images/2018/05/2018-05-12-161710_1480x862.png){:.img-fluid}

![2018-05-12-16:18:39_512x731]({{ site.baseurl }}/assets/images/2018/05/2018-05-12-161839_512x731.png){:.img-fluid}

Как только все карты будут добавлены можно идти в меню передача->передать на устройство. И выгружать данные.

![2018-05-12-16:18:52_293x347]({{ site.baseurl }}/assets/images/2018/05/2018-05-12-161852_293x347.png){:.img-fluid}

## Литература

- [Running Garmin Mapsource (6137) under Ubuntu with GPS access](https://ubuntuforums.org/showthread.php?t=1483930)
- [Connect Garmin GPS to MapSource](https://ubuntuforums.org/showthread.php?t=1793977)
- [Send maps with Basecamp (Mapinstall) or Mapsource](https://openmtbmap.org/tutorials/send_maps/)
