---
layout: post
title: 'AngularJS: сервисы, фабрики, провайдеры'
date: 2016-02-03 23:14:22.000000000 +03:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Разработка
tags:
- angularjs
- javascript
meta:
  _wpcom_is_markdown: '1'
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _publicize_job_id: '19434069383'
author:
  login: russianpenguin
  email: maksim.v.zubkov@gmail.com
  display_name: russianpenguin
  first_name: Maksim
  last_name: Zubkov
permalink: "/2016/02/03/angularjs-%d1%81%d0%b5%d1%80%d0%b2%d0%b8%d1%81%d1%8b-%d1%84%d0%b0%d0%b1%d1%80%d0%b8%d0%ba%d0%b8-%d0%bf%d1%80%d0%be%d0%b2%d0%b0%d0%b9%d0%b4%d0%b5%d1%80%d1%8b/"
---
<p>Чтоже это за странные service, factory и provider. Казалось бы - выполняют почти одну и туже функцию, подключаются через DI. Зачем их так много?</p>
<p>На абстрактный пример можно глянуть <a href="http://stepansuvorov.com/blog/2013/03/angularjs-%D1%87%D0%B5%D0%BC-%D0%BE%D1%82%D0%BB%D0%B8%D1%87%D0%B0%D0%B5%D1%82%D1%81%D1%8F-provider-factory-%D0%B8-service/">тут</a> (к слову, автор привел очень хороший пример).</p>
<p>Но никто не рассказывает, зачем оно в реальной практике нужно.</p>
<p><strong>Сервис</strong></p>
<p>Он чаще всего используется для создания разделяемого ресурса.</p>
<p>[code source="javascript"]var constructor = function constructor() {<br />
    this.foo = 'foo'<br />
    this.bar = function bar() {</p>
<p>    }<br />
}</p>
<p>.service('someService', constructor)[/code]</p>
<p>Когда сервис создается первый раз, то выполняется</p>
<p>[code source="javascript"]var someServiceImpl = new constructor()[/code]</p>
<p>И в дальнейшем при подключении зависимостей через DI в объекты будет всегда передаваться someServiceImpl.</p>
<p><strong>Фабрика</strong><br />
это более продвинутая конструкция. Она не является разделяемым ресурсом сама по себе. При каждом использовании фабрики через DI ее значение - это результат вызова фабричной функции.<br />
[code source="javascript"]var factoryFn = function () {<br />
    var someClass = function() {}</p>
<p>    return someClass;<br />
}</p>
<p>.factory('someFactory', factoryFn)[/code]</p>
<p>При первом инстанцировании фабрики будет вызвана функция factoryFn и ее результат - это уже и есть разделяемое между всеми участниками системы значение.</p>
<p>Свое применения фабрика находит в первую очередь для реализации моделей. Как в примере выше. Создается и описывается класс модели someClass и фабрика при инстанцировании возвращает ссылку на него. В последующем можно использовать этот класс как конструктор объектов.</p>
<p>[code source="javascript"].controller('someController', ['someFactory', function(someFactory) {<br />
    // Тут мы успешно инстанцируем новый объект someClass<br />
    var someClassImpl = new someFactory();<br />
}])[/code]</p>
<p><strong>Провайдер</strong><br />
Это тоже фабрика. Но более продвинутаця. Так же точно при первом инстанцировании провайдера выполняется некая функция и ее результат становится разделяемым значением.</p>
<p>Но вся мощь провайдеров в том, что их можно конфигурировать (в отличие от фабрик или сервисов). Т.е. на этапе инициализации вашего приложения можно передать провайдеру некоторые опции, которые нельзя указать в дальнейшем.</p>
<p>Как пример - библиотека для oauth-авторизации. на этапе конфигурирования в нее передаются токены.</p>
<p>[code source="javascript"]var providerFn = function() {<br />
    var someModel = function() {<br />
        // это модель<br />
    }</p>
<p>    this.configure = function() {<br />
        // делаем какую-то конфигурацию<br />
    }</p>
<p>    this.$get = function() {<br />
        return new someModel()<br />
    }<br />
}</p>
<p>.provider('someProvider', providerFn)[/code]</p>
<p>И теперь самое интересное: при подключении провайдера через DI в качестве разделяемого объекта будет выступать то, что вернула функция $get.</p>
<p>В то же время на этапе конфигурирования нам доступен сам инстанс providerFn и мы можем использовать его функционал по конфигурированияю</p>
<p>[code source="javascript"].config(['someProvider', function(someProvider) {<br />
    //...<br />
    someProvider.configure(options)<br />
}])[/code]</p>
