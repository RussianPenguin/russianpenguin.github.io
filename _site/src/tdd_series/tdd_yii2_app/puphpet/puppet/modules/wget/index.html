<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta name="yandex-verification" content="551ffc5ae1433df6" />
    
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Чтобы не забыть | Записная книжка рассеянного [в пространстве и времени] программиста</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Чтобы не забыть" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Записная книжка рассеянного [в пространстве и времени] программиста" />
<meta property="og:description" content="Записная книжка рассеянного [в пространстве и времени] программиста" />
<link rel="canonical" href="http://localhost:4000/src/tdd_series/tdd_yii2_app/puphpet/puppet/modules/wget/" />
<meta property="og:url" content="http://localhost:4000/src/tdd_series/tdd_yii2_app/puphpet/puppet/modules/wget/" />
<meta property="og:site_name" content="Чтобы не забыть" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Чтобы не забыть" />
<script type="application/ld+json">
{"url":"http://localhost:4000/src/tdd_series/tdd_yii2_app/puphpet/puppet/modules/wget/","description":"Записная книжка рассеянного [в пространстве и времени] программиста","headline":"Чтобы не забыть","@type":"WebPage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/assets/css/style.css?v=d85e6f1917405784d52928d499ab3e51b4bffcc9">
  </head>
  <body>
    <header class="page-header" role="banner">
      <h1 class="project-name">Чтобы не забыть</h1>
      <h2 class="project-tagline">Записная книжка рассеянного [в пространстве и времени] программиста</h2>
      
        <a href="https://github.com/RussianPenguin/russianpenguin.github.io" class="btn">View on GitHub</a>
      
      
    </header>

    <main id="content" class="main-content" role="main">
      <p><a href="https://travis-ci.org/maestrodev/puppet-wget"><img src="https://travis-ci.org/maestrodev/puppet-wget.svg?branch=master" alt="Build Status" /></a>
<a href="https://forge.puppetlabs.com/maestrodev/wget"><img src="https://img.shields.io/puppetforge/v/maestrodev/wget.svg" alt="Puppet Forge" /></a>
<a href="https://forge.puppetlabs.com/maestrodev/wget"><img src="https://img.shields.io/puppetforge/f/maestrodev/wget.svg" alt="Puppet Forge" /></a>
<a href="https://forge.puppetlabs.com/maestrodev/wget"><img src="https://img.shields.io/puppetforge/e/maestrodev/wget.svg" alt="Puppet Forge" /></a></p>

<p>A Puppet module to download files with wget, supporting authentication.</p>

<h1 id="example">Example</h1>

<p>install wget:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">include</span> <span class="nc">wget</span>
</code></pre></div></div>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">wget::fetch</span> <span class="p">{</span> <span class="s2">"download Google's index"</span><span class="p">:</span>
      <span class="py">source</span>      <span class="p">=&gt;</span> <span class="s1">'http://www.google.com/index.html'</span><span class="p">,</span>
      <span class="py">destination</span> <span class="p">=&gt;</span> <span class="s1">'/tmp/'</span><span class="p">,</span>
      <span class="py">timeout</span>     <span class="p">=&gt;</span> <span class="m">0</span><span class="p">,</span>
      <span class="py">verbose</span>     <span class="p">=&gt;</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></div>
<p>or alternatively:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">wget::fetch</span> <span class="p">{</span> <span class="s1">'http://www.google.com/index.html'</span><span class="p">:</span>
      <span class="py">destination</span> <span class="p">=&gt;</span> <span class="s1">'/tmp/'</span><span class="p">,</span>
      <span class="py">timeout</span>     <span class="p">=&gt;</span> <span class="m">0</span><span class="p">,</span>
      <span class="py">verbose</span>     <span class="p">=&gt;</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>If <code class="language-plaintext highlighter-rouge">$destination</code> ends in either a forward or backward slash, it will treat the destination as a directory and name the file with the basename of the <code class="language-plaintext highlighter-rouge">$source</code>.</p>
<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">wget::fetch</span> <span class="p">{</span> <span class="s1">'http://mywebsite.com/apples'</span><span class="p">:</span>
    <span class="py">destination</span> <span class="p">=&gt;</span> <span class="s1">'/downloads/'</span><span class="p">,</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>Download from an array of URLs into one directory</p>
<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$manyfiles</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'http://mywebsite.com/apples'</span><span class="p">,</span>
    <span class="s1">'http://mywebsite.com/oranges'</span><span class="p">,</span>
    <span class="s1">'http://mywebsite.com/bananas'</span><span class="p">,</span>
  <span class="p">]</span>

  <span class="n">wget::fetch</span> <span class="p">{</span> <span class="nv">$manyfiles</span><span class="p">:</span>
    <span class="py">destination</span> <span class="p">=&gt;</span> <span class="s1">'/downloads/'</span><span class="p">,</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>This fetches a document which requires authentication:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">wget::fetch</span> <span class="p">{</span> <span class="s1">'Fetch secret PDF'</span><span class="p">:</span>
      <span class="py">source</span>      <span class="p">=&gt;</span> <span class="s1">'https://confidential.example.com/secret.pdf'</span><span class="p">,</span>
      <span class="py">destination</span> <span class="p">=&gt;</span> <span class="s1">'/tmp/'</span><span class="p">,</span>
      <span class="py">user</span>        <span class="p">=&gt;</span> <span class="s1">'user'</span><span class="p">,</span>
      <span class="py">password</span>    <span class="p">=&gt;</span> <span class="s1">'p$ssw0rd'</span><span class="p">,</span>
      <span class="py">timeout</span>     <span class="p">=&gt;</span> <span class="m">0</span><span class="p">,</span>
      <span class="py">verbose</span>     <span class="p">=&gt;</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>This caches the downloaded file in an intermediate directory to avoid
repeatedly downloading it. This uses the timestamping (-N) and prefix (-P)
wget options to only re-download if the source file has been updated.</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">wget::fetch</span> <span class="p">{</span> <span class="s1">'https://tool.com/downloads/tool-1.0.tgz'</span><span class="p">:</span>
      <span class="py">destination</span> <span class="p">=&gt;</span> <span class="s1">'/tmp/'</span><span class="p">,</span>
      <span class="py">cache_dir</span>   <span class="p">=&gt;</span> <span class="s1">'/var/cache/wget'</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>It’s assumed that the cached file will be named after the source’s URL
basename but this assumption can be broken if wget follows some redirects. In
this case you must inform the correct filename in the cache like this:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">wget::fetch</span> <span class="p">{</span> <span class="s1">'https://tool.com/downloads/tool-latest.tgz'</span><span class="p">:</span>
      <span class="py">destination</span> <span class="p">=&gt;</span> <span class="s1">'/tmp/tool-1.0.tgz'</span><span class="p">,</span>
      <span class="py">cache_dir</span>   <span class="p">=&gt;</span> <span class="s1">'/var/cache/wget'</span><span class="p">,</span>
      <span class="py">cache_file</span>  <span class="p">=&gt;</span> <span class="s1">'tool-1.1.tgz'</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Checksum can be used in the <code class="language-plaintext highlighter-rouge">source_hash</code> parameter, with the MD5-sum of the content to be downloaded.
If content exists, but does not match it is removed before downloading.</p>

<p>If you want to use your own unless condition, you can do it. This example uses wget to download the latest version of Wordpress to your destination folder only if the folder is empty (test used returns 1 if directory is empty or 0 if not).</p>
<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">wget::fetch</span> <span class="p">{</span> <span class="s1">'wordpress'</span><span class="p">:</span>
        <span class="py">source</span>      <span class="p">=&gt;</span> <span class="s1">'https://wordpress.org/latest.tar.gz'</span><span class="p">,</span>
        <span class="py">destination</span> <span class="p">=&gt;</span> <span class="s2">"/var/www/html/latest_wordpress.tar.gz"</span><span class="p">,</span>
        <span class="py">timeout</span>     <span class="p">=&gt;</span> <span class="m">0</span><span class="p">,</span>
        <span class="py">unless</span>      <span class="p">=&gt;</span> <span class="s2">"test </span><span class="err">$</span><span class="s2">(ls -A /var/www/html 2&gt;/dev/null)"</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></div>

<h1 id="building">Building</h1>

<p>Testing is done with rspec, <a href="https://github.com/puppetlabs/beaker-rspec">Beaker-rspec</a>, <a href="https://github.com/puppetlabs/beaker">Beaker</a>)</p>

<p>To test and build the module</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle install
# run specs
rake

# run Beaker system tests with vagrant vms
rake beaker
# to use other vm from the list spec/acceptance/nodesets and not destroy the vm after the tests
BEAKER_destroy=no BEAKER_set=centos-65-x64-docker bundle exec rake beaker

# Release the Puppet module to the Forge, doing a clean, build, tag, push, bump_commit and git push
rake module:release
</code></pre></div></div>

<h1 id="license">License</h1>

<p>Copyright 2011-2013 MaestroDev</p>

<p>Licensed under the Apache License, Version 2.0 (the “License”);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>

<p>http://www.apache.org/licenses/LICENSE-2.0</p>

<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an “AS IS” BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>


      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/RussianPenguin/russianpenguin.github.io">russianpenguin.github.io</a> is maintained by <a href="https://github.com/RussianPenguin">RussianPenguin</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(69889387, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/69889387" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
  </body>
</html>
