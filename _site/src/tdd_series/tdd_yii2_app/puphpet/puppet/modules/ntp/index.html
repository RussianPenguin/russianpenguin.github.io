<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta name="yandex-verification" content="551ffc5ae1433df6" />
    
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Чтобы не забыть | Записная книжка рассеянного [в пространстве и времени] программиста</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Чтобы не забыть" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Записная книжка рассеянного [в пространстве и времени] программиста" />
<meta property="og:description" content="Записная книжка рассеянного [в пространстве и времени] программиста" />
<link rel="canonical" href="http://localhost:4000/src/tdd_series/tdd_yii2_app/puphpet/puppet/modules/ntp/" />
<meta property="og:url" content="http://localhost:4000/src/tdd_series/tdd_yii2_app/puphpet/puppet/modules/ntp/" />
<meta property="og:site_name" content="Чтобы не забыть" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Чтобы не забыть" />
<script type="application/ld+json">
{"headline":"Чтобы не забыть","description":"Записная книжка рассеянного [в пространстве и времени] программиста","@type":"WebPage","url":"http://localhost:4000/src/tdd_series/tdd_yii2_app/puphpet/puppet/modules/ntp/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/assets/css/style.css?v=eacdde9998fcd3dd17b1956e7070eca69fdaf217">
  </head>
  <body>
    <header class="page-header" role="banner">
      <h1 class="project-name">Чтобы не забыть</h1>
      <h2 class="project-tagline">Записная книжка рассеянного [в пространстве и времени] программиста</h2>
      
        <a href="https://github.com/RussianPenguin/russianpenguin.github.io" class="btn">View on GitHub</a>
      
      
    </header>

    <main id="content" class="main-content" role="main">
      <p>#ntp</p>

<p>####Table of Contents</p>

<ol>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#module-description">Module Description - What the module does and why it is useful</a></li>
  <li><a href="#setup">Setup - The basics of getting started with ntp</a></li>
  <li><a href="#usage">Usage - Configuration options and additional functionality</a></li>
  <li><a href="#reference">Reference - An under-the-hood peek at what the module is doing and how</a></li>
  <li><a href="#limitations">Limitations - OS compatibility, etc.</a></li>
  <li><a href="#development">Development - Guide for contributing to the module</a></li>
</ol>

<p>##Overview</p>

<p>The ntp module installs, configures, and manages the NTP service.</p>

<p>##Module Description</p>

<p>The ntp module handles installing, configuring, and running NTP across a range of operating systems and distributions.</p>

<p>##Setup</p>

<p>###Beginning with ntp</p>

<p><code class="language-plaintext highlighter-rouge">include '::ntp'</code> is enough to get you up and running.  If you wish to pass in parameters specifying which servers to use, then:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="p">{</span> <span class="s1">'::ntp'</span><span class="p">:</span>
  <span class="py">servers</span> <span class="p">=&gt;</span> <span class="p">[</span> <span class="s1">'ntp1.corp.com'</span><span class="p">,</span> <span class="s1">'ntp2.corp.com'</span> <span class="p">],</span>
<span class="p">}</span>
</code></pre></div></div>

<p>##Usage</p>

<p>All interaction with the ntp module can be done through the main ntp class. This means you can simply toggle the options in <code class="language-plaintext highlighter-rouge">::ntp</code> to have full functionality of the module.</p>

<p>###I just want NTP, what’s the minimum I need?</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">include</span> <span class="s1">'::ntp'</span>
</code></pre></div></div>

<p>###I just want to tweak the servers, nothing else.</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="p">{</span> <span class="s1">'::ntp'</span><span class="p">:</span>
  <span class="py">servers</span> <span class="p">=&gt;</span> <span class="p">[</span> <span class="s1">'ntp1.corp.com'</span><span class="p">,</span> <span class="s1">'ntp2.corp.com'</span> <span class="p">],</span>
<span class="p">}</span>
</code></pre></div></div>

<p>###I’d like to make sure I restrict who can connect as well.</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="p">{</span> <span class="s1">'::ntp'</span><span class="p">:</span>
  <span class="py">servers</span>  <span class="p">=&gt;</span> <span class="p">[</span> <span class="s1">'ntp1.corp.com'</span><span class="p">,</span> <span class="s1">'ntp2.corp.com'</span> <span class="p">],</span>
  <span class="py">restrict</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">'127.0.0.1'</span><span class="p">],</span>
<span class="p">}</span>
</code></pre></div></div>

<p>###I just want to install a client that can’t be queried</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="p">{</span> <span class="s1">'::ntp'</span><span class="p">:</span>
  <span class="py">servers</span>   <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">'ntp1.corp.com'</span><span class="p">,</span> <span class="s1">'ntp2.corp.com'</span><span class="p">],</span>
  <span class="py">restrict</span>  <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">'default ignore'</span><span class="p">,</span>
    <span class="s1">'-6 default ignore'</span><span class="p">,</span>
    <span class="s1">'127.0.0.1'</span><span class="p">,</span>
    <span class="s1">'-6 ::1'</span><span class="p">,</span>
    <span class="s1">'ntp1.corp.com nomodify notrap nopeer noquery'</span><span class="p">,</span>
    <span class="s1">'ntp1.corp.com nomodify notrap nopeer noquery'</span>
  <span class="p">],</span>
<span class="p">}</span>
</code></pre></div></div>

<p>###I only want to listen on specific interfaces, not on 0.0.0.0</p>

<p>Restricting ntp to a specific interface is especially useful on Openstack nodes which may have numerous virtual interfaces.</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="p">{</span> <span class="s1">'::ntp'</span><span class="p">:</span>
  <span class="py">servers</span>  <span class="p">=&gt;</span> <span class="p">[</span> <span class="s1">'ntp1.corp.com'</span><span class="p">,</span> <span class="s1">'ntp2.corp.com'</span> <span class="p">],</span>
  <span class="py">interfaces</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">'127.0.0.1'</span><span class="p">,</span> <span class="s1">'1.2.3.4'</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<p>###I’d like to opt out of having the service controlled; we use another tool for that.</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="p">{</span> <span class="s1">'::ntp'</span><span class="p">:</span>
  <span class="py">servers</span>        <span class="p">=&gt;</span> <span class="p">[</span> <span class="s1">'ntp1.corp.com'</span><span class="p">,</span> <span class="s1">'ntp2.corp.com'</span> <span class="p">],</span>
  <span class="py">restrict</span>       <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">'127.0.0.1'</span><span class="p">],</span>
  <span class="py">service_manage</span> <span class="p">=&gt;</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p>###I’d like to configure and run ntp, but I don’t need to install it.</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="p">{</span> <span class="s1">'::ntp'</span><span class="p">:</span>
  <span class="py">package_manage</span> <span class="p">=&gt;</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p>###Looks great!  But I’d like a different template; we need to do something unique here.</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="p">{</span> <span class="s1">'::ntp'</span><span class="p">:</span>
  <span class="py">servers</span>         <span class="p">=&gt;</span> <span class="p">[</span> <span class="s1">'ntp1.corp.com'</span><span class="p">,</span> <span class="s1">'ntp2.corp.com'</span> <span class="p">],</span>
  <span class="py">restrict</span>        <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">'127.0.0.1'</span><span class="p">],</span>
  <span class="py">service_manage</span>  <span class="p">=&gt;</span> <span class="kc">false</span><span class="p">,</span>
  <span class="py">config_template</span> <span class="p">=&gt;</span> <span class="s1">'different/module/custom.template.erb'</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p>##Reference</p>

<p>###Classes</p>

<p>####Public Classes</p>

<ul>
  <li>ntp: Main class, includes all other classes.</li>
</ul>

<p>####Private Classes</p>

<ul>
  <li>ntp::install: Handles the packages.</li>
  <li>ntp::config: Handles the configuration file.</li>
  <li>ntp::service: Handles the service.</li>
</ul>

<p>###Parameters</p>

<p>The following parameters are available in the <code class="language-plaintext highlighter-rouge">::ntp</code> class:</p>

<p>####<code class="language-plaintext highlighter-rouge">autoupdate</code></p>

<p><strong>Deprecated; replaced by the <code class="language-plaintext highlighter-rouge">package_ensure</code> parameter</strong>. Tells Puppet whether to keep the ntp module updated to the latest version available. Valid options: true or false. Default value: false</p>

<p>####<code class="language-plaintext highlighter-rouge">broadcastclient</code></p>

<p>Enable reception of broadcast server messages to any local interface.</p>

<p>####<code class="language-plaintext highlighter-rouge">config</code></p>

<p>Specifies a file for ntp’s configuration info. Valid options: string containing an absolute path. Default value: ‘/etc/ntp.conf’ (or ‘/etc/inet/ntp.conf’ on Solaris)</p>

<p>####<code class="language-plaintext highlighter-rouge">config_dir</code></p>

<p>Specifies a directory for the ntp configuration files. Valid options: string containing an absolute path. Default value: undef</p>

<p>####<code class="language-plaintext highlighter-rouge">config_file_mode</code></p>

<p>Specifies a file mode for the ntp configuration file. Valid options: string containing file mode. Default value: ‘0664’</p>

<p>####<code class="language-plaintext highlighter-rouge">config_template</code></p>

<p>Specifies a file to act as a template for the config file. Valid options: string containing a path (absolute, or relative to the module path). Default value: ‘ntp/ntp.conf.erb’</p>

<p>####<code class="language-plaintext highlighter-rouge">disable_auth</code></p>

<p>Do  not  require cryptographic authentication for broadcast client, multicast 
client and symmetric passive associations.</p>

<p>####<code class="language-plaintext highlighter-rouge">disable_auth</code></p>

<p>Disables kernel time discipline.</p>

<p>####<code class="language-plaintext highlighter-rouge">disable_dhclient</code></p>

<p>Disables <code class="language-plaintext highlighter-rouge">ntp-servers</code> in <code class="language-plaintext highlighter-rouge">dhclient.conf</code> to avoid Dhclient from managing the NTP configuration.</p>

<p>####<code class="language-plaintext highlighter-rouge">disable_monitor</code></p>

<p>Disables the monitoring facility in NTP. Valid options: true or false. Default value: true</p>

<p>####<code class="language-plaintext highlighter-rouge">driftfile</code></p>

<p>Specifies an NTP driftfile. Valid options: string containing an absolute path. Default value: ‘/var/lib/ntp/drift’ (except on AIX and Solaris)</p>

<h4 id="fudge"><code class="language-plaintext highlighter-rouge">fudge</code></h4>

<p>Used to provide additional information for individual clock drivers. Valid options: array containing strings that follow the <code class="language-plaintext highlighter-rouge">fudge</code> command. Default value: [ ]</p>

<p>####<code class="language-plaintext highlighter-rouge">iburst_enable</code></p>

<p>Specifies whether to enable the iburst option for every NTP peer. Valid options: true or false. Default value: false (except on AIX and Debian)</p>

<p>####<code class="language-plaintext highlighter-rouge">interfaces</code></p>

<p>Specifies one or more network interfaces for NTP to listen on. Valid options: array. Default value: [ ]</p>

<p>####<code class="language-plaintext highlighter-rouge">interfaces_ignore</code></p>

<p>Specifies one or more ignore pattern for the NTP listener configuration (e.g. all, wildcard, ipv6, …). Valid options: array. Default value: [ ]</p>

<h4 id="keys"><code class="language-plaintext highlighter-rouge">keys</code></h4>

<p>Distributes keys to keys file. Valid options: array of keys. Default value: [ ]</p>

<p>####<code class="language-plaintext highlighter-rouge">keys_controlkey</code></p>

<p>Specifies the key identifier to use with the ntpq utility. Valid options: value in the range of 1 to 65,534 inclusive. Default value: ‘ ‘</p>

<p>####<code class="language-plaintext highlighter-rouge">keys_enable</code></p>

<p>Tells Puppet whether to enable key-based authentication. Valid options: true or false. Default value: false</p>

<p>####<code class="language-plaintext highlighter-rouge">keys_file</code></p>

<p>Specifies the complete path and location of the MD5 key file containing the keys and key identifiers used by ntpd, ntpq and ntpdc when operating with symmetric key cryptography. Valid options: string containing an absolute path. Default value: <code class="language-plaintext highlighter-rouge">/etc/ntp.keys</code> (except on RedHat and Amazon, where it is <code class="language-plaintext highlighter-rouge">/etc/ntp/keys</code>).</p>

<p>####<code class="language-plaintext highlighter-rouge">keys_requestkey</code></p>

<p>Specifies the key identifier to use with the ntpdc utility program. Valid options: value in the range of 1 to 65,534 inclusive. Default value: ‘ ‘</p>

<h4 id="keys_trusted"><code class="language-plaintext highlighter-rouge">keys_trusted</code>:</h4>
<p>Provides one or more keys to be trusted by NTP. Valid options: array of keys. Default value: [ ]</p>

<h4 id="leapfile"><code class="language-plaintext highlighter-rouge">leapfile</code></h4>

<p>Specifies a leap second file for NTP to use. Valid options: string containing an absolute path. Default value: ‘ ‘</p>

<h4 id="logfile"><code class="language-plaintext highlighter-rouge">logfile</code></h4>

<p>Specifies a log file for NTP to use instead of syslog. Valid options: string containing an absolute path. Default value: ‘ ‘</p>

<p>####<code class="language-plaintext highlighter-rouge">minpoll</code></p>

<p>Tells Puppet to use non-standard minimal poll interval of upstream servers. Valid options: 3 to 16. Default option: undef.</p>

<p>####<code class="language-plaintext highlighter-rouge">maxpoll</code></p>

<p>Tells Puppet to use non-standard maximal poll interval of upstream servers. Valid options: 3 to 16. Default option: undef, except FreeBSD (on FreeBSD <code class="language-plaintext highlighter-rouge">maxpoll</code> set 9 by default).</p>

<p>####<code class="language-plaintext highlighter-rouge">ntpsigndsocket</code></p>

<p>Tells NTP to sign packets using the socket in the ntpsigndsocket path. NTP must be configured to sign sockets for this to work.
Valid option: a path to the socket directory; for example, for Samba it would be:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ntpsigndsocket = usr/local/samba/var/lib/ntp_signd/ 
</code></pre></div></div>

<p>Default value: undef.</p>

<p>####<code class="language-plaintext highlighter-rouge">package_ensure</code></p>

<p>Tells Puppet whether the NTP package should be installed, and what version. Valid options: ‘present’, ‘latest’, or a specific version number. Default value: ‘present’</p>

<p>####<code class="language-plaintext highlighter-rouge">package_manage</code></p>

<p>Tells Puppet whether to manage the NTP package. Valid options: true or false. Default value: true</p>

<p>####<code class="language-plaintext highlighter-rouge">package_name</code></p>

<p>Tells Puppet what NTP package to manage. Valid options: string. Default value: ‘ntp’ (except on AIX and Solaris)</p>

<p>####<code class="language-plaintext highlighter-rouge">panic</code></p>

<p>Specifies whether NTP should “panic” in the event of a very large clock skew. Applies only if <code class="language-plaintext highlighter-rouge">tinker</code> option set to “true” or in case your environment is in virtual machine. Valid options: unsigned shortint digit. Default value: 0 if environment is virtual, undef in all other cases.</p>

<p>####<code class="language-plaintext highlighter-rouge">peers</code></p>

<p>List of ntp servers which the local clock can be synchronised against, or which can synchronise against the local clock.</p>

<p>####<code class="language-plaintext highlighter-rouge">preferred_servers</code></p>

<p>Specifies one or more preferred peers. Puppet will append ‘prefer’ to each matching item in the <code class="language-plaintext highlighter-rouge">servers</code> array. Valid options: array. Default value: [ ]</p>

<p>####<code class="language-plaintext highlighter-rouge">restrict</code></p>

<p>Specifies one or more <code class="language-plaintext highlighter-rouge">restrict</code> options for the NTP configuration. Puppet will prefix each item with ‘restrict’, so you only need to list the content of the restriction. Valid options: array. Default value for most operating systems:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[
  'default kod nomodify notrap nopeer noquery',
  '-6 default kod nomodify notrap nopeer noquery',
  '127.0.0.1',
  '-6 ::1',
]
</code></pre></div></div>

<p>Default value for AIX systems:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[
  'default nomodify notrap nopeer noquery',
  '127.0.0.1',
]
</code></pre></div></div>

<p>####<code class="language-plaintext highlighter-rouge">servers</code></p>

<p>Specifies one or more servers to be used as NTP peers. Valid options: array. Default value: varies by operating system</p>

<p>####<code class="language-plaintext highlighter-rouge">service_enable</code></p>

<p>Tells Puppet whether to enable the NTP service at boot. Valid options: true or false. Default value: true</p>

<p>####<code class="language-plaintext highlighter-rouge">service_ensure</code></p>

<p>Tells Puppet whether the NTP service should be running. Valid options: ‘running’ or ‘stopped’. Default value: ‘running’</p>

<p>####<code class="language-plaintext highlighter-rouge">service_manage</code></p>

<p>Tells Puppet whether to manage the NTP service. Valid options: true or false. Default value: true</p>

<p>####<code class="language-plaintext highlighter-rouge">service_name</code></p>

<p>Tells Puppet what NTP service to manage. Valid options: string. Default value: varies by operating system</p>

<p>####<code class="language-plaintext highlighter-rouge">service_provider</code></p>

<p>Tells Puppet which service provider to use for NTP. Valid options: string. Default value: ‘undef’</p>

<p>####<code class="language-plaintext highlighter-rouge">stepout</code></p>

<p>Tells puppet to change stepout. Applies only if <code class="language-plaintext highlighter-rouge">tinker</code> value is true. Valid options: unsigned shortint digit. Default value: undef.</p>

<p>####<code class="language-plaintext highlighter-rouge">tos</code></p>

<p>Tells Puppet to enable tos options. Valid options: true of false. Default value: false</p>

<p>####<code class="language-plaintext highlighter-rouge">tos_minclock</code></p>

<p>Specifies the minclock tos option. Valid options: numeric. Default value: 3</p>

<p>####<code class="language-plaintext highlighter-rouge">tos_minsane</code></p>

<p>Specifies the minsane tos option. Valid options: numeric. Default value: 1</p>

<p>####<code class="language-plaintext highlighter-rouge">tos_floor</code></p>

<p>Specifies the floor tos option. Valid options: numeric. Default value: 1</p>

<p>####<code class="language-plaintext highlighter-rouge">tos_ceiling</code></p>

<p>Specifies the ceiling tos option. Valid options: numeric. Default value: 15</p>

<p>####<code class="language-plaintext highlighter-rouge">tos_cohort</code></p>

<p>Specifies the cohort tos option. Valid options: ‘0’ or ‘1’. Default value: 0</p>

<p>####<code class="language-plaintext highlighter-rouge">tinker</code></p>

<p>Tells Puppet to enable tinker options. Valid options: true of false. Default value: false</p>

<p>####<code class="language-plaintext highlighter-rouge">udlc</code></p>

<p>Specifies whether to configure ntp to use the undisciplined local clock as a time source. Valid options: true or false. Default value: false</p>

<p>####<code class="language-plaintext highlighter-rouge">udlc_stratum</code></p>

<p>Specifies the stratum the server should operate at when using the undisciplined local clock as the time source. It is strongly suggested that this value be set to no less than 10 where ntpd may be accessible outside your immediate, controlled network. Default value: 10</p>

<p>##Limitations</p>

<p>This module has been tested on <a href="https://forge.puppetlabs.com/supported#compat-matrix">all PE-supported platforms</a>, and no issues have been identified. Additionally, it is tested (but not supported) on Solaris 10 and Fedora 20-22.</p>

<p>##Development</p>

<p>Puppet Labs modules on the Puppet Forge are open projects, and community contributions are essential for keeping them great. We can’t access the huge number of platforms and myriad of hardware, software, and deployment configurations that Puppet is intended to serve.</p>

<p>We want to keep it as easy as possible to contribute changes so that our modules work in your environment. There are a few guidelines that we need contributors to follow so that we can have a chance of keeping on top of things.</p>

<p>For more information, see our <a href="https://docs.puppetlabs.com/forge/contributing.html">module contribution guide.</a></p>

<p>###Contributors</p>

<p>To see who’s already involved, see the <a href="https://github.com/puppetlabs/puppetlabs-ntp/graphs/contributors">list of contributors.</a></p>


      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/RussianPenguin/russianpenguin.github.io">russianpenguin.github.io</a> is maintained by <a href="https://github.com/RussianPenguin">RussianPenguin</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(69889387, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/69889387" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
  </body>
</html>
