<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta name="yandex-verification" content="551ffc5ae1433df6" />
    
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Чтобы не забыть | Записная книжка рассеянного [в пространстве и времени] программиста</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Чтобы не забыть" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Записная книжка рассеянного [в пространстве и времени] программиста" />
<meta property="og:description" content="Записная книжка рассеянного [в пространстве и времени] программиста" />
<link rel="canonical" href="http://localhost:4000/src/tdd_series/tdd_yii2_app/puphpet/puppet/modules/firewall/" />
<meta property="og:url" content="http://localhost:4000/src/tdd_series/tdd_yii2_app/puphpet/puppet/modules/firewall/" />
<meta property="og:site_name" content="Чтобы не забыть" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Чтобы не забыть" />
<script type="application/ld+json">
{"headline":"Чтобы не забыть","description":"Записная книжка рассеянного [в пространстве и времени] программиста","@type":"WebPage","url":"http://localhost:4000/src/tdd_series/tdd_yii2_app/puphpet/puppet/modules/firewall/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/assets/css/style.css?v=eacdde9998fcd3dd17b1956e7070eca69fdaf217">
  </head>
  <body>
    <header class="page-header" role="banner">
      <h1 class="project-name">Чтобы не забыть</h1>
      <h2 class="project-tagline">Записная книжка рассеянного [в пространстве и времени] программиста</h2>
      
        <a href="https://github.com/RussianPenguin/russianpenguin.github.io" class="btn">View on GitHub</a>
      
      
    </header>

    <main id="content" class="main-content" role="main">
      <p>#firewall</p>

<p><a href="https://travis-ci.org/puppetlabs/puppetlabs-firewall"><img src="https://travis-ci.org/puppetlabs/puppetlabs-firewall.png?branch=master" alt="Build Status" /></a></p>

<p>####Table of Contents</p>

<ol>
  <li><a href="#overview">Overview - What is the firewall module?</a></li>
  <li><a href="#module-description">Module Description - What does the module do?</a></li>
  <li><a href="#setup">Setup - The basics of getting started with firewall</a>
    <ul>
      <li><a href="#what-firewall-affects">What firewall Affects</a></li>
      <li><a href="#setup-requirements">Setup Requirements</a></li>
      <li><a href="#beginning-with-firewall">Beginning with firewall</a></li>
      <li><a href="#upgrading">Upgrading</a></li>
    </ul>
  </li>
  <li><a href="#usage">Usage - Configuration and customization options</a>
    <ul>
      <li><a href="#default-rules">Default rules - Setting up general configurations for all firewalls</a></li>
      <li><a href="#application-specific-rules">Application-Specific Rules - Options for configuring and managing firewalls across applications</a></li>
      <li><a href="#other-rules">Additional Uses for the Firewall Module</a></li>
    </ul>
  </li>
  <li><a href="#reference">Reference - An under-the-hood peek at what the module is doing</a></li>
  <li><a href="#limitations">Limitations - OS compatibility, etc.</a></li>
  <li><a href="#development">Development - Guide for contributing to the module</a>
    <ul>
      <li><a href="#tests">Tests - Testing your configuration</a></li>
    </ul>
  </li>
</ol>

<h2 id="overview">Overview</h2>

<p>The firewall module lets you manage firewall rules with Puppet.</p>

<h2 id="module-description">Module Description</h2>

<p>PuppetLabs’ firewall module introduces the <code class="language-plaintext highlighter-rouge">firewall</code> resource, which is used to manage and configure firewall rules from within the Puppet DSL. This module offers support for iptables and ip6tables. The module also introduces the <code class="language-plaintext highlighter-rouge">firewallchain</code> resource, which allows you to manage chains or firewall lists and ebtables for bridging support. At the moment, only iptables and ip6tables chains are supported.</p>

<p>The firewall module acts on your running firewall, making immediate changes as the catalog executes. Defining default pre and post rules allows you to provide global defaults for your hosts before and after any custom rules. Defining <code class="language-plaintext highlighter-rouge">pre</code> and <code class="language-plaintext highlighter-rouge">post</code> rules is also necessary to help you avoid locking yourself out of your own boxes when Puppet runs.</p>

<h2 id="setup">Setup</h2>

<h3 id="what-firewall-affects">What firewall Affects</h3>

<ul>
  <li>Every node running a firewall</li>
  <li>Firewall settings in your system</li>
  <li>Connection settings for managed nodes</li>
  <li>Unmanaged resources (get purged)</li>
</ul>

<h3 id="setup-requirements">Setup Requirements</h3>

<p>Firewall uses Ruby-based providers, so you must enable <a href="http://docs.puppetlabs.com/guides/plugins_in_modules.html#enabling-pluginsync">pluginsync</a>.</p>

<h3 id="beginning-with-firewall">Beginning with firewall</h3>

<p>In the following two sections, you create new classes and then create firewall rules related to those classes. These steps are optional but provide a framework for firewall rules, which is helpful if you’re just starting to create them.</p>

<p>If you already have rules in place, then you don’t need to do these two sections. However, be aware of the ordering of your firewall rules. The module will dynamically apply rules in the order they appear in the catalog, meaning a deny rule could be applied before the allow rules. This might mean the module hasn’t established some of the important connections, such as the connection to the Puppet master.</p>

<p>The following steps are designed to ensure that you keep your SSH and other connections, primarily your connection to your Puppet master. If you create the <code class="language-plaintext highlighter-rouge">pre</code> and <code class="language-plaintext highlighter-rouge">post</code> classes described in the first section, then you also need to create the rules described in the second section.</p>

<h4 id="create-the-my_fwpre-and-my_fwpost-classes">Create the <code class="language-plaintext highlighter-rouge">my_fw::pre</code> and <code class="language-plaintext highlighter-rouge">my_fw::post</code> Classes</h4>

<p>This approach employs a whitelist setup, so you can define what rules you want and everything else is ignored rather than removed.</p>

<p>The code in this section does the following:</p>

<ul>
  <li>The ‘require’ parameter in <code class="language-plaintext highlighter-rouge">firewall {}</code> ensures <code class="language-plaintext highlighter-rouge">my_fw::pre</code> is run before any other rules.</li>
  <li>In the <code class="language-plaintext highlighter-rouge">my_fw::post</code> class declaration, the ‘before’ parameter ensures <code class="language-plaintext highlighter-rouge">my_fw::post</code> is run after any other rules.</li>
</ul>

<p>Therefore, the run order is:</p>

<ul>
  <li>The rules in <code class="language-plaintext highlighter-rouge">my_fw::pre</code></li>
  <li>Your rules (defined in code)</li>
  <li>The rules in <code class="language-plaintext highlighter-rouge">my_fw::post</code></li>
</ul>

<p>The rules in the <code class="language-plaintext highlighter-rouge">pre</code> and <code class="language-plaintext highlighter-rouge">post</code> classes are fairly general. These two classes ensure that you retain connectivity and that you drop unmatched packets appropriately. The rules you define in your manifests are likely specific to the applications you run.</p>

<p>1.) Add the <code class="language-plaintext highlighter-rouge">pre</code> class to my_fw/manifests/pre.pp. Your pre.pp file should contain any default rules to be applied first. The rules in this class should be added in the order you want them to run.2.</p>
<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">class</span> <span class="nc">my_fw::pre</span> <span class="p">{</span>
    <span class="nc">Firewall</span> <span class="p">{</span>
      <span class="kp">require</span> <span class="p">=&gt;</span> <span class="kc">undef</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c"># Default firewall rules
</span>    <span class="n">firewall</span> <span class="p">{</span> <span class="s1">'000 accept all icmp'</span><span class="p">:</span>
      <span class="py">proto</span>  <span class="p">=&gt;</span> <span class="s1">'icmp'</span><span class="p">,</span>
      <span class="py">action</span> <span class="p">=&gt;</span> <span class="s1">'accept'</span><span class="p">,</span>
    <span class="p">}-&gt;</span>
    <span class="n">firewall</span> <span class="p">{</span> <span class="s1">'001 accept all to lo interface'</span><span class="p">:</span>
      <span class="py">proto</span>   <span class="p">=&gt;</span> <span class="s1">'all'</span><span class="p">,</span>
      <span class="py">iniface</span> <span class="p">=&gt;</span> <span class="s1">'lo'</span><span class="p">,</span>
      <span class="py">action</span>  <span class="p">=&gt;</span> <span class="s1">'accept'</span><span class="p">,</span>
    <span class="p">}-&gt;</span>
    <span class="n">firewall</span> <span class="p">{</span> <span class="s1">'002 reject local traffic not on loopback interface'</span><span class="p">:</span>
      <span class="py">iniface</span>     <span class="p">=&gt;</span> <span class="s1">'! lo'</span><span class="p">,</span>
      <span class="py">proto</span>       <span class="p">=&gt;</span> <span class="s1">'all'</span><span class="p">,</span>
      <span class="py">destination</span> <span class="p">=&gt;</span> <span class="s1">'127.0.0.1/8'</span><span class="p">,</span>
      <span class="py">action</span>      <span class="p">=&gt;</span> <span class="s1">'reject'</span><span class="p">,</span>
    <span class="p">}-&gt;</span>
    <span class="n">firewall</span> <span class="p">{</span> <span class="s1">'003 accept related established rules'</span><span class="p">:</span>
      <span class="py">proto</span>  <span class="p">=&gt;</span> <span class="s1">'all'</span><span class="p">,</span>
      <span class="py">state</span>  <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">'RELATED'</span><span class="p">,</span> <span class="s1">'ESTABLISHED'</span><span class="p">],</span>
      <span class="py">action</span> <span class="p">=&gt;</span> <span class="s1">'accept'</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>The rules in <code class="language-plaintext highlighter-rouge">pre</code> should allow basic networking (such as ICMP and TCP) and ensure that existing connections are not closed.</p>

<p>2.) Add the <code class="language-plaintext highlighter-rouge">post</code> class to my_fw/manifests/post.pp and include any default rules to be applied last.</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">class</span> <span class="nc">my_fw::post</span> <span class="p">{</span>
    <span class="n">firewall</span> <span class="p">{</span> <span class="s1">'999 drop all'</span><span class="p">:</span>
      <span class="py">proto</span>  <span class="p">=&gt;</span> <span class="s1">'all'</span><span class="p">,</span>
      <span class="py">action</span> <span class="p">=&gt;</span> <span class="s1">'drop'</span><span class="p">,</span>
      <span class="kp">before</span> <span class="p">=&gt;</span> <span class="kc">undef</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>Alternatively, the <a href="#type-firewallchain">firewallchain</a> type can be used to set the default policy:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">firewallchain</span> <span class="p">{</span> <span class="s1">'INPUT:filter:IPv4'</span><span class="p">:</span>
    <span class="py">ensure</span> <span class="p">=&gt;</span> <span class="n">present</span><span class="p">,</span>
    <span class="py">policy</span> <span class="p">=&gt;</span> <span class="n">drop</span><span class="p">,</span>
    <span class="kp">before</span> <span class="p">=&gt;</span> <span class="kc">undef</span><span class="p">,</span>
  <span class="p">}</span>
</code></pre></div></div>

<h4 id="create-firewall-rules">Create Firewall Rules</h4>

<p>The rules you create here are helpful if you don’t have any existing rules; they help you order your firewall configurations so you don’t lock yourself out of your box.</p>

<p>Rules are persisted automatically between reboots, although there are known issues with ip6tables on older Debian/Ubuntu distributions. There are also known issues with ebtables.</p>

<p>1.) In site.pp or another top-scope file, add the following code to set up a metatype to purge unmanaged firewall resources. This will clear any existing rules and make sure that only rules defined in Puppet exist on the machine.</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">resources</span> <span class="p">{</span> <span class="s1">'firewall'</span><span class="p">:</span>
    <span class="py">purge</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>To purge unmanaged firewall chains, also add:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">resources</span> <span class="p">{</span> <span class="s1">'firewallchain'</span><span class="p">:</span>
    <span class="py">purge</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">}</span>
</code></pre></div></div>

<p><strong>Note</strong> - If there are unmanaged rules in unmanaged chains, it will take two Puppet runs before the firewall chain is purged. This is different than the <code class="language-plaintext highlighter-rouge">purge</code> parameter available in <code class="language-plaintext highlighter-rouge">firewallchain</code>.</p>

<p>2.)  Use the following code to set up the default parameters for all of the firewall rules you will establish later. These defaults will ensure that the <code class="language-plaintext highlighter-rouge">pre</code> and <code class="language-plaintext highlighter-rouge">post</code> classes are run in the correct order to avoid locking you out of your box during the first Puppet run.</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nc">Firewall</span> <span class="p">{</span>
    <span class="kp">before</span>  <span class="p">=&gt;</span> <span class="nc">Class</span><span class="p">[</span><span class="s1">'my_fw::post'</span><span class="p">],</span>
    <span class="kp">require</span> <span class="p">=&gt;</span> <span class="nc">Class</span><span class="p">[</span><span class="s1">'my_fw::pre'</span><span class="p">],</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>3.) Then, declare the <code class="language-plaintext highlighter-rouge">my_fw::pre</code> and <code class="language-plaintext highlighter-rouge">my_fw::post</code> classes to satisfy dependencies. You can declare these classes using an External Node Classifier or the following code:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">class</span> <span class="p">{</span> <span class="p">[</span><span class="s1">'my_fw::pre'</span><span class="p">,</span> <span class="s1">'my_fw::post'</span><span class="p">]:</span> <span class="p">}</span>
</code></pre></div></div>

<p>4.) Include the <code class="language-plaintext highlighter-rouge">firewall</code> class to ensure the correct packages are installed.</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">class</span> <span class="p">{</span> <span class="s1">'firewall'</span><span class="p">:</span> <span class="p">}</span>
</code></pre></div></div>

<h3 id="upgrading">Upgrading</h3>

<p>Use these steps if you already have a version of the firewall module installed.</p>

<h4 id="from-version-020-and-more-recent">From version 0.2.0 and more recent</h4>

<p>Upgrade the module with the puppet module tool as normal:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>puppet module upgrade puppetlabs/firewall
</code></pre></div></div>

<h2 id="usage">Usage</h2>

<p>There are two kinds of firewall rules you can use with firewall: default rules and application-specific rules. Default rules apply to general firewall settings, whereas application-specific rules manage firewall settings for a specific application, node, etc.</p>

<p>All rules employ a numbering system in the resource’s title that is used for ordering. When titling your rules, make sure you prefix the rule with a number, for example, ‘000 accept all icmp requests’. <em>000</em> runs first, <em>999</em> runs last.</p>

<h3 id="default-rules">Default Rules</h3>

<p>You can place default rules in either <code class="language-plaintext highlighter-rouge">my_fw::pre</code> or <code class="language-plaintext highlighter-rouge">my_fw::post</code>, depending on when you would like them to run. Rules placed in the <code class="language-plaintext highlighter-rouge">pre</code> class will run first, and rules in the <code class="language-plaintext highlighter-rouge">post</code> class, last.</p>

<p>In iptables, the title of the rule is stored using the comment feature of the underlying firewall subsystem. Values must match ‘/^\d+[[:graph:][:space:]]+$/’.</p>

<h4 id="examples-of-default-rules">Examples of Default Rules</h4>

<p>Basic accept ICMP request example:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">firewall</span> <span class="p">{</span> <span class="s1">'000 accept all icmp requests'</span><span class="p">:</span>
  <span class="py">proto</span>  <span class="p">=&gt;</span> <span class="s1">'icmp'</span><span class="p">,</span>
  <span class="py">action</span> <span class="p">=&gt;</span> <span class="s1">'accept'</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Drop all:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">firewall</span> <span class="p">{</span> <span class="s1">'999 drop all other requests'</span><span class="p">:</span>
  <span class="py">action</span> <span class="p">=&gt;</span> <span class="s1">'drop'</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="example-of-an-ipv6-rule">Example of an IPv6 rule</h4>

<p>IPv6 rules can be specified using the <em>ip6tables</em> provider:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">firewall</span> <span class="p">{</span> <span class="s1">'006 Allow inbound SSH (v6)'</span><span class="p">:</span>
  <span class="py">dport</span>     <span class="p">=&gt;</span> <span class="m">22</span><span class="p">,</span>
  <span class="py">proto</span>    <span class="p">=&gt;</span> <span class="n">tcp</span><span class="p">,</span>
  <span class="py">action</span>   <span class="p">=&gt;</span> <span class="n">accept</span><span class="p">,</span>
  <span class="py">provider</span> <span class="p">=&gt;</span> <span class="s1">'ip6tables'</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="application-specific-rules">Application-Specific Rules</h3>

<p>Puppet doesn’t care where you define rules, and this means that you can place
your firewall resources as close to the applications and services that you
manage as you wish. If you use the <a href="https://puppetlabs.com/learn/roles-profiles-introduction">roles and profiles
pattern</a> then it
makes sense to create your firewall rules in the profiles, so they
remain close to the services managed by the profile.</p>

<p>This is an example of firewall rules in a profile:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">profile::apache</span> <span class="p">{</span>
  <span class="k">include</span> <span class="nc">apache</span>
  <span class="n">apache::vhost</span> <span class="p">{</span> <span class="s1">'mysite'</span><span class="p">:</span> <span class="py">ensure</span> <span class="p">=&gt;</span> <span class="n">present</span> <span class="p">}</span>

  <span class="n">firewall</span> <span class="p">{</span> <span class="s1">'100 allow http and https access'</span><span class="p">:</span>
    <span class="py">dport</span>   <span class="p">=&gt;</span> <span class="p">[</span><span class="m">80</span><span class="p">,</span> <span class="m">443</span><span class="p">],</span>
    <span class="py">proto</span>  <span class="p">=&gt;</span> <span class="n">tcp</span><span class="p">,</span>
    <span class="py">action</span> <span class="p">=&gt;</span> <span class="n">accept</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="rule-inversion">Rule inversion</h3>
<p>Firewall rules may be inverted by prefixing the value of a parameter by “! “. If the value is an array, then every item in the array must be prefixed as iptables does not understand inverting a single value.</p>

<p>Parameters that understand inversion are: connmark, ctstate, destination, dport, dst_range, dst_type, iniface, outiface, port, proto, source, sport, src_range, src_type, and state.</p>

<p>Examples:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">firewall</span> <span class="p">{</span> <span class="s1">'001 disallow esp protocol'</span><span class="p">:</span>
  <span class="py">action</span> <span class="p">=&gt;</span> <span class="s1">'accept'</span><span class="p">,</span>
  <span class="py">proto</span>  <span class="p">=&gt;</span> <span class="s1">'! esp'</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">firewall</span> <span class="p">{</span> <span class="s1">'002 drop NEW external website packets with FIN/RST/ACK set and SYN unset'</span><span class="p">:</span>
  <span class="py">chain</span>     <span class="p">=&gt;</span> <span class="s1">'INPUT'</span><span class="p">,</span>
  <span class="py">state</span>     <span class="p">=&gt;</span> <span class="s1">'NEW'</span><span class="p">,</span>
  <span class="py">action</span>    <span class="p">=&gt;</span> <span class="s1">'drop'</span><span class="p">,</span>
  <span class="py">proto</span>     <span class="p">=&gt;</span> <span class="s1">'tcp'</span><span class="p">,</span>
  <span class="py">sport</span>     <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">'! http'</span><span class="p">,</span> <span class="s1">'! 443'</span><span class="p">],</span>
  <span class="py">source</span>    <span class="p">=&gt;</span> <span class="s1">'! 10.0.0.0/8'</span><span class="p">,</span>
  <span class="py">tcp_flags</span> <span class="p">=&gt;</span> <span class="s1">'! FIN,SYN,RST,ACK SYN'</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="additional-uses-for-the-firewall-module">Additional Uses for the Firewall Module</h3>

<p>You can apply firewall rules to specific nodes. Usually, you will want to put the firewall rule in another class and apply that class to a node. Apply a rule to a node as follows:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">node</span> <span class="s1">'some.node.com'</span> <span class="p">{</span>
  <span class="n">firewall</span> <span class="p">{</span> <span class="s1">'111 open port 111'</span><span class="p">:</span>
    <span class="py">dport</span> <span class="p">=&gt;</span> <span class="m">111</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>You can also do more complex things with the <code class="language-plaintext highlighter-rouge">firewall</code> resource. This example sets up static NAT for the source network 10.1.2.0/24:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">firewall</span> <span class="p">{</span> <span class="s1">'100 snat for network foo2'</span><span class="p">:</span>
  <span class="py">chain</span>    <span class="p">=&gt;</span> <span class="s1">'POSTROUTING'</span><span class="p">,</span>
  <span class="py">jump</span>     <span class="p">=&gt;</span> <span class="s1">'MASQUERADE'</span><span class="p">,</span>
  <span class="py">proto</span>    <span class="p">=&gt;</span> <span class="s1">'all'</span><span class="p">,</span>
  <span class="py">outiface</span> <span class="p">=&gt;</span> <span class="s1">'eth0'</span><span class="p">,</span>
  <span class="py">source</span>   <span class="p">=&gt;</span> <span class="s1">'10.1.2.0/24'</span><span class="p">,</span>
  <span class="py">table</span>    <span class="p">=&gt;</span> <span class="s1">'nat'</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p>You can also change the TCP MSS value for VPN client traffic:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">firewall</span> <span class="p">{</span> <span class="s1">'110 TCPMSS for VPN clients'</span><span class="p">:</span>
  <span class="py">chain</span>     <span class="p">=&gt;</span> <span class="s1">'FORWARD'</span><span class="p">,</span>
  <span class="py">table</span>     <span class="p">=&gt;</span> <span class="s1">'mangle'</span><span class="p">,</span>
  <span class="py">source</span>    <span class="p">=&gt;</span> <span class="s1">'10.0.2.0/24'</span><span class="p">,</span>
  <span class="py">proto</span>     <span class="p">=&gt;</span> <span class="n">tcp</span><span class="p">,</span>
  <span class="py">tcp_flags</span> <span class="p">=&gt;</span> <span class="s1">'SYN,RST SYN'</span><span class="p">,</span>
  <span class="py">mss</span>       <span class="p">=&gt;</span> <span class="s1">'1361:1541'</span><span class="p">,</span>
  <span class="py">set_mss</span>   <span class="p">=&gt;</span> <span class="s1">'1360'</span><span class="p">,</span>
  <span class="py">jump</span>      <span class="p">=&gt;</span> <span class="s1">'TCPMSS'</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The following will mirror all traffic sent to the server to a secondary host on the LAN with the TEE target:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">firewall</span> <span class="p">{</span> <span class="s1">'503 Mirror traffic to IDS'</span><span class="p">:</span>
  <span class="py">proto</span>   <span class="p">=&gt;</span> <span class="n">all</span><span class="p">,</span>
  <span class="py">jump</span>    <span class="p">=&gt;</span> <span class="s1">'TEE'</span><span class="p">,</span>
  <span class="py">gateway</span> <span class="p">=&gt;</span> <span class="s1">'10.0.0.2'</span><span class="p">,</span>
  <span class="py">chain</span>   <span class="p">=&gt;</span> <span class="s1">'PREROUTING'</span><span class="p">,</span>
  <span class="py">table</span>   <span class="p">=&gt;</span> <span class="s1">'mangle'</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The following example creates a new chain and forwards any port 5000 access to it.</p>
<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">firewall</span> <span class="p">{</span> <span class="s1">'100 forward to MY_CHAIN'</span><span class="p">:</span>
  <span class="py">chain</span>   <span class="p">=&gt;</span> <span class="s1">'INPUT'</span><span class="p">,</span>
  <span class="py">jump</span>    <span class="p">=&gt;</span> <span class="s1">'MY_CHAIN'</span><span class="p">,</span>
<span class="p">}</span>
<span class="c"># The namevar here is in the format chain_name:table:protocol
</span><span class="n">firewallchain</span> <span class="p">{</span> <span class="s1">'MY_CHAIN:filter:IPv4'</span><span class="p">:</span>
  <span class="py">ensure</span>  <span class="p">=&gt;</span> <span class="n">present</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">firewall</span> <span class="p">{</span> <span class="s1">'100 my rule'</span><span class="p">:</span>
  <span class="py">chain</span>   <span class="p">=&gt;</span> <span class="s1">'MY_CHAIN'</span><span class="p">,</span>
  <span class="py">action</span>  <span class="p">=&gt;</span> <span class="s1">'accept'</span><span class="p">,</span>
  <span class="py">proto</span>   <span class="p">=&gt;</span> <span class="s1">'tcp'</span><span class="p">,</span>
  <span class="py">dport</span>   <span class="p">=&gt;</span> <span class="m">5000</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="additional-information">Additional Information</h3>

<p>Access the inline documentation:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>puppet describe firewall
</code></pre></div></div>

<p>Or</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>puppet doc -r type
(and search for firewall)
</code></pre></div></div>

<h2 id="reference">Reference</h2>

<p>Classes:</p>

<ul>
  <li><a href="#class-firewall">firewall</a></li>
</ul>

<p>Types:</p>

<ul>
  <li><a href="#type-firewall">firewall</a></li>
  <li><a href="#type-firewallchain">firewallchain</a></li>
</ul>

<p>Facts:</p>

<ul>
  <li><a href="#fact-ip6tablesversion">ip6tables_version</a></li>
  <li><a href="#fact-iptablesversion">iptables_version</a></li>
  <li><a href="#fact-iptablespersistentversion">iptables_persistent_version</a></li>
</ul>

<h3 id="class-firewall">Class: firewall</h3>

<p>Performs the basic setup tasks required for using the firewall resources.</p>

<p>At the moment this takes care of:</p>

<ul>
  <li>iptables-persistent package installation</li>
</ul>

<p>Include the <code class="language-plaintext highlighter-rouge">firewall</code> class for nodes that need to use the resources in this module:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class { 'firewall': }
</code></pre></div></div>

<h4 id="ensure">ensure</h4>

<p>Parameter that controls the state of the iptables service on your system, allowing you to disable iptables if you want.</p>

<p><code class="language-plaintext highlighter-rouge">ensure</code> can either be ‘running’ or ‘stopped’. Defaults to ‘running’.</p>

<h4 id="package">package</h4>

<p>Specify the platform-specific package(s) to install. Defaults defined in <code class="language-plaintext highlighter-rouge">firewall::params</code>.</p>

<h4 id="pkg_ensure">pkg_ensure</h4>

<p>Parameter that controls the state of the iptables package on your system, allowing you to update it if you wish.</p>

<p><code class="language-plaintext highlighter-rouge">ensure</code> can either be ‘present’ or ‘latest’. Defaults to ‘present’.</p>

<h4 id="service">service</h4>

<p>Specify the platform-specific service(s) to start or stop. Defaults defined in <code class="language-plaintext highlighter-rouge">firewall::params</code>.</p>

<p>###Type: firewall</p>

<p>This type enables you to manage firewall rules within Puppet.</p>

<h4 id="providers">Providers</h4>
<p><strong>Note:</strong> Not all features are available with all providers.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ip6tables</code>: Ip6tables type provider
    <ul>
      <li>Required binaries: <code class="language-plaintext highlighter-rouge">ip6tables-save</code>, <code class="language-plaintext highlighter-rouge">ip6tables</code>.</li>
      <li>Supported features: <code class="language-plaintext highlighter-rouge">address_type</code>, <code class="language-plaintext highlighter-rouge">connection_limiting</code>, <code class="language-plaintext highlighter-rouge">dnat</code>, <code class="language-plaintext highlighter-rouge">hop_limiting</code>, <code class="language-plaintext highlighter-rouge">icmp_match</code>, <code class="language-plaintext highlighter-rouge">interface_match</code>, <code class="language-plaintext highlighter-rouge">iprange</code>, <code class="language-plaintext highlighter-rouge">ipsec_dir</code>, <code class="language-plaintext highlighter-rouge">ipsec_policy</code>, <code class="language-plaintext highlighter-rouge">ipset</code>, <code class="language-plaintext highlighter-rouge">iptables</code>, <code class="language-plaintext highlighter-rouge">isfirstfrag</code>, <code class="language-plaintext highlighter-rouge">ishasmorefrags</code>, <code class="language-plaintext highlighter-rouge">islastfrag</code>, <code class="language-plaintext highlighter-rouge">log_level</code>, <code class="language-plaintext highlighter-rouge">log_prefix</code>, <code class="language-plaintext highlighter-rouge">log_uid</code>, <code class="language-plaintext highlighter-rouge">mark</code>, <code class="language-plaintext highlighter-rouge">mask</code>, <code class="language-plaintext highlighter-rouge">mss</code>, <code class="language-plaintext highlighter-rouge">owner</code>, <code class="language-plaintext highlighter-rouge">pkttype</code>, <code class="language-plaintext highlighter-rouge">rate_limiting</code>, <code class="language-plaintext highlighter-rouge">recent_limiting</code>, <code class="language-plaintext highlighter-rouge">reject_type</code>, <code class="language-plaintext highlighter-rouge">snat</code>, <code class="language-plaintext highlighter-rouge">socket</code>, <code class="language-plaintext highlighter-rouge">state_match</code>, <code class="language-plaintext highlighter-rouge">tcp_flags</code>.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">iptables</code>: Iptables type provider
    <ul>
      <li>Required binaries: <code class="language-plaintext highlighter-rouge">iptables-save</code>, <code class="language-plaintext highlighter-rouge">iptables</code>.</li>
      <li>Default for <code class="language-plaintext highlighter-rouge">kernel</code> == <code class="language-plaintext highlighter-rouge">linux</code>.</li>
      <li>Supported features: <code class="language-plaintext highlighter-rouge">address_type</code>, <code class="language-plaintext highlighter-rouge">clusterip</code>, <code class="language-plaintext highlighter-rouge">connection_limiting</code>, <code class="language-plaintext highlighter-rouge">dnat</code>, <code class="language-plaintext highlighter-rouge">icmp_match</code>, <code class="language-plaintext highlighter-rouge">interface_match</code>, <code class="language-plaintext highlighter-rouge">iprange</code>, <code class="language-plaintext highlighter-rouge">ipsec_dir</code>, <code class="language-plaintext highlighter-rouge">ipsec_policy</code>, <code class="language-plaintext highlighter-rouge">ipset</code>, <code class="language-plaintext highlighter-rouge">iptables</code>, <code class="language-plaintext highlighter-rouge">isfragment</code>, <code class="language-plaintext highlighter-rouge">log_level</code>, <code class="language-plaintext highlighter-rouge">log_prefix</code>, <code class="language-plaintext highlighter-rouge">log_uid</code>, <code class="language-plaintext highlighter-rouge">mark</code>, <code class="language-plaintext highlighter-rouge">mask</code>, <code class="language-plaintext highlighter-rouge">mss</code>, <code class="language-plaintext highlighter-rouge">netmap</code>, <code class="language-plaintext highlighter-rouge">owner</code>, <code class="language-plaintext highlighter-rouge">pkttype</code>, <code class="language-plaintext highlighter-rouge">rate_limiting</code>, <code class="language-plaintext highlighter-rouge">recent_limiting</code>, <code class="language-plaintext highlighter-rouge">reject_type</code>, <code class="language-plaintext highlighter-rouge">snat</code>, <code class="language-plaintext highlighter-rouge">socket</code>, <code class="language-plaintext highlighter-rouge">state_match</code>, <code class="language-plaintext highlighter-rouge">tcp_flags</code>.</li>
    </ul>
  </li>
</ul>

<p><strong>Autorequires:</strong></p>

<p>If Puppet is managing the iptables or ip6tables chains specified in the <code class="language-plaintext highlighter-rouge">chain</code> or <code class="language-plaintext highlighter-rouge">jump</code> parameters, the firewall resource will autorequire those firewallchain resources.</p>

<p>If Puppet is managing the iptables or iptables-persistent packages, and the provider is iptables or ip6tables, the firewall resource will autorequire those packages to ensure that any required binaries are installed.</p>

<h4 id="features">Features</h4>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">address_type</code>: The ability to match on source or destination address type.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">clusterip</code>: Configure a simple cluster of nodes that share a certain IP and MAC address without an explicit load balancer in front of them.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">connection_limiting</code>: Connection limiting features.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dnat</code>: Destination NATing.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">hop_limiting</code>: Hop limiting features.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">icmp_match</code>: The ability to match ICMP types.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">interface_match</code>: Interface matching.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">iprange</code>: The ability to match on source or destination IP range.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ipsec_dir</code>: The ability to match IPsec policy direction.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ipsec_policy</code>: The ability to match IPsec policy.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">iptables</code>: The provider provides iptables features.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">isfirstfrag</code>: The ability to match the first fragment of a fragmented ipv6 packet.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">isfragment</code>: The ability to match fragments.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ishasmorefrags</code>: The ability to match a non-last fragment of a fragmented ipv6 packet.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">islastfrag</code>: The ability to match the last fragment of an ipv6 packet.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">log_level</code>: The ability to control the log level.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">log_prefix</code>: The ability to add prefixes to log messages.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">log_uid</code>: The ability to log the userid of the process which generated the packet.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">mark</code>: The ability to match or set the netfilter mark value associated with the packet.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">mask</code>:  The ability to match recent rules based on the ipv4 mask.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">owner</code>: The ability to match owners.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">pkttype</code>: The ability to match a packet type.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">rate_limiting</code>: Rate limiting features.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">recent_limiting</code>: The netfilter recent module.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">reject_type</code>: The ability to control reject messages.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">set_mss</code>: Set the TCP MSS of a packet.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">snat</code>: Source NATing.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">socket</code>: The ability to match open sockets.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">state_match</code>: The ability to match stateful firewall states.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">tcp_flags</code>: The ability to match on particular TCP flag settings.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">netmap</code>: The ability to map entire subnets via source or destination nat rules.</p>
  </li>
</ul>

<h4 id="parameters">Parameters</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">action</code>: This is the action to perform on a match. Valid values for this action are:
    <ul>
      <li>‘accept’: The packet is accepted.</li>
      <li>‘reject’: The packet is rejected with a suitable ICMP response.</li>
      <li>‘drop’: The packet is dropped.</li>
    </ul>

    <p>If you specify no value it will simply match the rule but perform no action unless you provide a provider-specific parameter (such as <code class="language-plaintext highlighter-rouge">jump</code>).</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">burst</code>: Rate limiting burst value (per second) before limit checks apply. Values must match ‘/^\d+$/’. Requires the <code class="language-plaintext highlighter-rouge">rate_limiting</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">clusterip_new</code>: Create a new ClusterIP. You always have to set this on the first rule for a given ClusterIP. Requires the <code class="language-plaintext highlighter-rouge">clusterip</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">clusterip_hashmode</code>: Specify the hashing mode. Valid values are sourceip, sourceip-sourceport, sourceip-sourceport-destport. Requires the <code class="language-plaintext highlighter-rouge">clusterip</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">clusterip_clustermac</code>: Specify the ClusterIP MAC address. Has to be a link-layer multicast address. Requires the <code class="language-plaintext highlighter-rouge">clusterip</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">clusterip_total_nodes</code>: Number of total nodes within this cluster. Requires the <code class="language-plaintext highlighter-rouge">clusterip</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">clusterip_local_node</code>: Local node number within this cluster. Requires the <code class="language-plaintext highlighter-rouge">clusterip</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">clusterip_hash_init</code>: Specify the random seed used for hash initialization. Requires the <code class="language-plaintext highlighter-rouge">clusterip</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">chain</code>: Name of the chain to use. You can provide a user-based chain or use one of the following built-in chains:’INPUT’,’FORWARD’,’OUTPUT’,’PREROUTING’, or ‘POSTROUTING’. The default value is ‘INPUT’. Values must match ‘/^[a-zA-Z0-9-_]+$/’. Requires the <code class="language-plaintext highlighter-rouge">iptables</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">checksum_fill</code>: When using a <code class="language-plaintext highlighter-rouge">jump</code> value of ‘CHECKSUM’, this boolean makes sure that a checksum is calculated and filled in a packet that lacks a checksum. Valid values are ‘true’ or ‘false’. Requires the <code class="language-plaintext highlighter-rouge">iptables</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">clamp_mss_to_pmtu</code>: Enables PMTU Clamping support when using a jump target of ‘TCPMSS’. Valid values are ‘true’ or ‘false’.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">connlimit_above</code>: Connection limiting value for matched connections above n. Values must match ‘/^\d+$/’. Requires the <code class="language-plaintext highlighter-rouge">connection_limiting</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">connlimit_mask</code>: Connection limiting by subnet mask for matched connections. Apply a subnet mask of /0 to /32 for IPv4, and a subnet mask of /0 to /128 for IPv6. Values must match ‘/^\d+$/’. Requires the <code class="language-plaintext highlighter-rouge">connection_limiting</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">connmark</code>: Match the Netfilter mark value associated with the packet. Accepts values <code class="language-plaintext highlighter-rouge">mark/mask</code> or <code class="language-plaintext highlighter-rouge">mark</code>. These will be converted to hex if they are not hex already. Requires the <code class="language-plaintext highlighter-rouge">mark</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ctstate</code>: Matches a packet based on its state in the firewall stateful inspection table, using the conntrack module. Valid values are: ‘INVALID’, ‘ESTABLISHED’, ‘NEW’, ‘RELATED’. Requires the <code class="language-plaintext highlighter-rouge">state_match</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">date_start</code>: Start Date/Time for the rule to match, which must be in ISO 8601 “T” notation. The possible time range is ‘1970-01-01T00:00:00’ to ‘2038-01-19T04:17:07’</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">date_stop</code>: End Date/Time for the rule to match, which must be in ISO 8601 “T” notation. The possible time range is ‘1970-01-01T00:00:00’ to ‘2038-01-19T04:17:07’</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">destination</code>: The destination address to match. For example: <code class="language-plaintext highlighter-rouge">destination =&gt; '192.168.1.0/24'</code>. You can also negate a mask by putting ! in front. For example: <code class="language-plaintext highlighter-rouge">destination  =&gt; '! 192.168.2.0/24'</code>. The destination can also be an IPv6 address if your provider supports it.</p>

    <p>For some firewall providers you can pass a range of ports in the format: ‘start number-end number’. For example, ‘1-1024’ would cover ports 1 to 1024.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dport</code>: The destination port to match for this filter (if the protocol supports ports). Will accept a single element or an array. For some firewall providers you can pass a range of ports in the format: ‘start number-end number’. For example, ‘1-1024’ would cover ports 1 to 1024.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dst_range</code>: The destination IP range. For example: <code class="language-plaintext highlighter-rouge">dst_range =&gt; '192.168.1.1-192.168.1.10'</code>.</p>

    <p>The destination IP range is must in ‘IP1-IP2’ format. Values in the range must be valid IPv4 or IPv6 addresses. Requires the <code class="language-plaintext highlighter-rouge">iprange</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dst_type</code>: The destination address type. For example: <code class="language-plaintext highlighter-rouge">dst_type =&gt; 'LOCAL'</code>.</p>

    <p>Valid values are:</p>

    <ul>
      <li>‘UNSPEC’: an unspecified address</li>
      <li>‘UNICAST’: a unicast address</li>
      <li>‘LOCAL’: a local address</li>
      <li>‘BROADCAST’: a broadcast address</li>
      <li>‘ANYCAST’: an anycast packet</li>
      <li>‘MULTICAST’: a multicast address</li>
      <li>‘BLACKHOLE’: a blackhole address</li>
      <li>‘UNREACHABLE’: an unreachable address</li>
      <li>‘PROHIBIT’: a prohibited address</li>
      <li>‘THROW’: an unroutable address</li>
      <li>‘XRESOLVE: an unresolvable address</li>
    </ul>

    <p>Requires the <code class="language-plaintext highlighter-rouge">address_type</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ensure</code>: Ensures that the resource is present. Valid values are ‘present’, ‘absent’. The default is ‘present’.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">gateway</code>: Used with TEE target to mirror traffic of a machine to a secondary host on the LAN.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">gid</code>: GID or Group owner matching rule. Accepts a string argument only, as iptables does not accept multiple gid in a single statement. Requires the <code class="language-plaintext highlighter-rouge">owner</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">hop_limit</code>: Hop limiting value for matched packets. Values must match ‘/^\d+$/’. Requires the <code class="language-plaintext highlighter-rouge">hop_limiting</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">icmp</code>: When matching ICMP packets, this indicates the type of ICMP packet to match. A value of ‘any’ is not supported. To match any type of ICMP packet, the parameter should be omitted or undefined. Requires the <code class="language-plaintext highlighter-rouge">icmp_match</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">iniface</code>: Input interface to filter on. Values must match ‘/^!?\s?[a-zA-Z0-9-._+:]+$/’.  Requires the <code class="language-plaintext highlighter-rouge">interface_match</code> feature.  Supports interface alias (eth0:0) and negation.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ipsec_dir</code>: Sets the ipsec policy direction. Valid values are ‘in’, ‘out’. Requires the <code class="language-plaintext highlighter-rouge">ipsec_dir</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ipsec_policy</code>: Sets the ipsec policy type. Valid values are ‘none’, ‘ipsec’. Requires the <code class="language-plaintext highlighter-rouge">ipsec_policy</code> feature.</p>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td><code class="language-plaintext highlighter-rouge">ipset</code>: Matches IP sets. Value must be ‘ipset_name (src</td>
          <td>dst</td>
          <td>src,dst)’ and can be negated by putting ! in front. Requires ipset kernel module.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">isfirstfrag</code>: If true, matches when the packet is the first fragment of a fragmented ipv6 packet. Cannot be negated. Supported by ipv6 only. Valid values are ‘true’, ‘false’. Requires the <code class="language-plaintext highlighter-rouge">isfirstfrag</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">isfragment</code>: If ‘true’, matches when the packet is a tcp fragment of a fragmented packet. Supported by iptables only. Valid values are ‘true’, ‘false’. Requires features <code class="language-plaintext highlighter-rouge">isfragment</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ishasmorefrags</code>: If ‘true’, matches when the packet has the ‘more fragments’ bit set. Supported by ipv6 only. Valid values are ‘true’, ‘false’. Requires the <code class="language-plaintext highlighter-rouge">ishasmorefrags</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">islastfrag</code>: If true, matches when the packet is the last fragment of a fragmented ipv6 packet. Supported by ipv6 only. Valid values are ‘true’, ‘false’. Requires the <code class="language-plaintext highlighter-rouge">islastfrag</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">jump</code>: The value for the iptables <code class="language-plaintext highlighter-rouge">--jump</code> parameter. Any valid chain name is allowed, but normal values are: ‘QUEUE’, ‘RETURN’, ‘DNAT’, ‘SNAT’, ‘LOG’, ‘MASQUERADE’, ‘REDIRECT’, ‘MARK’, ‘TCPMSS’, ‘DSCP’.</p>

    <p>For the values ‘ACCEPT’, ‘DROP’, and ‘REJECT’, you must use the generic <code class="language-plaintext highlighter-rouge">action</code> parameter. This is to enforce the use of generic parameters where possible for maximum cross-platform modeling.</p>

    <p>If you set both <code class="language-plaintext highlighter-rouge">accept</code> and <code class="language-plaintext highlighter-rouge">jump</code> parameters, you will get an error, because only one of the options should be set. Requires the <code class="language-plaintext highlighter-rouge">iptables</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">kernel_timezone</code>: Use the kernel timezone instead of UTC to determine whether a packet meets the time regulations.</p>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td><code class="language-plaintext highlighter-rouge">limit</code>: Rate limiting value for matched packets. The format is: ‘rate/[/second/</td>
          <td>/minute</td>
          <td>/hour</td>
          <td>/day]’. Example values are: ‘50/sec’, ‘40/min’, ‘30/hour’, ‘10/day’. Requires the  <code class="language-plaintext highlighter-rouge">rate_limiting</code> feature.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">line</code>: Read-only property for caching the rule line.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">log_level</code>: When combined with <code class="language-plaintext highlighter-rouge">jump =&gt; 'LOG'</code> specifies the system log level to log to. Requires the <code class="language-plaintext highlighter-rouge">log_level</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">log_prefix</code>: When combined with <code class="language-plaintext highlighter-rouge">jump =&gt; 'LOG'</code> specifies the log prefix to use when logging. Requires the <code class="language-plaintext highlighter-rouge">log_prefix</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">log_uid</code>: The ability to log the userid of the process which generated the packet.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">mask</code>: Sets the mask to use when <code class="language-plaintext highlighter-rouge">recent</code> is enabled. Requires the <code class="language-plaintext highlighter-rouge">mask</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">month_days</code>: Only match on the given days of the month. Possible values are ‘1’ to ‘31’. Note that specifying ‘31’ will not match on months that do not have a 31st day; the same goes for 28- or 29-day February.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">match_mark</code>: Match the Netfilter mark value associated with the packet. Accepts either of mark/mask or mark. These will be converted to hex if they are not already. Requires the <code class="language-plaintext highlighter-rouge">mark</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">mss</code>: Sets a given TCP MSS value or range to match.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">name</code>: The canonical name of the rule. This name is also used for ordering, so make sure you prefix the rule with a number. For example:</p>

    <div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">firewall</span> <span class="p">{</span> <span class="s1">'000 this runs first'</span><span class="p">:</span>
<span class="c"># this rule will run first
</span><span class="p">}</span>
<span class="n">firewall</span> <span class="p">{</span> <span class="s1">'999 this runs last'</span><span class="p">:</span>
<span class="c"># this rule will run last
</span><span class="p">}</span>
</code></pre></div>    </div>

    <p>Depending on the provider, the name of the rule can be stored using the comment feature of the underlying firewall subsystem. Values must match ‘/^\d+[[:graph:][:space:]]+$/’.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">outiface</code>: Output interface to filter on. Values must match ‘/^!?\s?[a-zA-Z0-9-._+:]+$/’.  Requires the <code class="language-plaintext highlighter-rouge">interface_match</code> feature.  Supports interface alias (eth0:0) and negation.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">physdev_in</code>: Match if the packet is entering a bridge from the given interface. Values must match ‘/^[a-zA-Z0-9-._+]+$/’.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">physdev_out</code>: Match if the packet is leaving a bridge via the given interface. Values must match ‘/^[a-zA-Z0-9-._+]+$/’.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">physdev_is_bridged</code>: Match if the packet is transversing a bridge. Valid values are true or false.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">pkttype</code>: Sets the packet type to match. Valid values are: ‘unicast’, ‘broadcast’, and’multicast’. Requires the <code class="language-plaintext highlighter-rouge">pkttype</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">port</code>: <em>DEPRECATED</em> Using the unspecific ‘port’ parameter can lead to firewall rules that are unexpectedly too lax. It is recommended to always use the specific dport and sport parameters to avoid this ambiguity. The destination or source port to match for this filter (if the protocol supports ports). Will accept a single element or an array. For some firewall providers you can pass a range of ports in the format: ‘start number-end number’. For example, ‘1-1024’ would cover ports 1 to 1024.</p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">proto</code>: The specific protocol to match for this rule. This is ‘tcp’ by default. Valid values are:
    <ul>
      <li>‘tcp’</li>
      <li>‘udp’</li>
      <li>‘icmp’</li>
      <li>‘ipv4’</li>
      <li>‘ipv6’</li>
      <li>‘ipv6-icmp’</li>
      <li>‘esp’</li>
      <li>‘ah’</li>
      <li>‘vrrp’</li>
      <li>‘igmp’</li>
      <li>‘ipencap’</li>
      <li>‘ospf’</li>
      <li>‘gre’</li>
      <li>‘all’</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">provider</code>: The specific backend to use for this firewall resource. You will seldom need to specify this — Puppet will usually discover the appropriate provider for your platform. Available providers are ip6tables and iptables. See the <a href="#providers">Providers</a> section above for details about these providers.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">random</code>: When using a <code class="language-plaintext highlighter-rouge">jump</code> value of ‘MASQUERADE’, ‘DNAT’, ‘REDIRECT’, or ‘SNAT’, this boolean will enable randomized port mapping. Valid values are true or false. Requires the <code class="language-plaintext highlighter-rouge">dnat</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">rdest</code>: If boolean ‘true’, adds the destination IP address to the list. Valid values are true or false. Requires the <code class="language-plaintext highlighter-rouge">recent_limiting</code> feature and the <code class="language-plaintext highlighter-rouge">recent</code> parameter.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">reap</code>: Can only be used in conjunction with the <code class="language-plaintext highlighter-rouge">rseconds</code> parameter. If boolean ‘true’, this will purge entries older than ‘seconds’ as specified in <code class="language-plaintext highlighter-rouge">rseconds</code>. Valid values are true or false. Requires the <code class="language-plaintext highlighter-rouge">recent_limiting</code> feature and the <code class="language-plaintext highlighter-rouge">recent</code> parameter.</p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">recent</code>: Enable the recent module. Valid values are: ‘set’, ‘update’, ‘rcheck’, or ‘remove’. For example:</li>
</ul>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># If anyone's appeared on the 'badguy' blacklist within
# the last 60 seconds, drop their traffic, and update the timestamp.
</span><span class="n">firewall</span> <span class="p">{</span> <span class="s1">'100 Drop badguy traffic'</span><span class="p">:</span>
  <span class="py">recent</span>   <span class="p">=&gt;</span> <span class="s1">'update'</span><span class="p">,</span>
  <span class="py">rseconds</span> <span class="p">=&gt;</span> <span class="m">60</span><span class="p">,</span>
  <span class="py">rsource</span>  <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
  <span class="py">rname</span>    <span class="p">=&gt;</span> <span class="s1">'badguy'</span><span class="p">,</span>
  <span class="py">action</span>   <span class="p">=&gt;</span> <span class="s1">'DROP'</span><span class="p">,</span>
  <span class="py">chain</span>    <span class="p">=&gt;</span> <span class="s1">'FORWARD'</span><span class="p">,</span>
<span class="p">}</span>
<span class="c"># No-one should be sending us traffic on eth0 from localhost
# Blacklist them
</span><span class="n">firewall</span> <span class="p">{</span> <span class="s1">'101 blacklist strange traffic'</span><span class="p">:</span>
  <span class="py">recent</span>      <span class="p">=&gt;</span> <span class="s1">'set'</span><span class="p">,</span>
  <span class="py">rsource</span>     <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
  <span class="py">rname</span>       <span class="p">=&gt;</span> <span class="s1">'badguy'</span><span class="p">,</span>
  <span class="py">destination</span> <span class="p">=&gt;</span> <span class="s1">'127.0.0.0/8'</span><span class="p">,</span>
  <span class="py">iniface</span>     <span class="p">=&gt;</span> <span class="s1">'eth0'</span><span class="p">,</span>
  <span class="py">action</span>      <span class="p">=&gt;</span> <span class="s1">'DROP'</span><span class="p">,</span>
  <span class="py">chain</span>       <span class="p">=&gt;</span> <span class="s1">'FORWARD'</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Requires the <code class="language-plaintext highlighter-rouge">recent_limiting</code> feature.</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">reject</code>: When combined with <code class="language-plaintext highlighter-rouge">jump =&gt; 'REJECT'</code>, you can specify a different ICMP response to be sent back to the packet sender. Requires the <code class="language-plaintext highlighter-rouge">reject_type</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">rhitcount</code>: Used in conjunction with <code class="language-plaintext highlighter-rouge">recent =&gt; 'update'</code> or <code class="language-plaintext highlighter-rouge">recent =&gt; 'rcheck'</code>. When used, this will narrow the match to happen only when the address is in the list and packets greater than or equal to the given value have been received. Requires the <code class="language-plaintext highlighter-rouge">recent_limiting</code> feature and the <code class="language-plaintext highlighter-rouge">recent</code> parameter.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">rname</code>: Specify the name of the list. Takes a string argument. Requires the <code class="language-plaintext highlighter-rouge">recent_limiting</code> feature and the <code class="language-plaintext highlighter-rouge">recent</code> parameter.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">rseconds</code>: Used in conjunction with <code class="language-plaintext highlighter-rouge">recent =&gt; 'rcheck'</code> or <code class="language-plaintext highlighter-rouge">recent =&gt; 'update'</code>. When used, this will narrow the match to only happen when the address is in the list and was seen within the last given number of seconds. Requires the <code class="language-plaintext highlighter-rouge">recent_limiting</code> feature and the <code class="language-plaintext highlighter-rouge">recent</code> parameter.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">rsource</code>: If boolean ‘true’, adds the source IP address to the list. Valid values are ‘true’, ‘false’. Requires the <code class="language-plaintext highlighter-rouge">recent_limiting</code> feature and the <code class="language-plaintext highlighter-rouge">recent</code> parameter.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">rttl</code>: May only be used in conjunction with <code class="language-plaintext highlighter-rouge">recent =&gt; 'rcheck'</code> or <code class="language-plaintext highlighter-rouge">recent =&gt; 'update'</code>. If boolean ‘true’, this will narrow the match to happen only when the address is in the list and the TTL of the current packet matches that of the packet that hit the <code class="language-plaintext highlighter-rouge">recent =&gt; 'set'</code> rule. If you have problems with DoS attacks via bogus packets from fake source addresses, this parameter may help. Valid values are ‘true’, ‘false’. Requires the <code class="language-plaintext highlighter-rouge">recent_limiting</code> feature and the <code class="language-plaintext highlighter-rouge">recent</code> parameter.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">set_dscp</code>: When combined with <code class="language-plaintext highlighter-rouge">jump =&gt; 'DSCP'</code> specifies the dscp marking associated with the packet.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">set_dscp_class</code>: When combined with <code class="language-plaintext highlighter-rouge">jump =&gt; 'DSCP'</code> specifies the class associated with the packet (valid values found here: http://www.cisco.com/c/en/us/support/docs/quality-of-service-qos/qos-packet-marking/10103-dscpvalues.html#packetclassification).</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">set_mark</code>: Set the Netfilter mark value associated with the packet. Accepts either  ‘mark/mask’ or ‘mark’. These will be converted to hex if they are not already. Requires the <code class="language-plaintext highlighter-rouge">mark</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">set_mss</code>: When combined with <code class="language-plaintext highlighter-rouge">jump =&gt; 'TCPMSS'</code> specifies the value of the MSS field.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">socket</code>: If ‘true’, matches if an open socket can be found by doing a socket lookup on the packet. Valid values are ‘true’, ‘false’. Requires the <code class="language-plaintext highlighter-rouge">socket</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">source</code>: The source address. For example: <code class="language-plaintext highlighter-rouge">source =&gt; '192.168.2.0/24'</code>. You can also negate a mask by putting ! in front. For example: <code class="language-plaintext highlighter-rouge">source =&gt; '! 192.168.2.0/24'</code>. The source can also be an IPv6 address if your provider supports it.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">sport</code>: The source port to match for this filter (if the protocol supports ports). Will accept a single element or an array. For some firewall providers you can pass a range of ports in the format:’start number-end number’. For example, ‘1-1024’ would cover ports 1 to 1024.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">src_range</code>: The source IP range. For example: <code class="language-plaintext highlighter-rouge">src_range =&gt; '192.168.1.1-192.168.1.10'</code>. The source IP range must be in ‘IP1-IP2’ format. Values in the range must be valid IPv4 or IPv6 addresses. Requires the <code class="language-plaintext highlighter-rouge">iprange</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">src_type</code>: Specify the source address type. For example: <code class="language-plaintext highlighter-rouge">src_type =&gt; 'LOCAL'</code>.</p>

    <p>Valid values are:</p>

    <ul>
      <li>‘UNSPEC’: an unspecified address.</li>
      <li>‘UNICAST’: a unicast address.</li>
      <li>‘LOCAL’: a local address.</li>
      <li>‘BROADCAST’: a broadcast address.</li>
      <li>‘ANYCAST’: an anycast packet.</li>
      <li>‘MULTICAST’: a multicast address.</li>
      <li>‘BLACKHOLE’: a blackhole address.</li>
      <li>‘UNREACHABLE’: an unreachable address.</li>
      <li>‘PROHIBIT’: a prohibited address.</li>
      <li>‘THROW’: an unroutable address.</li>
      <li>‘XRESOLVE’: an unresolvable address.</li>
    </ul>

    <p>Requires the <code class="language-plaintext highlighter-rouge">address_type</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">stat_every</code>: Match one packet every nth packet. Requires <code class="language-plaintext highlighter-rouge">stat_mode =&gt; 'nth'</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">stat_mode</code>: Set the matching mode for statistic matching. Supported modes are <code class="language-plaintext highlighter-rouge">random</code> and <code class="language-plaintext highlighter-rouge">nth</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">stat_packet</code>: Set the initial counter value for the nth mode. Must be between 0 and the value of <code class="language-plaintext highlighter-rouge">stat_every</code>. Defaults to 0. Requires <code class="language-plaintext highlighter-rouge">stat_mode =&gt; 'nth'</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">stat_probability</code>: Set the probability from 0 to 1 for a packet to be randomly matched. It works only with <code class="language-plaintext highlighter-rouge">stat_mode =&gt; 'random'</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">state</code>: Matches a packet based on its state in the firewall stateful inspection table. Valid values are: ‘INVALID’, ‘ESTABLISHED’, ‘NEW’, ‘RELATED’. Requires the <code class="language-plaintext highlighter-rouge">state_match</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">table</code>: Table to use. Valid values are: ‘nat’, ‘mangle’, ‘filter’, ‘raw’, ‘rawpost’. By default the setting is ‘filter’. Requires the <code class="language-plaintext highlighter-rouge">iptables</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">tcp_flags</code>: Match when the TCP flags are as specified. Set as a string with a list of comma-separated flag names for the mask, then a space, then a comma-separated list of flags that should be set. The flags are: ‘SYN’, ‘ACK’, ‘FIN’, ‘RST’, ‘URG’, ‘PSH’, ‘ALL’, ‘NONE’.</p>

    <p>Note that you specify flags in the order that iptables <code class="language-plaintext highlighter-rouge">--list</code> rules would list them to avoid having Puppet think you changed the flags. For example, ‘FIN,SYN,RST,ACK SYN’ matches packets with the SYN bit set and the ACK, RST and FIN bits cleared. Such packets are used to request TCP connection initiation. Requires the <code class="language-plaintext highlighter-rouge">tcp_flags</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">time_contiguous</code>: When the <code class="language-plaintext highlighter-rouge">time_stop</code> value is smaller than the <code class="language-plaintext highlighter-rouge">time_start</code> value, match this as a single time period instead of distinct intervals.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">time_start</code>: Start time for the rule to match. The possible time range is ‘00:00:00’ to ‘23:59:59’. Leading zeroes are allowed (e.g. ‘06:03’) and correctly interpreted as base-10.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">time_stop</code>: End time for the rule to match. The possible time range is ‘00:00:00’ to ‘23:59:59’. Leading zeroes are allowed (e.g. ‘06:03’) and correctly interpreted as base-10.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">todest</code>: When using <code class="language-plaintext highlighter-rouge">jump =&gt; 'DNAT'</code>, you can specify the new destination address using this parameter. Requires the <code class="language-plaintext highlighter-rouge">dnat</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">toports</code>: For DNAT this is the port that will replace the destination port. Requires the <code class="language-plaintext highlighter-rouge">dnat</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">tosource</code>: When using <code class="language-plaintext highlighter-rouge">jump =&gt; 'SNAT'</code>, you can specify the new source address using this parameter. Requires the <code class="language-plaintext highlighter-rouge">snat</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">to</code>: When using <code class="language-plaintext highlighter-rouge">jump =&gt; 'NETMAP'</code>, you can specify a source or destination subnet to nat to. Requires the <code class="language-plaintext highlighter-rouge">netmap</code> feature`.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">uid</code>: UID or Username owner matching rule. Accepts a string argument only, as iptables does not accept multiple uid in a single statement. Requires the <code class="language-plaintext highlighter-rouge">owner</code> feature.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">week_days</code>: Only match on the given weekdays. Possible values are ‘Mon’, ‘Tue’, ‘Wed’, ‘Thu’, ‘Fri’, ‘Sat’, ‘Sun’.</p>
  </li>
</ul>

<h3 id="type-firewallchain">Type: firewallchain</h3>

<p>Enables you to manage rule chains for firewalls.</p>

<p>Currently this type supports only iptables, ip6tables, and ebtables on Linux. It also provides support for setting the default policy on chains and tables that allow it.</p>

<p><strong>Autorequires</strong>: If Puppet is managing the iptables or iptables-persistent packages, and the provider is iptables_chain, the firewall resource will autorequire those packages to ensure that any required binaries are installed.</p>

<h4 id="providers-1">Providers</h4>

<p><code class="language-plaintext highlighter-rouge">iptables_chain</code> is the only provider that supports firewallchain.</p>

<h4 id="features-1">Features</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">iptables_chain</code>: The provider provides iptables chain features.</li>
  <li><code class="language-plaintext highlighter-rouge">policy</code>: Default policy (inbuilt chains only).</li>
</ul>

<h4 id="parameters-1">Parameters</h4>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ensure</code>: Ensures that the resource is present. Valid values are ‘present’, ‘absent’.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ignore</code>: Regex to perform on firewall rules to exempt unmanaged rules from purging (when enabled). This is matched against the output of iptables-save. This can be a single regex or an array of them. To support flags, use the ruby inline flag mechanism: a regex such as ‘/foo/i’ can be written as ‘(?i)foo’ or ‘(?i:foo)’. Only when purge is ‘true’.</p>

    <p>Full example:</p>
    <div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">firewallchain</span> <span class="p">{</span> <span class="s1">'INPUT:filter:IPv4'</span><span class="p">:</span>
<span class="py">purge</span>  <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
<span class="py">ignore</span> <span class="p">=&gt;</span> <span class="p">[</span>
  <span class="c"># ignore the fail2ban jump rule
</span>  <span class="s1">'-j fail2ban-ssh'</span><span class="p">,</span>
  <span class="c"># ignore any rules with "ignore" (case insensitive) in the comment in the rule
</span>  <span class="s1">'--comment "[^"](?i:ignore)[^"]"'</span><span class="p">,</span>
  <span class="p">],</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">name</code>: Specify the canonical name of the chain. For iptables the format must be {chain}:{table}:{protocol}.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">policy</code>: Set the action the packet will perform when the end of the chain is reached. It can only be set on inbuilt chains (‘INPUT’, ‘FORWARD’, ‘OUTPUT’, ‘PREROUTING’, ‘POSTROUTING’). Valid values are:</p>

    <ul>
      <li>‘accept’: The packet is accepted.</li>
      <li>‘drop’: The packet is dropped.</li>
      <li>‘queue’: The packet is passed userspace.</li>
      <li>‘return’: The packet is returned to calling (jump) queue or to the default of inbuilt chains.</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">provider</code>: The specific backend to use for this firewallchain resource. You will seldom need to specify this — Puppet will usually discover the appropriate provider for your platform. The only available provider is:</p>

    <p><code class="language-plaintext highlighter-rouge">iptables_chain</code>: iptables chain provider</p>

    <ul>
      <li>Required binaries: <code class="language-plaintext highlighter-rouge">ebtables-save</code>, <code class="language-plaintext highlighter-rouge">ebtables</code>, <code class="language-plaintext highlighter-rouge">ip6tables-save</code>, <code class="language-plaintext highlighter-rouge">ip6tables</code>, <code class="language-plaintext highlighter-rouge">iptables-save</code>, <code class="language-plaintext highlighter-rouge">iptables</code>.</li>
      <li>Default for <code class="language-plaintext highlighter-rouge">kernel</code> == <code class="language-plaintext highlighter-rouge">linux</code>.</li>
      <li>Supported features: <code class="language-plaintext highlighter-rouge">iptables_chain</code>, <code class="language-plaintext highlighter-rouge">policy</code>.</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">purge</code>: Purge unmanaged firewall rules in this chain. Valid values are ‘false’, ‘true’.</p>
  </li>
</ul>

<p><strong>Note</strong> This <code class="language-plaintext highlighter-rouge">purge</code> is purging unmanaged rules in a firewall chain, not unmanaged firewall chains. To purge unmanaged firewall chains, use the following instead.</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">resources</span> <span class="p">{</span> <span class="s1">'firewallchain'</span><span class="p">:</span>
  <span class="py">purge</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="fact-ip6tables_version">Fact: ip6tables_version</h3>

<p>A Facter fact that can be used to determine what the default version of ip6tables is for your operating system/distribution.</p>

<h3 id="fact-iptables_version">Fact: iptables_version</h3>

<p>A Facter fact that can be used to determine what the default version of iptables is for your operating system/distribution.</p>

<h3 id="fact-iptables_persistent_version">Fact: iptables_persistent_version</h3>

<p>Retrieves the version of iptables-persistent from your OS. This is a Debian/Ubuntu specific fact.</p>

<h2 id="limitations">Limitations</h2>

<h3 id="sles">SLES</h3>

<p>The <code class="language-plaintext highlighter-rouge">socket</code> parameter is not supported on SLES.  In this release it will cause
the catalog to fail with iptables failures, rather than correctly warn you that
the features are unusable.</p>

<h3 id="oracle-enterprise-linux">Oracle Enterprise Linux</h3>

<p>The <code class="language-plaintext highlighter-rouge">socket</code> and <code class="language-plaintext highlighter-rouge">owner</code> parameters are unsupported on Oracle Enterprise Linux
when the “Unbreakable” kernel is used. These may function correctly when using
the stock RedHat kernel instead. Declaring either of these parameters on an
unsupported system will result in iptable rules failing to apply.</p>

<h3 id="debian-8-support">Debian 8 Support</h3>

<p>As Puppet Enterprise itself does not yet support Debian 8, use of this module with Puppet Enterprise under a Debian 8
system should be regarded as experimental.</p>

<h3 id="known-issues">Known Issues</h3>

<h4 id="mcollective-causes-pe-to-reverse-firewall-rule-order">MCollective causes PE to reverse firewall rule order</h4>

<p>Firewall rules appear in reverse order if you use MCollective to run Puppet in Puppet Enterprise 2016.1, 2015.3, 2015.2, or 3.8.x.</p>

<p>If you use MCollective to kick off Puppet runs (<code class="language-plaintext highlighter-rouge">mco puppet runonce -I agent.example.com</code>) while also using the <a href="https://forge.puppet.com/puppetlabs/firewall"><code class="language-plaintext highlighter-rouge">puppetlabs/firewall</code></a> module, your firewall rules might be listed in reverse order.</p>

<p>In many firewall configurations, the last rule drops all packets. If the rule order is reversed, this rule is listed first and network connectivity fails.</p>

<p>To prevent this issue, do not use MCollective to kick off Puppet runs. Use any of the following instead:</p>

<ul>
  <li>Run <code class="language-plaintext highlighter-rouge">puppet agent -t</code> on the command line.</li>
  <li>Use a cron job.</li>
  <li>Click <a href="https://docs.puppet.com/pe/2016.1/console_classes_groups_running_puppet.html#run-puppet-on-an-individual-node">Run Puppet</a> in the console.</li>
</ul>

<h4 id="reporting-issues">Reporting Issues</h4>

<p>Report found bugs in JIRA:</p>

<p><a href="http://tickets.puppetlabs.com">http://tickets.puppetlabs.com</a></p>

<h2 id="development">Development</h2>

<p>Puppet Labs modules on the Puppet Forge are open projects, and community contributions are essential for keeping them great. We can’t access the huge number of platforms and myriad of hardware, software, and deployment configurations that Puppet is intended to serve.</p>

<p>We want to keep it as easy as possible to contribute changes so that our modules work in your environment. There are a few guidelines that we need contributors to follow so that we can have a chance of keeping on top of things.</p>

<p>You can read the complete module contribution guide <a href="http://projects.puppetlabs.com/projects/module-site/wiki/Module_contributing">on the Puppet Labs wiki.</a></p>

<p>For this particular module, please also read CONTRIBUTING.md before contributing.</p>

<p>Currently we support:</p>

<ul>
  <li>iptables</li>
  <li>ip6tables</li>
  <li>ebtables (chains only)</li>
</ul>

<h3 id="testing">Testing</h3>

<p>Make sure you have:</p>

<ul>
  <li>rake</li>
  <li>bundler</li>
</ul>

<p>Install the necessary gems:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle install
</code></pre></div></div>

<p>And run the tests from the root of the source code:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rake test
</code></pre></div></div>

<p>If you have a copy of Vagrant 1.1.0 you can also run the system tests:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RS_SET=ubuntu-1404-x64 rspec spec/acceptance
RS_SET=centos-64-x64 rspec spec/acceptance
</code></pre></div></div>


      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/RussianPenguin/russianpenguin.github.io">russianpenguin.github.io</a> is maintained by <a href="https://github.com/RussianPenguin">RussianPenguin</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(69889387, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/69889387" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
  </body>
</html>
