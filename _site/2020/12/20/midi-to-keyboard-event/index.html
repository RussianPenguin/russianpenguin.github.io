<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta name="yandex-verification" content="551ffc5ae1433df6" />
    
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>MIDI: Превращаем сообщения в нажатия кнопок клавиатуры | Чтобы не забыть</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="MIDI: Превращаем сообщения в нажатия кнопок клавиатуры" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Как конвертировать сообщения от midi-клавиатуры в нажатия кнопок на клавиатуре? Где это может потребоваться - это в приложениях, которые не умеют в миди, но умеют в хоткеи. Например musescore - это приложение очень плохо умеет в миди. Создадим простейший скрипт midi-to-keyboard. Все что он делает - это слушает события на шине и транслирует их в нажатия кнопок клавиатуры. #!/usr/bin/env bash THROTTLE=150 old_time=0 last_change=0 #aseqdump -p &quot;Arturia MiniLab mkII&quot; | \ aseqdump -p &quot;System&quot; | \ while IFS=&quot; ,&quot; read src ev1 ev2 ch label1 data1 label2 data2 rest; do current_time=$(($(date +%s%N)/1000000)) diff=$(($current_time-$old_time)) if [[ $diff -gt $THROTTLE &amp;&amp; &quot;$ch&quot; = 15 ]]; then # тротлинг событий обязателен change=0 case $data1 in 48 ) # effects 1 if [[ $data2 -gt 64 ]]; then xdotool key Right change=1 elif [[ $data2 -lt 64 ]]; then xdotool key Left change=1 fi ;; 49 ) # effects 2 if [[ $data2 -gt 64 ]]; then xdotool key Up change=1 elif [[ $data2 -lt 64 ]]; then xdotool key Down change=1 fi ;; esac if [[ change -eq 1 ]]; then echo &quot;Change after $(($current_time-$old_time))&quot; old_time=$current_time fi fi done Литература: SO: Translating MIDI input into computer keystrokes on Linux?" />
<meta property="og:description" content="Как конвертировать сообщения от midi-клавиатуры в нажатия кнопок на клавиатуре? Где это может потребоваться - это в приложениях, которые не умеют в миди, но умеют в хоткеи. Например musescore - это приложение очень плохо умеет в миди. Создадим простейший скрипт midi-to-keyboard. Все что он делает - это слушает события на шине и транслирует их в нажатия кнопок клавиатуры. #!/usr/bin/env bash THROTTLE=150 old_time=0 last_change=0 #aseqdump -p &quot;Arturia MiniLab mkII&quot; | \ aseqdump -p &quot;System&quot; | \ while IFS=&quot; ,&quot; read src ev1 ev2 ch label1 data1 label2 data2 rest; do current_time=$(($(date +%s%N)/1000000)) diff=$(($current_time-$old_time)) if [[ $diff -gt $THROTTLE &amp;&amp; &quot;$ch&quot; = 15 ]]; then # тротлинг событий обязателен change=0 case $data1 in 48 ) # effects 1 if [[ $data2 -gt 64 ]]; then xdotool key Right change=1 elif [[ $data2 -lt 64 ]]; then xdotool key Left change=1 fi ;; 49 ) # effects 2 if [[ $data2 -gt 64 ]]; then xdotool key Up change=1 elif [[ $data2 -lt 64 ]]; then xdotool key Down change=1 fi ;; esac if [[ change -eq 1 ]]; then echo &quot;Change after $(($current_time-$old_time))&quot; old_time=$current_time fi fi done Литература: SO: Translating MIDI input into computer keystrokes on Linux?" />
<link rel="canonical" href="http://localhost:4000/2020/12/20/midi-to-keyboard-event/" />
<meta property="og:url" content="http://localhost:4000/2020/12/20/midi-to-keyboard-event/" />
<meta property="og:site_name" content="Чтобы не забыть" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-12-20T00:00:00+03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="MIDI: Превращаем сообщения в нажатия кнопок клавиатуры" />
<script type="application/ld+json">
{"headline":"MIDI: Превращаем сообщения в нажатия кнопок клавиатуры","dateModified":"2020-12-20T00:00:00+03:00","datePublished":"2020-12-20T00:00:00+03:00","description":"Как конвертировать сообщения от midi-клавиатуры в нажатия кнопок на клавиатуре? Где это может потребоваться - это в приложениях, которые не умеют в миди, но умеют в хоткеи. Например musescore - это приложение очень плохо умеет в миди. Создадим простейший скрипт midi-to-keyboard. Все что он делает - это слушает события на шине и транслирует их в нажатия кнопок клавиатуры. #!/usr/bin/env bash THROTTLE=150 old_time=0 last_change=0 #aseqdump -p &quot;Arturia MiniLab mkII&quot; | \\ aseqdump -p &quot;System&quot; | \\ while IFS=&quot; ,&quot; read src ev1 ev2 ch label1 data1 label2 data2 rest; do current_time=$(($(date +%s%N)/1000000)) diff=$(($current_time-$old_time)) if [[ $diff -gt $THROTTLE &amp;&amp; &quot;$ch&quot; = 15 ]]; then # тротлинг событий обязателен change=0 case $data1 in 48 ) # effects 1 if [[ $data2 -gt 64 ]]; then xdotool key Right change=1 elif [[ $data2 -lt 64 ]]; then xdotool key Left change=1 fi ;; 49 ) # effects 2 if [[ $data2 -gt 64 ]]; then xdotool key Up change=1 elif [[ $data2 -lt 64 ]]; then xdotool key Down change=1 fi ;; esac if [[ change -eq 1 ]]; then echo &quot;Change after $(($current_time-$old_time))&quot; old_time=$current_time fi fi done Литература: SO: Translating MIDI input into computer keystrokes on Linux?","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2020/12/20/midi-to-keyboard-event/"},"@type":"BlogPosting","url":"http://localhost:4000/2020/12/20/midi-to-keyboard-event/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/assets/css/style.css?v=eacdde9998fcd3dd17b1956e7070eca69fdaf217">
  </head>
  <body>
    <header class="page-header" role="banner">
      <h1 class="project-name">MIDI: Превращаем сообщения в нажатия кнопок клавиатуры</h1>
      <h2 class="project-tagline">Записная книжка рассеянного [в пространстве и времени] программиста</h2>
      
        <a href="https://github.com/RussianPenguin/russianpenguin.github.io" class="btn">View on GitHub</a>
      
      
    </header>

    <main id="content" class="main-content" role="main">
      <h1>MIDI: Превращаем сообщения в нажатия кнопок клавиатуры</h1>
<p>20 Dec 2020</p>

<p>Как конвертировать сообщения от midi-клавиатуры в нажатия кнопок на клавиатуре?</p>

<p>Где это может потребоваться - это в приложениях, которые не умеют в миди, но умеют в хоткеи. Например musescore - это приложение очень плохо умеет в миди.</p>

<p>Создадим простейший скрипт midi-to-keyboard. Все что он делает - это слушает события на шине и транслирует их в нажатия кнопок клавиатуры.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>
<span class="nv">THROTTLE</span><span class="o">=</span>150
<span class="nv">old_time</span><span class="o">=</span>0
<span class="nv">last_change</span><span class="o">=</span>0
<span class="c">#aseqdump -p "Arturia MiniLab mkII" | \</span>
aseqdump <span class="nt">-p</span> <span class="s2">"System"</span> | <span class="se">\</span>
<span class="k">while </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">" ,"</span> <span class="nb">read </span>src ev1 ev2 ch label1 data1 label2 data2 rest<span class="p">;</span> <span class="k">do
    </span><span class="nv">current_time</span><span class="o">=</span><span class="k">$((</span><span class="si">$(</span><span class="nb">date</span> +%s%N<span class="si">)</span><span class="o">/</span><span class="m">1000000</span><span class="k">))</span>
    <span class="nv">diff</span><span class="o">=</span><span class="k">$((</span><span class="nv">$current_time</span><span class="o">-</span><span class="nv">$old_time</span><span class="k">))</span>
    <span class="k">if</span> <span class="o">[[</span> <span class="nv">$diff</span> <span class="nt">-gt</span> <span class="nv">$THROTTLE</span> <span class="o">&amp;&amp;</span> <span class="s2">"</span><span class="nv">$ch</span><span class="s2">"</span> <span class="o">=</span> 15 <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        <span class="c"># тротлинг событий обязателен</span>
        <span class="nv">change</span><span class="o">=</span>0
        <span class="k">case</span> <span class="nv">$data1</span> <span class="k">in
            </span>48 <span class="p">)</span> <span class="c"># effects 1</span>
                <span class="k">if</span> <span class="o">[[</span> <span class="nv">$data2</span> <span class="nt">-gt</span> 64 <span class="o">]]</span><span class="p">;</span> <span class="k">then
                    </span>xdotool key Right
                    <span class="nv">change</span><span class="o">=</span>1
                <span class="k">elif</span> <span class="o">[[</span> <span class="nv">$data2</span> <span class="nt">-lt</span> 64 <span class="o">]]</span><span class="p">;</span> <span class="k">then
                    </span>xdotool key Left
                    <span class="nv">change</span><span class="o">=</span>1
                <span class="k">fi</span>
            <span class="p">;;</span>
            49 <span class="p">)</span> <span class="c"># effects 2</span>
                <span class="k">if</span> <span class="o">[[</span> <span class="nv">$data2</span> <span class="nt">-gt</span> 64 <span class="o">]]</span><span class="p">;</span> <span class="k">then
                    </span>xdotool key Up
                    <span class="nv">change</span><span class="o">=</span>1
                <span class="k">elif</span> <span class="o">[[</span> <span class="nv">$data2</span> <span class="nt">-lt</span> 64 <span class="o">]]</span><span class="p">;</span> <span class="k">then
                    </span>xdotool key Down
                    <span class="nv">change</span><span class="o">=</span>1
                <span class="k">fi</span>
            <span class="p">;;</span>
        <span class="k">esac</span>
        <span class="k">if</span> <span class="o">[[</span> change <span class="nt">-eq</span> 1 <span class="o">]]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"Change after </span><span class="k">$((</span><span class="nv">$current_time</span><span class="o">-</span><span class="nv">$old_time</span><span class="k">))</span><span class="s2">"</span>
            <span class="nv">old_time</span><span class="o">=</span><span class="nv">$current_time</span>
        <span class="k">fi
    fi
done</span>
</code></pre></div></div>

<p><strong>Литература:</strong></p>
<ul>
  <li><a href="https://superuser.com/questions/1170136/translating-midi-input-into-computer-keystrokes-on-linux">SO: Translating MIDI input into computer keystrokes on Linux?</a></li>
</ul>




      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/RussianPenguin/russianpenguin.github.io">russianpenguin.github.io</a> is maintained by <a href="https://github.com/RussianPenguin">RussianPenguin</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(69889387, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/69889387" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
  </body>
</html>
