<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta name="yandex-verification" content="551ffc5ae1433df6" />
    
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Linux: Обрабатываем RAW-изображения | Чтобы не забыть</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Linux: Обрабатываем RAW-изображения" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Рассмотрим основные инструменты для обработки raw-изображений. Так же посмотрим на метод стекинга изображения для получения качественной картинки." />
<meta property="og:description" content="Рассмотрим основные инструменты для обработки raw-изображений. Так же посмотрим на метод стекинга изображения для получения качественной картинки." />
<link rel="canonical" href="http://localhost:4000/2019/07/28/linux-%D0%BE%D0%B1%D1%80%D0%B0%D0%B1%D0%B0%D1%82%D1%8B%D0%B2%D0%B0%D0%B5%D0%BC-raw-%D0%B8%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F/" />
<meta property="og:url" content="http://localhost:4000/2019/07/28/linux-%D0%BE%D0%B1%D1%80%D0%B0%D0%B1%D0%B0%D1%82%D1%8B%D0%B2%D0%B0%D0%B5%D0%BC-raw-%D0%B8%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F/" />
<meta property="og:site_name" content="Чтобы не забыть" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-07-28T17:17:57+03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Linux: Обрабатываем RAW-изображения" />
<script type="application/ld+json">
{"url":"http://localhost:4000/2019/07/28/linux-%D0%BE%D0%B1%D1%80%D0%B0%D0%B1%D0%B0%D1%82%D1%8B%D0%B2%D0%B0%D0%B5%D0%BC-raw-%D0%B8%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F/","description":"Рассмотрим основные инструменты для обработки raw-изображений. Так же посмотрим на метод стекинга изображения для получения качественной картинки.","headline":"Linux: Обрабатываем RAW-изображения","dateModified":"2019-07-28T17:17:57+03:00","datePublished":"2019-07-28T17:17:57+03:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2019/07/28/linux-%D0%BE%D0%B1%D1%80%D0%B0%D0%B1%D0%B0%D1%82%D1%8B%D0%B2%D0%B0%D0%B5%D0%BC-raw-%D0%B8%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/assets/css/style.css?v=d85e6f1917405784d52928d499ab3e51b4bffcc9">
  </head>
  <body>
    <header class="page-header" role="banner">
      <h1 class="project-name">Linux: Обрабатываем RAW-изображения</h1>
      <h2 class="project-tagline">Записная книжка рассеянного [в пространстве и времени] программиста</h2>
      
        <a href="https://github.com/RussianPenguin/russianpenguin.github.io" class="btn">View on GitHub</a>
      
      
    </header>

    <main id="content" class="main-content" role="main">
      <h1>Linux: Обрабатываем RAW-изображения</h1>
<p>28 Jul 2019</p>

<p><img src="/assets/images/2019/07/resize_result.jpg?w=150" alt="resize_result" />Мы не будем говорить о том, как правильно\неправильно обрабатывать raw’ки. Мы поговорим об инструментах (конечно же консольных), которые можно применять для конвертирования, склейки и других операций.</p>

<p>Фото на превью - это то, что удалось вытащить из raw (конечно же оно пожатое в джипег и отресайзено для публикации).</p>

<!--more-->

<p>Сначала немного о технике если хотим получить относительно хороший снимой:</p>

<ul>
  <li>снимаем с брекетингом по экспозиции в 1-2 единицы в зависимости от освещения. Можно не угадать и засветить снимок. Тогда уже кадр не вытянуть. У большинства камер есть режим при котором они показывают засвеченные области. <img src="/assets/images/2019/07/resize_2019-07-28-16-06-42.jpg" alt="resize_2019-07-28 16-06-42.JPG" /></li>
  <li>сохранение в жипег можно оставить чисто номинальное с низким разрешением и качеством (просто чтобы был если надо кому-то быстро-быстро показать на компе итоговый снимок).</li>
  <li>по-возможности включить 14-bit raw или больше - там можно вытянуть еще данных о цветности.</li>
</ul>

<p><strong>Исходные данные</strong></p>

<p>Картинка, которую сохраняет фотик без предварительных обработок picture control (для canon оно называется иначе) совсем никуда не годится.</p>

<p><img src="/assets/images/2019/07/resized_dsc3046.jpg" alt="resized_DSC3046.JPG" /></p>

<p>Режимы съемки: 1/200s, F9, 10.5mm, pc nl, wb sun.</p>

<p>Среди всех кадров в серии брекетинга это был нормальный. Без засветки.</p>

<p><strong>Инструменты</strong></p>

<ul>
  <li>ufraw - позволяет преобразовывать raw в человеко-понятные форматы</li>
  <li>enfuse - склейка нескольких изображений с разной экспозицией для проявления высветления темных участков и затемнения светлых. Он же hdr.</li>
</ul>

<p><strong>Процесс</strong></p>

<p>Для того, чтобы собрать снимок с хорошим качеством нам потребуется несколько исходников с разной экспозицией. Конечно же можно использовать брекетинг и готовые файлы с фотика пропустив конвертирование. А можно из одной равки сделать несколько кадров с экспокоррекцией на любое значение от -3 до 3 единиц.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ufraw <span class="nt">--out-type</span><span class="o">=</span>jpg <span class="nt">--out-depth</span><span class="o">=</span>8 <span class="nt">--wb</span><span class="o">=</span>camera <span class="nt">--output</span><span class="o">=</span>001.jpg <span class="nt">--exposure</span><span class="o">=</span><span class="nt">-0</span>.33 <span class="nt">--black-point</span><span class="o">=</span>auto <span class="se">\_</span>DSC3046.NEF  
<span class="nv">$ </span>ufraw <span class="nt">--out-type</span><span class="o">=</span>jpg <span class="nt">--out-depth</span><span class="o">=</span>8 <span class="nt">--wb</span><span class="o">=</span>camera <span class="nt">--output</span><span class="o">=</span>002.jpg <span class="nt">--exposure</span><span class="o">=</span>auto <span class="nt">--black-point</span><span class="o">=</span>auto <span class="se">\_</span>DSC3046.NEF  
<span class="nv">$ </span>ufraw <span class="nt">--out-type</span><span class="o">=</span>jpg <span class="nt">--out-depth</span><span class="o">=</span>8 <span class="nt">--wb</span><span class="o">=</span>camera <span class="nt">--output</span><span class="o">=</span>003.jpg <span class="nt">--exposure</span><span class="o">=</span>0.33 <span class="nt">--black-point</span><span class="o">=</span>auto <span class="se">\_</span>DSC3046.NEF
</code></pre></div></div>

<p>Важные параметры:</p>

<ul>
  <li>–out-depth=8 - глубина цвета (зависит от формата сохранения), принимает значения 8 и 16;</li>
  <li>–wb=camera - конвертер пытается определить баланс белого по метаданным;</li>
  <li>–exposure=auto - коррекция экспозиции, auto\0 означает без коррекции, либо значение от -3 до 3;</li>
  <li>–black-point=auto - определение черной точки по метаданным.</li>
</ul>

<p>Мы получили три кадра, которые в дальнейшем можно просуммировать и получить результат.</p>

<p><img src="/assets/images/2019/07/2019-07-28-165128_1129x1034.png" alt="2019-07-28-16:51:28_1129x1034.png" /></p>

<p>А теперь их можно склеить в один кадр.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>enfuse <span class="nt">-o</span> result.jpg <span class="nt">--exposure-weight</span><span class="o">=</span>0 <span class="nt">--saturation-weight</span><span class="o">=</span>0 <span class="nt">--contrast-weight</span><span class="o">=</span>1 <span class="nt">--hard-mask</span> <span class="se">\*</span>.jpg
</code></pre></div></div>

<p><img src="/assets/images/2019/07/resize_result-1.jpg" alt="resize_result.jpg" /></p>

<p>Результат гораздо симпатичнее.</p>

<p><strong>Литература</strong></p>

<ul>
  <li><a href="https://bs.shikhalev.org/2016/06/stacking.html">Пингвин-фотолюбитель: 5. Стекинг</a></li>
  <li><a href="https://www.gimp.org/tutorials/Blending_Exposures/">Gimp: Blending Exposures</a></li>
  <li><a href="https://digital-photography-school.com/how-to-improve-your-long-exposure-with-photo-stacking/">How to Improve Your Long Exposure Photography with Photo Stacking</a></li>
</ul>



      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/RussianPenguin/russianpenguin.github.io">russianpenguin.github.io</a> is maintained by <a href="https://github.com/RussianPenguin">RussianPenguin</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(69889387, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/69889387" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
  </body>
</html>
