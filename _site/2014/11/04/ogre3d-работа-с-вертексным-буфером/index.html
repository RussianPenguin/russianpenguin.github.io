<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta name="yandex-verification" content="551ffc5ae1433df6" />
    
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Ogre3D: работа с вертексным буфером | Чтобы не забыть</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Ogre3D: работа с вертексным буфером" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Ура :) Я научился таки работать с вертексным буфером в этом самам огре. Как было просто в голом опенглы. Так просто, что даже вспомнить не хочется. :-D Теперь же нам надо сделать что-то вроде этого void TutorialApplication::createScene(void) { &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Зачем дополнительно создавать submesh пока не понял \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::MeshPtr mesh = Ogre::MeshManager::getSingleton().createManual(&quot;CustomMesh&quot;, &quot;General&quot;); &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::SubMesh \*subMesh = mesh-\&gt;createSubMesh(); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Подготавливаем структуру для трех вершин (треугольник у нас) \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; mesh-\&gt;sharedVertexData = new Ogre::VertexData; &amp;nbsp;&amp;nbsp;&amp;nbsp; mesh-\&gt;sharedVertexData-\&gt;vertexCount = 3; &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Получаем ссылку на дескриптор буфера (описывает структуру) \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::VertexDeclaration \*decl = mesh-\&gt;sharedVertexData-\&gt;vertexDeclaration; &amp;nbsp;&amp;nbsp;&amp;nbsp; size\_t offset = 0; &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* первый элемент буфера - это сама вершина (ее координаты) \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; decl-\&gt;addElement(0, offset, Ogre::VET\_FLOAT3, Ogre::VES\_POSITION); &amp;nbsp;&amp;nbsp;&amp;nbsp; offset += Ogre::VertexElement::getTypeSize(Ogre::VET\_FLOAT3); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* вторая часть буфера - нормаль вершины \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; decl-\&gt;addElement(0, offset, Ogre::VET\_FLOAT3, Ogre::VES\_NORMAL); &amp;nbsp;&amp;nbsp;&amp;nbsp; offset += Ogre::VertexElement::getTypeSize(Ogre::VET\_FLOAT3); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Третья часть - это цвет вершины \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; decl-\&gt;addElement(0, offset, Ogre::VET\_COLOUR, Ogre::VES\_DIFFUSE); &amp;nbsp;&amp;nbsp;&amp;nbsp; offset += Ogre::VertexElement::getTypeSize(Ogre::VET\_COLOUR); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Генерируем вертексный буфер по описанию, которое выше \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::HardwareVertexBufferSharedPtr vertexBuffer = Ogre::HardwareBufferManager::getSingleton(). &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; createVertexBuffer(offset, mesh-\&gt;sharedVertexData-\&gt;vertexCount, Ogre::HardwareBuffer::HBU\_STATIC); &amp;nbsp;&amp;nbsp;&amp;nbsp; // подготавливаем цвета &amp;nbsp;&amp;nbsp;&amp;nbsp; // можно писать цвета руками и использовать не Ogre::VET\_COLOUR, а VET\_FLOAT3|4 (4 - это если альфаканал нужен) &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::RenderSystem\* rs = Ogre::Root::getSingleton().getRenderSystem(); &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::uint32 red, green, blue; &amp;nbsp;&amp;nbsp;&amp;nbsp; rs-\&gt;convertColourValue(Ogre::ColourValue(1,0,0,1), &amp;red); &amp;nbsp;&amp;nbsp;&amp;nbsp; rs-\&gt;convertColourValue(Ogre::ColourValue(0,1,0,1), &amp;green); &amp;nbsp;&amp;nbsp;&amp;nbsp; rs-\&gt;convertColourValue(Ogre::ColourValue(0,0,1,1), &amp;blue); &amp;nbsp;&amp;nbsp;&amp;nbsp; const float sqrt13 = 0.577350269f; /\* sqrt(1/3) - это для нормалей \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* блокируем буфер на запись и берем указатель на него \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; float \*pVertex = static\_cast\&lt;float \*\&gt;(vertexBuffer-\&gt;lock(Ogre::HardwareBuffer::HBL\_DISCARD)); &amp;nbsp;&amp;nbsp;&amp;nbsp; // Заполняем буфер &amp;nbsp;&amp;nbsp;&amp;nbsp; \*pVertex++ = 0.0f; \*pVertex++ = 1.0f; \*pVertex++ = 0.0f; // вершина &amp;nbsp;&amp;nbsp;&amp;nbsp; \*pVertex++ = -sqrt13; \*pVertex++ = sqrt13; \*pVertex++ = -sqrt13; // нормаль &amp;nbsp;&amp;nbsp;&amp;nbsp; \*(\*(Ogre::uint32\*\*)&amp;pVertex)++ = red;&amp;nbsp;&amp;nbsp; //цвета &amp;nbsp;&amp;nbsp;&amp;nbsp; \*pVertex++ = -1.0f; \*pVertex++ = -1.0f; \*pVertex++ = 0.0f; // вершина &amp;nbsp;&amp;nbsp;&amp;nbsp; \*pVertex++ = sqrt13; \*pVertex++ = sqrt13; \*pVertex++ = -sqrt13; // нормаль &amp;nbsp;&amp;nbsp;&amp;nbsp; \*(\*(Ogre::uint32\*\*)&amp;pVertex)++ = green; // цвета &amp;nbsp;&amp;nbsp;&amp;nbsp; \*pVertex++ = 1.0f; \*pVertex++ = -1.0f; \*pVertex++ = 0.0f; // вершина &amp;nbsp;&amp;nbsp;&amp;nbsp; \*pVertex++ = -sqrt13; \*pVertex++ = -sqrt13; \*pVertex++ = -sqrt13; // нормаль &amp;nbsp;&amp;nbsp;&amp;nbsp; \*(\*(Ogre::uint32\*\*)&amp;pVertex)++ = blue;&amp;nbsp; // цвета &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* разблокируем \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; vertexBuffer-\&gt;unlock(); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Создаем буфер для индексов \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::HardwareIndexBufferSharedPtr indexBuffer = Ogre::HardwareBufferManager::getSingleton(). &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; createIndexBuffer(Ogre::HardwareIndexBuffer::IT\_16BIT, mesh-\&gt;sharedVertexData-\&gt;vertexCount, Ogre::HardwareBuffer::HBU\_STATIC); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Получаем блокировку на запись и пишем индексы в буфер \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; uint16\_t \*indices = static\_cast\&lt;uint16\_t \*\&gt;(indexBuffer-\&gt;lock(Ogre::HardwareBuffer::HBL\_NORMAL)); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Задаем нужный индексы вершин, которые будет треугольник представлять \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; indices[0] = 0; &amp;nbsp;&amp;nbsp;&amp;nbsp; indices[1] = 1; &amp;nbsp;&amp;nbsp;&amp;nbsp; indices[2] = 2; &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* записали - разблокировали \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; indexBuffer-\&gt;unlock(); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Теперь надо прицепить к нашей геометрии созданный буфер \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; mesh-\&gt;sharedVertexData-\&gt;vertexBufferBinding-\&gt;setBinding(0, vertexBuffer); &amp;nbsp;&amp;nbsp;&amp;nbsp; subMesh-\&gt;useSharedVertices = true; &amp;nbsp;&amp;nbsp;&amp;nbsp; subMesh-\&gt;indexData-\&gt;indexBuffer = indexBuffer; &amp;nbsp;&amp;nbsp;&amp;nbsp; subMesh-\&gt;indexData-\&gt;indexCount = mesh-\&gt;sharedVertexData-\&gt;vertexCount; &amp;nbsp;&amp;nbsp;&amp;nbsp; subMesh-\&gt;indexData-\&gt;indexStart = 0; &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Если не объявить рамку, то огр не сможет правильно обсчитать сетку &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \* и она будет видна лишь в корневой ноде (если ее туда прицепить), &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \* а в дочерних - не будет. &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \* Для этого можно зачитать http://www.ogre3d.org/forums/viewtopic.php?f=2&amp;t=60200 &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; mesh-\&gt;\_setBounds(Ogre::AxisAlignedBox(-1, -1, -1, 1, 1, 1)); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* нарисовали - грузим \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; mesh-\&gt;load(); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \* А теперь нужно задефайнить материал. &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \* Если этого не сделать, то новоиспеченный триангл будет выглядеть белым, &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \* а не многоцветным как задумано выше &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::MaterialPtr material = Ogre::MaterialManager::getSingleton().create(&quot;Test/ColourTest&quot;, Ogre::ResourceGroupManager::DEFAULT\_RESOURCE\_GROUP\_NAME); &amp;nbsp;&amp;nbsp;&amp;nbsp; material-\&gt;getTechnique(0)-\&gt;getPass(0)-\&gt;setVertexColourTracking(Ogre::TVC\_AMBIENT); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Создаем ноду на базе того, что накодили выше. \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::Entity \*entity = mSceneMgr-\&gt;createEntity(&quot;CustomEntity&quot;, &quot;CustomMesh&quot;, &quot;General&quot;); &amp;nbsp;&amp;nbsp;&amp;nbsp; entity-\&gt;setMaterialName(&quot;Test/ColourTest&quot;, &quot;General&quot;); &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::SceneNode \*node = mSceneMgr-\&gt;getRootSceneNode()-\&gt;createChildSceneNode(); &amp;nbsp;&amp;nbsp;&amp;nbsp; node-\&gt;attachObject(entity); &amp;nbsp;&amp;nbsp;&amp;nbsp; mCamera-\&gt;lookAt(Ogre::Vector3(0, 0, 0)); &amp;nbsp;&amp;nbsp;&amp;nbsp; mCamera-\&gt;setPosition(Ogre::Vector3(0, 10, 50)); }   Чего почитать: https://grahamedgecombe.com/blog/custom-meshes-in-ogre3d http://www.ogre3d.org/forums/viewtopic.php?f=2&amp;t=60200 http://www.ogre3d.org/tikiwiki/tiki-index.php?page=Generating+A+Mesh    " />
<meta property="og:description" content="Ура :) Я научился таки работать с вертексным буфером в этом самам огре. Как было просто в голом опенглы. Так просто, что даже вспомнить не хочется. :-D Теперь же нам надо сделать что-то вроде этого void TutorialApplication::createScene(void) { &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Зачем дополнительно создавать submesh пока не понял \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::MeshPtr mesh = Ogre::MeshManager::getSingleton().createManual(&quot;CustomMesh&quot;, &quot;General&quot;); &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::SubMesh \*subMesh = mesh-\&gt;createSubMesh(); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Подготавливаем структуру для трех вершин (треугольник у нас) \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; mesh-\&gt;sharedVertexData = new Ogre::VertexData; &amp;nbsp;&amp;nbsp;&amp;nbsp; mesh-\&gt;sharedVertexData-\&gt;vertexCount = 3; &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Получаем ссылку на дескриптор буфера (описывает структуру) \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::VertexDeclaration \*decl = mesh-\&gt;sharedVertexData-\&gt;vertexDeclaration; &amp;nbsp;&amp;nbsp;&amp;nbsp; size\_t offset = 0; &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* первый элемент буфера - это сама вершина (ее координаты) \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; decl-\&gt;addElement(0, offset, Ogre::VET\_FLOAT3, Ogre::VES\_POSITION); &amp;nbsp;&amp;nbsp;&amp;nbsp; offset += Ogre::VertexElement::getTypeSize(Ogre::VET\_FLOAT3); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* вторая часть буфера - нормаль вершины \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; decl-\&gt;addElement(0, offset, Ogre::VET\_FLOAT3, Ogre::VES\_NORMAL); &amp;nbsp;&amp;nbsp;&amp;nbsp; offset += Ogre::VertexElement::getTypeSize(Ogre::VET\_FLOAT3); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Третья часть - это цвет вершины \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; decl-\&gt;addElement(0, offset, Ogre::VET\_COLOUR, Ogre::VES\_DIFFUSE); &amp;nbsp;&amp;nbsp;&amp;nbsp; offset += Ogre::VertexElement::getTypeSize(Ogre::VET\_COLOUR); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Генерируем вертексный буфер по описанию, которое выше \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::HardwareVertexBufferSharedPtr vertexBuffer = Ogre::HardwareBufferManager::getSingleton(). &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; createVertexBuffer(offset, mesh-\&gt;sharedVertexData-\&gt;vertexCount, Ogre::HardwareBuffer::HBU\_STATIC); &amp;nbsp;&amp;nbsp;&amp;nbsp; // подготавливаем цвета &amp;nbsp;&amp;nbsp;&amp;nbsp; // можно писать цвета руками и использовать не Ogre::VET\_COLOUR, а VET\_FLOAT3|4 (4 - это если альфаканал нужен) &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::RenderSystem\* rs = Ogre::Root::getSingleton().getRenderSystem(); &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::uint32 red, green, blue; &amp;nbsp;&amp;nbsp;&amp;nbsp; rs-\&gt;convertColourValue(Ogre::ColourValue(1,0,0,1), &amp;red); &amp;nbsp;&amp;nbsp;&amp;nbsp; rs-\&gt;convertColourValue(Ogre::ColourValue(0,1,0,1), &amp;green); &amp;nbsp;&amp;nbsp;&amp;nbsp; rs-\&gt;convertColourValue(Ogre::ColourValue(0,0,1,1), &amp;blue); &amp;nbsp;&amp;nbsp;&amp;nbsp; const float sqrt13 = 0.577350269f; /\* sqrt(1/3) - это для нормалей \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* блокируем буфер на запись и берем указатель на него \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; float \*pVertex = static\_cast\&lt;float \*\&gt;(vertexBuffer-\&gt;lock(Ogre::HardwareBuffer::HBL\_DISCARD)); &amp;nbsp;&amp;nbsp;&amp;nbsp; // Заполняем буфер &amp;nbsp;&amp;nbsp;&amp;nbsp; \*pVertex++ = 0.0f; \*pVertex++ = 1.0f; \*pVertex++ = 0.0f; // вершина &amp;nbsp;&amp;nbsp;&amp;nbsp; \*pVertex++ = -sqrt13; \*pVertex++ = sqrt13; \*pVertex++ = -sqrt13; // нормаль &amp;nbsp;&amp;nbsp;&amp;nbsp; \*(\*(Ogre::uint32\*\*)&amp;pVertex)++ = red;&amp;nbsp;&amp;nbsp; //цвета &amp;nbsp;&amp;nbsp;&amp;nbsp; \*pVertex++ = -1.0f; \*pVertex++ = -1.0f; \*pVertex++ = 0.0f; // вершина &amp;nbsp;&amp;nbsp;&amp;nbsp; \*pVertex++ = sqrt13; \*pVertex++ = sqrt13; \*pVertex++ = -sqrt13; // нормаль &amp;nbsp;&amp;nbsp;&amp;nbsp; \*(\*(Ogre::uint32\*\*)&amp;pVertex)++ = green; // цвета &amp;nbsp;&amp;nbsp;&amp;nbsp; \*pVertex++ = 1.0f; \*pVertex++ = -1.0f; \*pVertex++ = 0.0f; // вершина &amp;nbsp;&amp;nbsp;&amp;nbsp; \*pVertex++ = -sqrt13; \*pVertex++ = -sqrt13; \*pVertex++ = -sqrt13; // нормаль &amp;nbsp;&amp;nbsp;&amp;nbsp; \*(\*(Ogre::uint32\*\*)&amp;pVertex)++ = blue;&amp;nbsp; // цвета &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* разблокируем \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; vertexBuffer-\&gt;unlock(); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Создаем буфер для индексов \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::HardwareIndexBufferSharedPtr indexBuffer = Ogre::HardwareBufferManager::getSingleton(). &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; createIndexBuffer(Ogre::HardwareIndexBuffer::IT\_16BIT, mesh-\&gt;sharedVertexData-\&gt;vertexCount, Ogre::HardwareBuffer::HBU\_STATIC); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Получаем блокировку на запись и пишем индексы в буфер \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; uint16\_t \*indices = static\_cast\&lt;uint16\_t \*\&gt;(indexBuffer-\&gt;lock(Ogre::HardwareBuffer::HBL\_NORMAL)); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Задаем нужный индексы вершин, которые будет треугольник представлять \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; indices[0] = 0; &amp;nbsp;&amp;nbsp;&amp;nbsp; indices[1] = 1; &amp;nbsp;&amp;nbsp;&amp;nbsp; indices[2] = 2; &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* записали - разблокировали \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; indexBuffer-\&gt;unlock(); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Теперь надо прицепить к нашей геометрии созданный буфер \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; mesh-\&gt;sharedVertexData-\&gt;vertexBufferBinding-\&gt;setBinding(0, vertexBuffer); &amp;nbsp;&amp;nbsp;&amp;nbsp; subMesh-\&gt;useSharedVertices = true; &amp;nbsp;&amp;nbsp;&amp;nbsp; subMesh-\&gt;indexData-\&gt;indexBuffer = indexBuffer; &amp;nbsp;&amp;nbsp;&amp;nbsp; subMesh-\&gt;indexData-\&gt;indexCount = mesh-\&gt;sharedVertexData-\&gt;vertexCount; &amp;nbsp;&amp;nbsp;&amp;nbsp; subMesh-\&gt;indexData-\&gt;indexStart = 0; &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Если не объявить рамку, то огр не сможет правильно обсчитать сетку &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \* и она будет видна лишь в корневой ноде (если ее туда прицепить), &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \* а в дочерних - не будет. &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \* Для этого можно зачитать http://www.ogre3d.org/forums/viewtopic.php?f=2&amp;t=60200 &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; mesh-\&gt;\_setBounds(Ogre::AxisAlignedBox(-1, -1, -1, 1, 1, 1)); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* нарисовали - грузим \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; mesh-\&gt;load(); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \* А теперь нужно задефайнить материал. &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \* Если этого не сделать, то новоиспеченный триангл будет выглядеть белым, &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \* а не многоцветным как задумано выше &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::MaterialPtr material = Ogre::MaterialManager::getSingleton().create(&quot;Test/ColourTest&quot;, Ogre::ResourceGroupManager::DEFAULT\_RESOURCE\_GROUP\_NAME); &amp;nbsp;&amp;nbsp;&amp;nbsp; material-\&gt;getTechnique(0)-\&gt;getPass(0)-\&gt;setVertexColourTracking(Ogre::TVC\_AMBIENT); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\* Создаем ноду на базе того, что накодили выше. \*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::Entity \*entity = mSceneMgr-\&gt;createEntity(&quot;CustomEntity&quot;, &quot;CustomMesh&quot;, &quot;General&quot;); &amp;nbsp;&amp;nbsp;&amp;nbsp; entity-\&gt;setMaterialName(&quot;Test/ColourTest&quot;, &quot;General&quot;); &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::SceneNode \*node = mSceneMgr-\&gt;getRootSceneNode()-\&gt;createChildSceneNode(); &amp;nbsp;&amp;nbsp;&amp;nbsp; node-\&gt;attachObject(entity); &amp;nbsp;&amp;nbsp;&amp;nbsp; mCamera-\&gt;lookAt(Ogre::Vector3(0, 0, 0)); &amp;nbsp;&amp;nbsp;&amp;nbsp; mCamera-\&gt;setPosition(Ogre::Vector3(0, 10, 50)); }   Чего почитать: https://grahamedgecombe.com/blog/custom-meshes-in-ogre3d http://www.ogre3d.org/forums/viewtopic.php?f=2&amp;t=60200 http://www.ogre3d.org/tikiwiki/tiki-index.php?page=Generating+A+Mesh    " />
<link rel="canonical" href="http://localhost:4000/2014/11/04/ogre3d-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0-%D1%81-%D0%B2%D0%B5%D1%80%D1%82%D0%B5%D0%BA%D1%81%D0%BD%D1%8B%D0%BC-%D0%B1%D1%83%D1%84%D0%B5%D1%80%D0%BE%D0%BC/" />
<meta property="og:url" content="http://localhost:4000/2014/11/04/ogre3d-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0-%D1%81-%D0%B2%D0%B5%D1%80%D1%82%D0%B5%D0%BA%D1%81%D0%BD%D1%8B%D0%BC-%D0%B1%D1%83%D1%84%D0%B5%D1%80%D0%BE%D0%BC/" />
<meta property="og:site_name" content="Чтобы не забыть" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-11-04T19:14:24+03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Ogre3D: работа с вертексным буфером" />
<script type="application/ld+json">
{"headline":"Ogre3D: работа с вертексным буфером","dateModified":"2014-11-04T19:14:24+03:00","datePublished":"2014-11-04T19:14:24+03:00","description":"Ура :) Я научился таки работать с вертексным буфером в этом самам огре. Как было просто в голом опенглы. Так просто, что даже вспомнить не хочется. :-D Теперь же нам надо сделать что-то вроде этого void TutorialApplication::createScene(void) { &amp;nbsp;&amp;nbsp;&amp;nbsp; /\\* Зачем дополнительно создавать submesh пока не понял \\*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::MeshPtr mesh = Ogre::MeshManager::getSingleton().createManual(&quot;CustomMesh&quot;, &quot;General&quot;); &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::SubMesh \\*subMesh = mesh-\\&gt;createSubMesh(); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\\* Подготавливаем структуру для трех вершин (треугольник у нас) \\*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; mesh-\\&gt;sharedVertexData = new Ogre::VertexData; &amp;nbsp;&amp;nbsp;&amp;nbsp; mesh-\\&gt;sharedVertexData-\\&gt;vertexCount = 3; &amp;nbsp;&amp;nbsp;&amp;nbsp; /\\* Получаем ссылку на дескриптор буфера (описывает структуру) \\*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::VertexDeclaration \\*decl = mesh-\\&gt;sharedVertexData-\\&gt;vertexDeclaration; &amp;nbsp;&amp;nbsp;&amp;nbsp; size\\_t offset = 0; &amp;nbsp;&amp;nbsp;&amp;nbsp; /\\* первый элемент буфера - это сама вершина (ее координаты) \\*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; decl-\\&gt;addElement(0, offset, Ogre::VET\\_FLOAT3, Ogre::VES\\_POSITION); &amp;nbsp;&amp;nbsp;&amp;nbsp; offset += Ogre::VertexElement::getTypeSize(Ogre::VET\\_FLOAT3); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\\* вторая часть буфера - нормаль вершины \\*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; decl-\\&gt;addElement(0, offset, Ogre::VET\\_FLOAT3, Ogre::VES\\_NORMAL); &amp;nbsp;&amp;nbsp;&amp;nbsp; offset += Ogre::VertexElement::getTypeSize(Ogre::VET\\_FLOAT3); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\\* Третья часть - это цвет вершины \\*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; decl-\\&gt;addElement(0, offset, Ogre::VET\\_COLOUR, Ogre::VES\\_DIFFUSE); &amp;nbsp;&amp;nbsp;&amp;nbsp; offset += Ogre::VertexElement::getTypeSize(Ogre::VET\\_COLOUR); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\\* Генерируем вертексный буфер по описанию, которое выше \\*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::HardwareVertexBufferSharedPtr vertexBuffer = Ogre::HardwareBufferManager::getSingleton(). &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; createVertexBuffer(offset, mesh-\\&gt;sharedVertexData-\\&gt;vertexCount, Ogre::HardwareBuffer::HBU\\_STATIC); &amp;nbsp;&amp;nbsp;&amp;nbsp; // подготавливаем цвета &amp;nbsp;&amp;nbsp;&amp;nbsp; // можно писать цвета руками и использовать не Ogre::VET\\_COLOUR, а VET\\_FLOAT3|4 (4 - это если альфаканал нужен) &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::RenderSystem\\* rs = Ogre::Root::getSingleton().getRenderSystem(); &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::uint32 red, green, blue; &amp;nbsp;&amp;nbsp;&amp;nbsp; rs-\\&gt;convertColourValue(Ogre::ColourValue(1,0,0,1), &amp;red); &amp;nbsp;&amp;nbsp;&amp;nbsp; rs-\\&gt;convertColourValue(Ogre::ColourValue(0,1,0,1), &amp;green); &amp;nbsp;&amp;nbsp;&amp;nbsp; rs-\\&gt;convertColourValue(Ogre::ColourValue(0,0,1,1), &amp;blue); &amp;nbsp;&amp;nbsp;&amp;nbsp; const float sqrt13 = 0.577350269f; /\\* sqrt(1/3) - это для нормалей \\*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; /\\* блокируем буфер на запись и берем указатель на него \\*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; float \\*pVertex = static\\_cast\\&lt;float \\*\\&gt;(vertexBuffer-\\&gt;lock(Ogre::HardwareBuffer::HBL\\_DISCARD)); &amp;nbsp;&amp;nbsp;&amp;nbsp; // Заполняем буфер &amp;nbsp;&amp;nbsp;&amp;nbsp; \\*pVertex++ = 0.0f; \\*pVertex++ = 1.0f; \\*pVertex++ = 0.0f; // вершина &amp;nbsp;&amp;nbsp;&amp;nbsp; \\*pVertex++ = -sqrt13; \\*pVertex++ = sqrt13; \\*pVertex++ = -sqrt13; // нормаль &amp;nbsp;&amp;nbsp;&amp;nbsp; \\*(\\*(Ogre::uint32\\*\\*)&amp;pVertex)++ = red;&amp;nbsp;&amp;nbsp; //цвета &amp;nbsp;&amp;nbsp;&amp;nbsp; \\*pVertex++ = -1.0f; \\*pVertex++ = -1.0f; \\*pVertex++ = 0.0f; // вершина &amp;nbsp;&amp;nbsp;&amp;nbsp; \\*pVertex++ = sqrt13; \\*pVertex++ = sqrt13; \\*pVertex++ = -sqrt13; // нормаль &amp;nbsp;&amp;nbsp;&amp;nbsp; \\*(\\*(Ogre::uint32\\*\\*)&amp;pVertex)++ = green; // цвета &amp;nbsp;&amp;nbsp;&amp;nbsp; \\*pVertex++ = 1.0f; \\*pVertex++ = -1.0f; \\*pVertex++ = 0.0f; // вершина &amp;nbsp;&amp;nbsp;&amp;nbsp; \\*pVertex++ = -sqrt13; \\*pVertex++ = -sqrt13; \\*pVertex++ = -sqrt13; // нормаль &amp;nbsp;&amp;nbsp;&amp;nbsp; \\*(\\*(Ogre::uint32\\*\\*)&amp;pVertex)++ = blue;&amp;nbsp; // цвета &amp;nbsp;&amp;nbsp;&amp;nbsp; /\\* разблокируем \\*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; vertexBuffer-\\&gt;unlock(); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\\* Создаем буфер для индексов \\*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::HardwareIndexBufferSharedPtr indexBuffer = Ogre::HardwareBufferManager::getSingleton(). &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; createIndexBuffer(Ogre::HardwareIndexBuffer::IT\\_16BIT, mesh-\\&gt;sharedVertexData-\\&gt;vertexCount, Ogre::HardwareBuffer::HBU\\_STATIC); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\\* Получаем блокировку на запись и пишем индексы в буфер \\*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; uint16\\_t \\*indices = static\\_cast\\&lt;uint16\\_t \\*\\&gt;(indexBuffer-\\&gt;lock(Ogre::HardwareBuffer::HBL\\_NORMAL)); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\\* Задаем нужный индексы вершин, которые будет треугольник представлять \\*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; indices[0] = 0; &amp;nbsp;&amp;nbsp;&amp;nbsp; indices[1] = 1; &amp;nbsp;&amp;nbsp;&amp;nbsp; indices[2] = 2; &amp;nbsp;&amp;nbsp;&amp;nbsp; /\\* записали - разблокировали \\*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; indexBuffer-\\&gt;unlock(); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\\* Теперь надо прицепить к нашей геометрии созданный буфер \\*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; mesh-\\&gt;sharedVertexData-\\&gt;vertexBufferBinding-\\&gt;setBinding(0, vertexBuffer); &amp;nbsp;&amp;nbsp;&amp;nbsp; subMesh-\\&gt;useSharedVertices = true; &amp;nbsp;&amp;nbsp;&amp;nbsp; subMesh-\\&gt;indexData-\\&gt;indexBuffer = indexBuffer; &amp;nbsp;&amp;nbsp;&amp;nbsp; subMesh-\\&gt;indexData-\\&gt;indexCount = mesh-\\&gt;sharedVertexData-\\&gt;vertexCount; &amp;nbsp;&amp;nbsp;&amp;nbsp; subMesh-\\&gt;indexData-\\&gt;indexStart = 0; &amp;nbsp;&amp;nbsp;&amp;nbsp; /\\* Если не объявить рамку, то огр не сможет правильно обсчитать сетку &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \\* и она будет видна лишь в корневой ноде (если ее туда прицепить), &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \\* а в дочерних - не будет. &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \\* Для этого можно зачитать http://www.ogre3d.org/forums/viewtopic.php?f=2&amp;t=60200 &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \\*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; mesh-\\&gt;\\_setBounds(Ogre::AxisAlignedBox(-1, -1, -1, 1, 1, 1)); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\\* нарисовали - грузим \\*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; mesh-\\&gt;load(); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\\* &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \\* А теперь нужно задефайнить материал. &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \\* Если этого не сделать, то новоиспеченный триангл будет выглядеть белым, &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \\* а не многоцветным как задумано выше &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \\*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::MaterialPtr material = Ogre::MaterialManager::getSingleton().create(&quot;Test/ColourTest&quot;, Ogre::ResourceGroupManager::DEFAULT\\_RESOURCE\\_GROUP\\_NAME); &amp;nbsp;&amp;nbsp;&amp;nbsp; material-\\&gt;getTechnique(0)-\\&gt;getPass(0)-\\&gt;setVertexColourTracking(Ogre::TVC\\_AMBIENT); &amp;nbsp;&amp;nbsp;&amp;nbsp; /\\* Создаем ноду на базе того, что накодили выше. \\*/ &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::Entity \\*entity = mSceneMgr-\\&gt;createEntity(&quot;CustomEntity&quot;, &quot;CustomMesh&quot;, &quot;General&quot;); &amp;nbsp;&amp;nbsp;&amp;nbsp; entity-\\&gt;setMaterialName(&quot;Test/ColourTest&quot;, &quot;General&quot;); &amp;nbsp;&amp;nbsp;&amp;nbsp; Ogre::SceneNode \\*node = mSceneMgr-\\&gt;getRootSceneNode()-\\&gt;createChildSceneNode(); &amp;nbsp;&amp;nbsp;&amp;nbsp; node-\\&gt;attachObject(entity); &amp;nbsp;&amp;nbsp;&amp;nbsp; mCamera-\\&gt;lookAt(Ogre::Vector3(0, 0, 0)); &amp;nbsp;&amp;nbsp;&amp;nbsp; mCamera-\\&gt;setPosition(Ogre::Vector3(0, 10, 50)); }   Чего почитать: https://grahamedgecombe.com/blog/custom-meshes-in-ogre3d http://www.ogre3d.org/forums/viewtopic.php?f=2&amp;t=60200 http://www.ogre3d.org/tikiwiki/tiki-index.php?page=Generating+A+Mesh    ","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2014/11/04/ogre3d-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0-%D1%81-%D0%B2%D0%B5%D1%80%D1%82%D0%B5%D0%BA%D1%81%D0%BD%D1%8B%D0%BC-%D0%B1%D1%83%D1%84%D0%B5%D1%80%D0%BE%D0%BC/"},"@type":"BlogPosting","url":"http://localhost:4000/2014/11/04/ogre3d-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0-%D1%81-%D0%B2%D0%B5%D1%80%D1%82%D0%B5%D0%BA%D1%81%D0%BD%D1%8B%D0%BC-%D0%B1%D1%83%D1%84%D0%B5%D1%80%D0%BE%D0%BC/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/assets/css/style.css?v=eacdde9998fcd3dd17b1956e7070eca69fdaf217">
  </head>
  <body>
    <header class="page-header" role="banner">
      <h1 class="project-name">Ogre3D: работа с вертексным буфером</h1>
      <h2 class="project-tagline">Записная книжка рассеянного [в пространстве и времени] программиста</h2>
      
        <a href="https://github.com/RussianPenguin/russianpenguin.github.io" class="btn">View on GitHub</a>
      
      
    </header>

    <main id="content" class="main-content" role="main">
      <h1>Ogre3D: работа с вертексным буфером</h1>
<p>04 Nov 2014</p>

<p>Ура :) Я научился таки работать с вертексным буфером в этом самам огре.</p>

<p>Как было просто в голом опенглы. Так просто, что даже вспомнить не хочется. :-D</p>

<p>Теперь же нам надо сделать что-то вроде этого</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">TutorialApplication</span><span class="o">::</span><span class="n">createScene</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>  
<span class="p">{</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">/</span><span class="err">\</span><span class="o">*</span> <span class="err">Зачем</span> <span class="err">дополнительно</span> <span class="err">создавать</span> <span class="n">submesh</span> <span class="err">пока</span> <span class="err">не</span> <span class="err">понял</span> <span class="err">\*/</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">MeshPtr</span> <span class="n">mesh</span> <span class="o">=</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">MeshManager</span><span class="o">::</span><span class="n">getSingleton</span><span class="p">().</span><span class="n">createManual</span><span class="p">(</span><span class="s">"CustomMesh"</span><span class="p">,</span> <span class="s">"General"</span><span class="p">);</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">SubMesh</span> <span class="err">\</span><span class="o">*</span><span class="n">subMesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">createSubMesh</span><span class="p">();</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">/</span><span class="err">\</span><span class="o">*</span> <span class="err">Подготавливаем</span> <span class="err">структуру</span> <span class="err">для</span> <span class="err">трех</span> <span class="err">вершин</span> <span class="p">(</span><span class="err">треугольник</span> <span class="err">у</span> <span class="err">нас</span><span class="p">)</span> <span class="err">\*/</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">mesh</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">sharedVertexData</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">VertexData</span><span class="p">;</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">mesh</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">sharedVertexData</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">vertexCount</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">/</span><span class="err">\</span><span class="o">*</span> <span class="err">Получаем</span> <span class="err">ссылку</span> <span class="err">на</span> <span class="err">дескриптор</span> <span class="err">буфера</span> <span class="p">(</span><span class="err">описывает</span> <span class="err">структуру</span><span class="p">)</span> <span class="err">\*/</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">VertexDeclaration</span> <span class="err">\</span><span class="o">*</span><span class="n">decl</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">sharedVertexData</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">vertexDeclaration</span><span class="p">;</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">size</span><span class="err">\</span><span class="n">_t</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">/</span><span class="err">\</span><span class="o">*</span> <span class="err">первый</span> <span class="err">элемент</span> <span class="err">буфера</span> <span class="o">-</span> <span class="err">это</span> <span class="err">сама</span> <span class="err">вершина</span> <span class="p">(</span><span class="err">ее</span> <span class="err">координаты</span><span class="p">)</span> <span class="err">\*/</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">decl</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">addElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">VET</span><span class="err">\</span><span class="n">_FLOAT3</span><span class="p">,</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">VES</span><span class="err">\</span><span class="n">_POSITION</span><span class="p">);</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">offset</span> <span class="o">+=</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">VertexElement</span><span class="o">::</span><span class="n">getTypeSize</span><span class="p">(</span><span class="n">Ogre</span><span class="o">::</span><span class="n">VET</span><span class="err">\</span><span class="n">_FLOAT3</span><span class="p">);</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">/</span><span class="err">\</span><span class="o">*</span> <span class="err">вторая</span> <span class="err">часть</span> <span class="err">буфера</span> <span class="o">-</span> <span class="err">нормаль</span> <span class="err">вершины</span> <span class="err">\*/</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">decl</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">addElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">VET</span><span class="err">\</span><span class="n">_FLOAT3</span><span class="p">,</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">VES</span><span class="err">\</span><span class="n">_NORMAL</span><span class="p">);</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">offset</span> <span class="o">+=</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">VertexElement</span><span class="o">::</span><span class="n">getTypeSize</span><span class="p">(</span><span class="n">Ogre</span><span class="o">::</span><span class="n">VET</span><span class="err">\</span><span class="n">_FLOAT3</span><span class="p">);</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">/</span><span class="err">\</span><span class="o">*</span> <span class="err">Третья</span> <span class="err">часть</span> <span class="o">-</span> <span class="err">это</span> <span class="err">цвет</span> <span class="err">вершины</span> <span class="err">\*/</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">decl</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">addElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">VET</span><span class="err">\</span><span class="n">_COLOUR</span><span class="p">,</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">VES</span><span class="err">\</span><span class="n">_DIFFUSE</span><span class="p">);</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">offset</span> <span class="o">+=</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">VertexElement</span><span class="o">::</span><span class="n">getTypeSize</span><span class="p">(</span><span class="n">Ogre</span><span class="o">::</span><span class="n">VET</span><span class="err">\</span><span class="n">_COLOUR</span><span class="p">);</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">/</span><span class="err">\</span><span class="o">*</span> <span class="err">Генерируем</span> <span class="err">вертексный</span> <span class="err">буфер</span> <span class="err">по</span> <span class="err">описанию</span><span class="p">,</span> <span class="err">которое</span> <span class="err">выше</span> <span class="err">\*/</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">HardwareVertexBufferSharedPtr</span> <span class="n">vertexBuffer</span> <span class="o">=</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">HardwareBufferManager</span><span class="o">::</span><span class="n">getSingleton</span><span class="p">().</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">createVertexBuffer</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">mesh</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">sharedVertexData</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">vertexCount</span><span class="p">,</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">HardwareBuffer</span><span class="o">::</span><span class="n">HBU</span><span class="err">\</span><span class="n">_STATIC</span><span class="p">);</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="c1">// подготавливаем цвета  </span>
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="c1">// можно писать цвета руками и использовать не Ogre::VET\_COLOUR, а VET\_FLOAT3|4 (4 - это если альфаканал нужен)  </span>
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">RenderSystem</span><span class="err">\</span><span class="o">*</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">Root</span><span class="o">::</span><span class="n">getSingleton</span><span class="p">().</span><span class="n">getRenderSystem</span><span class="p">();</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">uint32</span> <span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span><span class="p">;</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">rs</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">convertColourValue</span><span class="p">(</span><span class="n">Ogre</span><span class="o">::</span><span class="n">ColourValue</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">red</span><span class="p">);</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">rs</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">convertColourValue</span><span class="p">(</span><span class="n">Ogre</span><span class="o">::</span><span class="n">ColourValue</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">green</span><span class="p">);</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">rs</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">convertColourValue</span><span class="p">(</span><span class="n">Ogre</span><span class="o">::</span><span class="n">ColourValue</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">blue</span><span class="p">);</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">sqrt13</span> <span class="o">=</span> <span class="mf">0.577350269</span><span class="n">f</span><span class="p">;</span> <span class="o">/</span><span class="err">\</span><span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="err">это</span> <span class="err">для</span> <span class="err">нормалей</span> <span class="err">\*/</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">/</span><span class="err">\</span><span class="o">*</span> <span class="err">блокируем</span> <span class="err">буфер</span> <span class="err">на</span> <span class="err">запись</span> <span class="err">и</span> <span class="err">берем</span> <span class="err">указатель</span> <span class="err">на</span> <span class="err">него</span> <span class="err">\*/</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="kt">float</span> <span class="err">\</span><span class="o">*</span><span class="n">pVertex</span> <span class="o">=</span> <span class="k">static</span><span class="err">\</span><span class="n">_cast</span><span class="err">\</span><span class="o">&lt;</span><span class="kt">float</span> <span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="o">&gt;</span><span class="p">(</span><span class="n">vertexBuffer</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">lock</span><span class="p">(</span><span class="n">Ogre</span><span class="o">::</span><span class="n">HardwareBuffer</span><span class="o">::</span><span class="n">HBL</span><span class="err">\</span><span class="n">_DISCARD</span><span class="p">));</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="c1">// Заполняем буфер  </span>
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="n">pVertex</span><span class="o">++</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">f</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="n">pVertex</span><span class="o">++</span> <span class="o">=</span> <span class="mf">1.0</span><span class="n">f</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="n">pVertex</span><span class="o">++</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">f</span><span class="p">;</span> <span class="c1">// вершина  </span>
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="n">pVertex</span><span class="o">++</span> <span class="o">=</span> <span class="o">-</span><span class="n">sqrt13</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="n">pVertex</span><span class="o">++</span> <span class="o">=</span> <span class="n">sqrt13</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="n">pVertex</span><span class="o">++</span> <span class="o">=</span> <span class="o">-</span><span class="n">sqrt13</span><span class="p">;</span> <span class="c1">// нормаль  </span>
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="p">(</span><span class="err">\</span><span class="o">*</span><span class="p">(</span><span class="n">Ogre</span><span class="o">::</span><span class="n">uint32</span><span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">pVertex</span><span class="p">)</span><span class="o">++</span> <span class="o">=</span> <span class="n">red</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="c1">//цвета  </span>
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="n">pVertex</span><span class="o">++</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="n">f</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="n">pVertex</span><span class="o">++</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="n">f</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="n">pVertex</span><span class="o">++</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">f</span><span class="p">;</span> <span class="c1">// вершина  </span>
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="n">pVertex</span><span class="o">++</span> <span class="o">=</span> <span class="n">sqrt13</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="n">pVertex</span><span class="o">++</span> <span class="o">=</span> <span class="n">sqrt13</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="n">pVertex</span><span class="o">++</span> <span class="o">=</span> <span class="o">-</span><span class="n">sqrt13</span><span class="p">;</span> <span class="c1">// нормаль  </span>
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="p">(</span><span class="err">\</span><span class="o">*</span><span class="p">(</span><span class="n">Ogre</span><span class="o">::</span><span class="n">uint32</span><span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">pVertex</span><span class="p">)</span><span class="o">++</span> <span class="o">=</span> <span class="n">green</span><span class="p">;</span> <span class="c1">// цвета  </span>
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="n">pVertex</span><span class="o">++</span> <span class="o">=</span> <span class="mf">1.0</span><span class="n">f</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="n">pVertex</span><span class="o">++</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="n">f</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="n">pVertex</span><span class="o">++</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">f</span><span class="p">;</span> <span class="c1">// вершина  </span>
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="n">pVertex</span><span class="o">++</span> <span class="o">=</span> <span class="o">-</span><span class="n">sqrt13</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="n">pVertex</span><span class="o">++</span> <span class="o">=</span> <span class="o">-</span><span class="n">sqrt13</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="n">pVertex</span><span class="o">++</span> <span class="o">=</span> <span class="o">-</span><span class="n">sqrt13</span><span class="p">;</span> <span class="c1">// нормаль  </span>
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span><span class="p">(</span><span class="err">\</span><span class="o">*</span><span class="p">(</span><span class="n">Ogre</span><span class="o">::</span><span class="n">uint32</span><span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">pVertex</span><span class="p">)</span><span class="o">++</span> <span class="o">=</span> <span class="n">blue</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="c1">// цвета</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">/</span><span class="err">\</span><span class="o">*</span> <span class="err">разблокируем</span> <span class="err">\*/</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">vertexBuffer</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">unlock</span><span class="p">();</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">/</span><span class="err">\</span><span class="o">*</span> <span class="err">Создаем</span> <span class="err">буфер</span> <span class="err">для</span> <span class="err">индексов</span> <span class="err">\*/</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">HardwareIndexBufferSharedPtr</span> <span class="n">indexBuffer</span> <span class="o">=</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">HardwareBufferManager</span><span class="o">::</span><span class="n">getSingleton</span><span class="p">().</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">createIndexBuffer</span><span class="p">(</span><span class="n">Ogre</span><span class="o">::</span><span class="n">HardwareIndexBuffer</span><span class="o">::</span><span class="n">IT</span><span class="err">\</span><span class="n">_16BIT</span><span class="p">,</span> <span class="n">mesh</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">sharedVertexData</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">vertexCount</span><span class="p">,</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">HardwareBuffer</span><span class="o">::</span><span class="n">HBU</span><span class="err">\</span><span class="n">_STATIC</span><span class="p">);</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">/</span><span class="err">\</span><span class="o">*</span> <span class="err">Получаем</span> <span class="err">блокировку</span> <span class="err">на</span> <span class="err">запись</span> <span class="err">и</span> <span class="err">пишем</span> <span class="err">индексы</span> <span class="err">в</span> <span class="err">буфер</span> <span class="err">\*/</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">uint16</span><span class="err">\</span><span class="n">_t</span> <span class="err">\</span><span class="o">*</span><span class="n">indices</span> <span class="o">=</span> <span class="k">static</span><span class="err">\</span><span class="n">_cast</span><span class="err">\</span><span class="o">&lt;</span><span class="n">uint16</span><span class="err">\</span><span class="n">_t</span> <span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="o">&gt;</span><span class="p">(</span><span class="n">indexBuffer</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">lock</span><span class="p">(</span><span class="n">Ogre</span><span class="o">::</span><span class="n">HardwareBuffer</span><span class="o">::</span><span class="n">HBL</span><span class="err">\</span><span class="n">_NORMAL</span><span class="p">));</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">/</span><span class="err">\</span><span class="o">*</span> <span class="err">Задаем</span> <span class="err">нужный</span> <span class="err">индексы</span> <span class="err">вершин</span><span class="p">,</span> <span class="err">которые</span> <span class="err">будет</span> <span class="err">треугольник</span> <span class="err">представлять</span> <span class="err">\*/</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">/</span><span class="err">\</span><span class="o">*</span> <span class="err">записали</span> <span class="o">-</span> <span class="err">разблокировали</span> <span class="err">\*/</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">indexBuffer</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">unlock</span><span class="p">();</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">/</span><span class="err">\</span><span class="o">*</span> <span class="err">Теперь</span> <span class="err">надо</span> <span class="err">прицепить</span> <span class="err">к</span> <span class="err">нашей</span> <span class="err">геометрии</span> <span class="err">созданный</span> <span class="err">буфер</span> <span class="err">\*/</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">mesh</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">sharedVertexData</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">vertexBufferBinding</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">setBinding</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">vertexBuffer</span><span class="p">);</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">subMesh</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">useSharedVertices</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">subMesh</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">indexData</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">indexBuffer</span> <span class="o">=</span> <span class="n">indexBuffer</span><span class="p">;</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">subMesh</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">indexData</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">indexCount</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">sharedVertexData</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">vertexCount</span><span class="p">;</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">subMesh</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">indexData</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">indexStart</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">/</span><span class="err">\</span><span class="o">*</span> <span class="err">Если</span> <span class="err">не</span> <span class="err">объявить</span> <span class="err">рамку</span><span class="p">,</span> <span class="err">то</span> <span class="err">огр</span> <span class="err">не</span> <span class="err">сможет</span> <span class="err">правильно</span> <span class="err">обсчитать</span> <span class="err">сетку</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span> <span class="err">и</span> <span class="err">она</span> <span class="err">будет</span> <span class="err">видна</span> <span class="err">лишь</span> <span class="err">в</span> <span class="err">корневой</span> <span class="err">ноде</span> <span class="p">(</span><span class="err">если</span> <span class="err">ее</span> <span class="err">туда</span> <span class="err">прицепить</span><span class="p">),</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span> <span class="err">а</span> <span class="err">в</span> <span class="err">дочерних</span> <span class="o">-</span> <span class="err">не</span> <span class="err">будет</span><span class="p">.</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span> <span class="err">Для</span> <span class="err">этого</span> <span class="err">можно</span> <span class="err">зачитать</span> <span class="n">http</span><span class="o">:</span><span class="c1">//www.ogre3d.org/forums/viewtopic.php?f=2&amp;t=60200  </span>
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="err">\*/</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">mesh</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="err">\</span><span class="n">_setBounds</span><span class="p">(</span><span class="n">Ogre</span><span class="o">::</span><span class="n">AxisAlignedBox</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">/</span><span class="err">\</span><span class="o">*</span> <span class="err">нарисовали</span> <span class="o">-</span> <span class="err">грузим</span> <span class="err">\*/</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">mesh</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">load</span><span class="p">();</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">/</span><span class="err">\</span><span class="o">*</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span> <span class="err">А</span> <span class="err">теперь</span> <span class="err">нужно</span> <span class="err">задефайнить</span> <span class="err">материал</span><span class="p">.</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span> <span class="err">Если</span> <span class="err">этого</span> <span class="err">не</span> <span class="err">сделать</span><span class="p">,</span> <span class="err">то</span> <span class="err">новоиспеченный</span> <span class="err">триангл</span> <span class="err">будет</span> <span class="err">выглядеть</span> <span class="err">белым</span><span class="p">,</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="err">\</span><span class="o">*</span> <span class="err">а</span> <span class="err">не</span> <span class="err">многоцветным</span> <span class="err">как</span> <span class="err">задумано</span> <span class="err">выше</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="err">\*/</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">MaterialPtr</span> <span class="n">material</span> <span class="o">=</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">MaterialManager</span><span class="o">::</span><span class="n">getSingleton</span><span class="p">().</span><span class="n">create</span><span class="p">(</span><span class="s">"Test/ColourTest"</span><span class="p">,</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">ResourceGroupManager</span><span class="o">::</span><span class="n">DEFAULT</span><span class="err">\</span><span class="n">_RESOURCE</span><span class="err">\</span><span class="n">_GROUP</span><span class="err">\</span><span class="n">_NAME</span><span class="p">);</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">material</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">getTechnique</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">getPass</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">setVertexColourTracking</span><span class="p">(</span><span class="n">Ogre</span><span class="o">::</span><span class="n">TVC</span><span class="err">\</span><span class="n">_AMBIENT</span><span class="p">);</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">/</span><span class="err">\</span><span class="o">*</span> <span class="err">Создаем</span> <span class="err">ноду</span> <span class="err">на</span> <span class="err">базе</span> <span class="err">того</span><span class="p">,</span> <span class="err">что</span> <span class="err">накодили</span> <span class="err">выше</span><span class="p">.</span> <span class="err">\*/</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">Entity</span> <span class="err">\</span><span class="o">*</span><span class="n">entity</span> <span class="o">=</span> <span class="n">mSceneMgr</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">createEntity</span><span class="p">(</span><span class="s">"CustomEntity"</span><span class="p">,</span> <span class="s">"CustomMesh"</span><span class="p">,</span> <span class="s">"General"</span><span class="p">);</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">entity</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">setMaterialName</span><span class="p">(</span><span class="s">"Test/ColourTest"</span><span class="p">,</span> <span class="s">"General"</span><span class="p">);</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">Ogre</span><span class="o">::</span><span class="n">SceneNode</span> <span class="err">\</span><span class="o">*</span><span class="n">node</span> <span class="o">=</span> <span class="n">mSceneMgr</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">getRootSceneNode</span><span class="p">()</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">createChildSceneNode</span><span class="p">();</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">node</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">attachObject</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>

<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">mCamera</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">lookAt</span><span class="p">(</span><span class="n">Ogre</span><span class="o">::</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>  
<span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">mCamera</span><span class="o">-</span><span class="err">\</span><span class="o">&gt;</span><span class="n">setPosition</span><span class="p">(</span><span class="n">Ogre</span><span class="o">::</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">));</span>  
<span class="p">}</span>
</code></pre></div></div>

<p> </p>

<p><a href="https://russianpenguin.files.wordpress.com/2014/11/d180d0b0d0b1d0bed187d0b5d0b5-d0bcd0b5d181d182d0be-1_109.png"><img src="/assets/images/2014/11/d180d0b0d0b1d0bed187d0b5d0b5-d0bcd0b5d181d182d0be-1_109.png?w=300" alt="Ogre3D - использование вертексного буфера" /></a>Чего почитать:</p>

<ul>
  <li>https://grahamedgecombe.com/blog/custom-meshes-in-ogre3d</li>
  <li>http://www.ogre3d.org/forums/viewtopic.php?f=2&amp;t=60200</li>
  <li>http://www.ogre3d.org/tikiwiki/tiki-index.php?page=Generating+A+Mesh</li>
</ul>

<p> </p>

<p> </p>




      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/RussianPenguin/russianpenguin.github.io">russianpenguin.github.io</a> is maintained by <a href="https://github.com/RussianPenguin">RussianPenguin</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(69889387, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/69889387" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
  </body>
</html>
